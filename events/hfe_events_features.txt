#
namespace = hfe_features
# biobomb feature 0-1
planet_event = {
	id = hfe_features.0
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		habitable_planet = yes
		exists = owner
		owner = {
			has_ascension_perk = hfe_ap_features_biobomb
		}
	}
	immediate = {
		if = {
			limit = {
				owner = {
					is_guided_sapience_empire = yes
				}
			}
			planet_event = {
				id = hfe_features.1
				days = 1
			}
		}
		else = {
			create_species = {
				class = random_non_machine
				homeworld = root
			}
			owner = {
				if = {
					limit = {
						has_trait = trait_hive_mind
					}
					modify_species = {
						species = last_created_species
						add_trait = trait_hive_mind
					}
					last_created_species = {
						set_citizenship_type = {
							country = prev
							type = citizenship_full
							cooldown = no
						}
					}
				}
			}
			random_list = {
				60 = {
				}
				40 = {
					hfe_effect_species_add_modded_trait = {
						hfe_species = last_created_species
					}
				}
			}
			create_pop = {
				species = last_created_species
			}
		}
	}
}

# if guided_sapience_empire add more pops and apply random trait
planet_event = {
	id = hfe_features.1
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_owned_species = {
			limit = {
				is_sapient = no
			}
			random_list = {
				60 = {
				}
				40 = {
					hfe_effect_species_add_modded_trait = {
						hfe_species = prev
					}
				}
			}
			prev = {
				create_pop = {
					species = prev
					count = 3
				}
			}
		}
	}
}

# hfe_civic_features_designed_aristocracy affect starting leaders 2
# called during empire initialization when starting a new game
# scope: country
country_event = {
	id = hfe_features.2
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = hfe_civic_features_designed_aristocracy
	}
	immediate = {
		every_owned_leader = {
			hfe_effect_features_designed_aristocracy = yes
		}
	}
}

# exodus feature, settle at planet 3
planet_event = {
	id = hfe_features.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = {
			has_country_flag = hfe_features_exodus
		}
	}
	immediate = {
		owner = {
			remove_country_flag = hfe_features_exodus
			if = {
				limit = {
					is_country_type = hfe_features_exodus
				}
				set_country_type = default
			}
			remove_modifier = tsp_hfe_features_exodus_game_over_prevention
			add_modifier = {
				modifier = hfe_colonisation_cheat
				months = 1
			}
			while = {
				limit = {
					check_variable = {
						which = hfe_features_exodus_pop
						value > 0
					}
				}
				change_variable = {
					which = hfe_features_exodus_pop
					value = -1
				}
				root = {
					create_pop = {
						species = owner
					}
				}
			}
			if = {
				limit = {
					root = {
						not = {
							has_planet_flag = hfe_features_exodus_from@owner
						}
					}
				}
				add_modifier = {
					modifier = tsp_hfe_post_exodus_3
					years = 10
				}
				if = {
					limit = {
						has_origin = hfe_origin_features_exodus
					}
					add_modifier = {
						modifier = tsp_hfe_post_exodus_1
						years = 10
					}
					add_modifier = {
						modifier = tsp_hfe_post_exodus_2
						years = 10
					}
					if = {
						limit = {
							has_global_flag = HFE_TSP_spawn_test
						}
						log = "Exodus modifiers for Origin accepted"
					}
				}
				else = {
					if = {
						limit = {
							has_global_flag = HFE_TSP_spawn_test
						}
						log = "Exodus modifiers for Decision added"
					}
				}
			}
		}
		set_capital = yes
		if = {
			limit = {
				not = {
					has_planet_flag = hfe_features_exodus_from@owner
				}
			}
			set_name = "New Hope"
			add_deposit = hfe_exodus_new_starting_planet
			hfe_effect_create_starbase_starport_from_planet = yes
			add_modifier = {
				modifier = tsp_hfe_exodus_happy_ending
				years = 20
			}
			add_modifier = {
				modifier = hfe_unity
				years = 20
			}
			add_modifier = {
				modifier = hfe_population_boom
				years = 15
			}
			add_modifier = {
				modifier = hfe_idustrial_boom
				years = 3
			}
			add_modifier = {
				modifier = hfe_improvised_housing
				years = 2
			}
		}
		# separate info event, maybe merge into this
		owner = {
			country_event = {
				id = hfe_features.14
			}
		}
		if = {
			limit = {
				has_global_flag = HFE_TSP_spawn_test
			}
			log = "Exodus Story Mode event begun"
		}
	}
}

# exodus start origin 4
country_event = {
	id = hfe_features.4
	hide_window = yes
	is_triggered_only = yes
	show_sound = shattered_planet_explosion
	trigger = {
		has_origin = hfe_origin_features_exodus
		exists = capital_scope
	}
	immediate = {
		set_country_flag = custom_start_screen
		give_technology = {
			message = no
			tech = hfe_tech_features_exodus
		}
		save_event_target_as = hfe_features_exodus_country
		# change capital
		capital_scope = {
			set_name = NAME_The_End
			save_event_target_as = hfe_features_exodus_capital
			hfe_effect_features_exodus_setup = yes
			add_modifier = {
				modifier = tsp_hfe_exodus_start_planet_modifier
			}
			# Orbital deposit
			set_deposit = hfe_exodus_start_point
			change_pc = pc_broken
			# play_sound = shattered_planet_explosion
		}
		# remove constructors
		every_owned_fleet = {
			if = {
				limit = {
					or = {
						is_ship_class = shipclass_constructor
						is_ship_class = shipclass_mining_station
						is_ship_class = shipclass_research_station
						is_ship_class = shipclass_starbase
					}
				}
				delete_fleet = this
			}
			else = {
				set_location = event_target:hfe_features_exodus_capital
			}
		}
		create_fleet = {
			name = "Extra Survey Unit"
			effect = {
				set_owner = root
				create_ship = {
					random_existing_design = science
				}
				set_fleet_stance = evasive
				set_location = event_target:hfe_features_exodus_capital
				root = {
					create_leader = {
						class = scientist
						sub_type = survey
						species = this
					}
				}
				assign_leader = last_created_leader
			}
		}
		# ethic bonuses
		# extra scienc ship for materialist
		if = {
			limit = {
				is_materialist = yes
			}
			create_fleet = {
				name = "The Wanderer"
				effect = {
					set_owner = root
					create_ship = {
						name = "Ponderer Wanderer"
						random_existing_design = science
						graphical_culture = "hfe_graphical_culture_pirate"
					}
					set_fleet_stance = evasive
					set_location = event_target:hfe_features_exodus_capital
					root = {
						create_leader = {
							class = scientist
							sub_type = survey
							species = this
							traits = {
								trait = hfe_leader_trait_wary
							}
						}
					}
					assign_leader = last_created_leader
				}
			}
		}
		# some army for non pacifist
		if = {
			limit = {
				is_pacifist = no
			}
			create_fleet = {
				name = "Real Estate Agents"
				effect = {
					set_owner = root
					while = {
						count = 2
						create_army_transport = {
							army_name = "Free Real Estate Scouts"
							ship_name = "Free Real Estate Agent Transport"
							army_type = assault_army
							species = owner.species
						}
					}
					# more army for militarist
					if = {
						limit = {
							owner = {
								is_militarist = yes
							}
						}
						while = {
							count = 3
							create_army_transport = {
								army_name = "Free Real Estate Scouts"
								ship_name = "Free Real Estate Agent Transport"
								army_type = assault_army
								species = owner.species
							}
						}
						create_army_transport = {
							army_name = "Basic Combat Assistance"
							ship_name = "Basic Combat Transport"
							army_type = robotic_army
							species = owner.species
						}
					}
					set_fleet_stance = passive
					set_location = event_target:hfe_features_exodus_capital
				}
			}
		}
		# some fleet
		# 	create_fleet = {
		# 		name = "Great White Hope"
		# 		effect = {
		# 			set_owner = root
		# 			create_ship = {
		# 				name = "Great White Hope"
		# 				random_existing_design = destroyer
		# 				graphical_culture = hfe_graphical_culture_pirate
		# 			}
		# 			create_ship = {
		# 				name = "Great Blue Hope"
		# 				random_existing_design = corvette
		# 				graphical_culture = hfe_graphical_culture_pirate
		# 			}
		# 			create_ship = {
		# 				name = "Great Yellow Hope"
		# 				random_existing_design = corvette
		# 				graphical_culture = hfe_graphical_culture_pirate
		# 			}
		# 			set_fleet_stance = passive
		# 			set_location = event_target:hfe_features_exodus_capital
		# 		}
		# 	}
		# }
		# flavor
		# create_fleet = {
		# 	name = "Central Command"
		# 	set_take_point = yes
		# 	effect = {
		# 		set_owner = root
		# 		create_ship = {
		# 			name = "Flagship"
		# 			prefix = yes
		# 			design = "NAME_Diaspora"
		# 			effect = {
		# 				save_event_target_as = exodus_flavor_custom_capital
		# 			}
		# 		}
		# 		set_location = event_target:hfe_features_exodus_capital
		# 	}
		# }
		# set_custom_capital_location = event_target:exodus_flavor_custom_capital
		# disabled because they still follow even after interuption
		# every_owned_fleet = {
		# 	limit = {
		# 		is_ship_class = shipclass_military
		# 	}
		# 	auto_follow_fleet = {
		# 		target = event_target:hfe_exodus_colony_ship
		# 		attack_fleet = no
		# 	}
		# }
		if = {
			limit = {
				has_global_flag = HFE_TSP_spawn_test
			}
			log = "Exodus successfully spawned"
		}
	}
}

# aftermatch origin feature 5
country_event = {
	id = hfe_features.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = hfe_origin_features_aftermatch
		exists = capital_scope
	}
	immediate = {
		if = {
			limit = {
				count_playable_country = {
					count = 0
					limit = {
						is_ai = no
						not = {
							has_origin = hfe_origin_features_aftermatch
						}
					}
				}
			}
			set_country_flag = custom_start_screen
			if = {
				limit = {
					not = {
						has_global_flag = hfe_origin_features_aftermatch_init
					}
				}
				set_global_flag = hfe_origin_features_aftermatch_init
				set_update_modifiers_batch = begin
				every_system = {
					destroy_star_system = yes
				}
				set_update_modifiers_batch = end
			}
			capital_scope.solar_system = {
				spawn_planet = {
					class = "pc_habitat"
					# location = fromfrom.planet
					# orbit_location = yes
					# orbit_angle_offset = 45
					# orbit_distance_offset = 9.899
					size = 4
					# has_ring = no
					init_effect = {
						set_planet_entity = {
							entity = "habitat_phase_01_entity"
							graphical_culture = root
						}
						set_planet_flag = megastructure
						set_planet_flag = habitat
						create_colony = {
							owner = root
						}
						set_capital = yes
					}
				}
			}
		}
		else = {
			country_event = {
				id = hfe_features.6
			}
		}
	}
}

# notification for mp everyone should have origin
country_event = {
	id = hfe_features.6
	title = RT_ERROR
	desc = hfe_features.6.desc
	picture = GFX_error_log_button
	is_triggered_only = yes
	option = {
		name = RT_ERROR
	}
}

# disband federation 6
# country_event = {
# 	id = hfe_features.6
# 	hide_window = yes
# 	is_triggered_only = yes
# 	trigger = {
# 		has_federation = yes
# 	}
# 	immediate = {
# 		if = {
# 			limit = {
# 				is_at_war = yes
# 			}
# 			country_event = {
# 				id = hfe_features.6
# 				days = 365
# 			}
# 		}
# 		else = {
# 			leave_alliance = {
# 				override_requirements = yes
# 			}
# 		}
# 	}
# }
# aggressive diplomacy civic 7
# by ship on_ship_destroyed_perp
country_event = {
	id = hfe_features.7
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = hfe_civic_features_aggressive_diplomacy
	}
	immediate = {
		add_monthly_resource_mult = {
			resource = unity
			value = 0.1
			min = 1
			max = 24
		}
	}
}

# by planet annexed 8
planet_event = {
	id = hfe_features.8
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			has_valid_civic = hfe_civic_features_aggressive_diplomacy
		}
	}
	immediate = {
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 2
				min = 10
				max = 2000
			}
		}
	}
}

# by war entering 9
country_event = {
	id = hfe_features.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = hfe_civic_features_aggressive_diplomacy
	}
	immediate = {
		add_monthly_resource_mult = {
			resource = unity
			value = 3
			min = 100
			max = 10000
		}
	}
}

# early colonization origin 10
country_event = {
	id = hfe_features.10
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = hfe_origin_features_early_colonisation
		exists = capital_scope
	}
	immediate = {
		capital_scope.solar_system = {
			random_system_planet = {
				limit = {
					is_asteroid = no
					is_star = no
					habitable_planet = no
					not = {
						exists = owner
					}
				}
				change_pc = root.species
				while = {
					limit = {
						planet_size > 20
					}
					change_planet_size = -1
				}
				while = {
					limit = {
						planet_size < 16
					}
					change_planet_size = 1
				}
				reroll_planet = yes
				create_colony = {
					owner = root
				}
				create_pop = {
					species = root
				}
			}
		}
	}
}

# early contact origin 11
country_event = {
	id = hfe_features.11
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = hfe_origin_features_early_contact
		exists = capital_scope
	}
	immediate = {
		set_country_flag = has_encountered_other_empire
		set_country_flag = Story7
		set_country_flag = first_contact_event
		create_species = {
			class = random_non_machine
		}
		create_country = {
			type = default
			species = last_created_species
			ignore_initial_colony_error = yes
		}
		create_fleet = {
			effect = {
				set_owner = root
				create_ship = {
					random_existing_design = colonizer
					graphical_culture = last_created_country
					colonizer_species = last_created_species
				}
				set_location = {
					target = root.capital_scope
					angle = 120
				}
				add_modifier = {
					modifier = hfe_unkeep_80
				}
			}
		}
	}
}

# sanctuary origin 12
country_event = {
	id = hfe_features.12
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = hfe_origin_features_sanctuary
		exists = capital_scope
	}
	immediate = {
		add_seen_bypass_type = gateway
		set_spawn_system_batch = begin
		no_scope = {
			spawn_system = {
				initializer = hfe_init_features_sanctuary_0
				min_distance >= 500
				max_distance <= 510
				min_orientation_angle = 180
				max_orientation_angle = 270
				hyperlane = no
			}
		}
		event_target:hfe_features_sanctuary_planet.solar_system = {
			spawn_system = {
				initializer = hfe_init_features_sanctuary_1
				min_distance >= 10
				max_distance <= 20
				min_orientation_angle = 0
				max_orientation_angle = 80
				hyperlane = yes
			}
			spawn_system = {
				initializer = hfe_init_features_sanctuary_2
				min_distance >= 10
				max_distance <= 20
				min_orientation_angle = 100
				max_orientation_angle = 180
				hyperlane = yes
			}
		}
		set_spawn_system_batch = end
		capital_scope = {
			remove_all_buildings = yes
			#hfe_effect_clear_buildings_and_destroy_colony = yes
			change_pc = pc_nuked
			reroll_planet = yes
		}
		event_target:hfe_features_sanctuary_planet = {
			set_name = {
				key = hfe_features_sanctuary_rename
				variable_string = "[root.capital_scope.GetName]"
			}
			set_owner = root
			set_capital = yes
			change_pc = owner.species
			reroll_planet = yes
			clear_deposits = yes
			generate_start_deposits_and_blockers = yes
			clear_blockers = yes
			generate_start_buildings_and_districts = yes
			root = {
				every_owned_pop = {
					resettle_pop = {
						pop = this
						planet = prevprev
					}
					clear_pop_category = yes
				}
				every_owned_fleet = {
					if = {
						limit = {
							or = {
								is_ship_class = shipclass_mining_station
								is_ship_class = shipclass_research_station
								is_ship_class = shipclass_starbase
							}
						}
						delete_fleet = this
					}
					else = {
						set_location = prevprev.system_star
					}
				}
			}
			check_planet_employment = yes
			hfe_effect_create_starbase_starport_from_planet = yes
			hfe_effect_starbase_add_shipyard_0 = yes
		}
	}
}

# TODO exodus landed back on same planet - add debuff modifier 13
# exodus good end 14
country_event = {
	id = hfe_features.14
	title = hfe_features.14.name
	desc = hfe_features.14.desc
	picture = GFX_evt_landing_ship_2
	show_sound = event_airlock
	# show_sound = amb_colony_ship_hum
	is_triggered_only = yes
	trigger = {
		exists = from
	}
	option = {
		name = hfe_features.14.same_planet
		exclusive_trigger = {
			from = {
				has_planet_flag = hfe_features_exodus_from@owner
			}
		}
	}
	option = {
		name = hfe_features.14.0
	}
	option = {
		name = hfe_features.14.1
		exclusive_trigger = {
			is_imperial_authority = yes
		}
	}
	option = {
		name = hfe_features.14.2
		exclusive_trigger = {
			is_megacorp = yes
		}
	}
	option = {
		name = hfe_features.14.3
		exclusive_trigger = {
			is_spiritualist = yes
		}
	}
	option = {
		name = hfe_features.14.4
		exclusive_trigger = {
			is_materialist = yes
		}
	}
	option = {
		name = hfe_features.14.5
		exclusive_trigger = {
			is_xenophobe = yes
			NOT = {
				has_civic = civic_fanatic_purifiers
			}
		}
	}
	option = {
		name = hfe_features.14.6
		exclusive_trigger = {
			has_civic = civic_fanatic_purifiers
		}
	}
	option = {
		# Obscure "Captain Underpants" reference
		name = hfe_features.14.7
		exclusive_trigger = {
			has_civic = civic_hive_devouring_swarm
		}
	}
	option = {
		name = hfe_features.14.8
		exclusive_trigger = {
			OR = {
				has_civic = civic_inwards_perfection
				has_civic = hfe_civic_features_fanatic_isolationist
			}
		}
	}
	option = {
		name = hfe_features.14.9
		exclusive_trigger = {
			is_hive_empire = yes
		}
	}
	option = {
		name = hfe_features.14.10
		exclusive_trigger = {
			is_machine_empire = yes
		}
	}
	after = {
		if = {
			limit = {
				not = {
					from = {
						has_planet_flag = hfe_features_exodus_from@owner
					}
				}
			}
			play_sound = event_celebration
			add_resource = {
				minerals = 1000
				energy = 1000
				food = 1000
				unity = 3000
				influence = 200
			}
		}
		if = {
			limit = {
				has_global_flag = HFE_TSP_spawn_test
			}
			log = "Noah and Tom Jones have disembarked onto Mount Aarat"
		}
	}
}

# exodus bad end if your colony ship is destroyed 16
# This = owner of ship 1 (destroyed)
# From = owner of ship 2 (combatant)
# FromFrom = ship 1
# FromFromFrom = ship 2
country_event = {
	id = hfe_features.16
	title = hfe_features.16.name
	desc = hfe_features.16.desc
	picture = GFX_ship_destroyed
	location = fromfrom
	is_triggered_only = yes
	show_sound = ship_destroyed_big_explosion
	trigger = {
		has_country_flag = hfe_features_exodus
		exists = fromfrom
		fromfrom = {
			is_ship_class = shipclass_colonizer
		}
	}
	option = {
		name = hfe_discovery.51.0
		hidden_effect = {
			destroy_country = yes
		}
		log = "EXODUS GAME OVER!"
	}
}

# hfe_civic_features_nsfw_filter enstablish contact with nearest non machine empire 17
country_event = {
	id = hfe_features.17
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = hfe_civic_features_nsfw_filter
	}
	immediate = {
		closest_system = {
			limit = {
				exists = owner
				owner = {
					is_country_type = default
					is_machine_empire = no
				}
			}
			owner = {
				establish_communications_no_message = root
				root = {
					add_opinion_modifier = {
						who = prev
						modifier = opinion_insult
					}
					add_intel = {
						who = prev
						amount = 50
					}
				}
			}
		}
	}
}

# hfe_civic_features_power_in_low_numbers effect 20
country_event = {
	id = hfe_features.20
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = hfe_civic_features_power_in_low_numbers
	}
	immediate = {
		remove_modifier = hfe_features_power_in_low_numbers
		add_modifier = {
			modifier = hfe_features_power_in_low_numbers
			multiplier = value:hfe_script_value_features_power_in_low_numbers
		}
	}
}

# trigger recalc for prev event 21
planet_event = {
	id = hfe_features.21
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			country_event = {
				id = hfe_features.20
			}
		}
	}
}

# human 2 extended
# put stuff
planet_event = {
	id = hfe_features.22
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = solar_system
		exists = owner
	}
	immediate = {
		set_planet_flag = hfe_features_human_2_extended
		remove_modifier = colonial_spirit_mod
		add_modifier = {
			modifier = hfe_features_human_2_extended_corruption
		}
		add_modifier = {
			modifier = hfe_features_human_2_extended_inequality
		}
		add_modifier = {
			modifier = hfe_features_human_2_extended_ozone
		}
		# shift planets output for a bit
		add_district = district_farming
		add_district = district_mining
		remove_building = building_commercial_zone
		clear_deposits = yes
		# deposits
		# food
		set_variable = {
			which = hfe_deposit_features_human_2_extended_food
			value = 0
		}
		while = {
			limit = {
				check_variable = {
					which = hfe_deposit_features_human_2_extended_food
					value < 8
				}
			}
			random_list = {
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_food_0
							check_variable = {
								which = hfe_deposit_features_human_2_extended_food
								value > 4
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_0
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 4
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_food_1
							check_variable = {
								which = hfe_deposit_features_human_2_extended_food
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_1
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_food_2
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_2
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 1
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_food_3
							check_variable = {
								which = hfe_deposit_features_human_2_extended_food
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_3
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_food_4
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_4
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 1
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_food_5
							check_variable = {
								which = hfe_deposit_features_human_2_extended_food
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_5
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_food_6
							check_variable = {
								which = hfe_deposit_features_human_2_extended_food
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_food_6
					change_variable = {
						which = hfe_deposit_features_human_2_extended_food
						value = 2
					}
				}
			}
		}
		clear_variable = hfe_deposit_features_human_2_extended_food
		# minerals
		set_variable = {
			which = hfe_deposit_features_human_2_extended_minerals
			value = 0
		}
		while = {
			limit = {
				check_variable = {
					which = hfe_deposit_features_human_2_extended_minerals
					value < 8
				}
			}
			random_list = {
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_minerals_0
							check_variable = {
								which = hfe_deposit_features_human_2_extended_minerals
								value > 4
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_0
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 4
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_minerals_1
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_1
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 1
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_minerals_2
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_2
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 1
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_minerals_3
							check_variable = {
								which = hfe_deposit_features_human_2_extended_minerals
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_3
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_minerals_4
							check_variable = {
								which = hfe_deposit_features_human_2_extended_minerals
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_4
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_minerals_5
							check_variable = {
								which = hfe_deposit_features_human_2_extended_minerals
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_minerals_5
					change_variable = {
						which = hfe_deposit_features_human_2_extended_minerals
						value = 2
					}
				}
			}
		}
		clear_variable = hfe_deposit_features_human_2_extended_minerals
		# energy
		set_variable = {
			which = hfe_deposit_features_human_2_extended_energy
			value = 0
		}
		while = {
			limit = {
				check_variable = {
					which = hfe_deposit_features_human_2_extended_energy
					value < 8
				}
			}
			random_list = {
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_0
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 4
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_0
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 4
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_1
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_1
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_2
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_2
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_3
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_3
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_4
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_4
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 2
					}
				}
				1 = {
					modifier = {
						factor = 0
						or = {
							has_deposit = hfe_deposit_features_human_2_extended_energy_5
							check_variable = {
								which = hfe_deposit_features_human_2_extended_energy
								value > 6
							}
						}
					}
					add_deposit = hfe_deposit_features_human_2_extended_energy_5
					change_variable = {
						which = hfe_deposit_features_human_2_extended_energy
						value = 2
					}
				}
			}
		}
		clear_variable = hfe_deposit_features_human_2_extended_energy
		# industrial
		random_list = {
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_industrial_0
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_industrial_1
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_industrial_2
			}
		}
		# culture
		while = {
			count = 2
			random_list = {
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_culture_0
					}
					add_deposit = hfe_deposit_features_human_2_extended_culture_0
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_culture_1
					}
					add_deposit = hfe_deposit_features_human_2_extended_culture_1
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_culture_2
					}
					add_deposit = hfe_deposit_features_human_2_extended_culture_2
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_culture_3
					}
					add_deposit = hfe_deposit_features_human_2_extended_culture_3
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_culture_4
					}
					add_deposit = hfe_deposit_features_human_2_extended_culture_4
				}
			}
		}
		# chrysanthemum
		random_list = {
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_0
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_1
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_2
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_3
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_4
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_5
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_chrysanthemum_6
			}
		}
		# amenity
		while = {
			count = 2
			random_list = {
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_0
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_0
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_1
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_1
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_2
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_2
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_3
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_3
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_4
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_4
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_amenity_5
					}
					add_deposit = hfe_deposit_features_human_2_extended_amenity_5
				}
			}
		}
		# research
		random_list = {
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_research_0
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_research_1
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_research_2
			}
		}
		# army
		random_list = {
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_army_0
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_army_1
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_army_2
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_army_3
			}
		}
		# spaceport
		random_list = {
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_spaceport_0
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_spaceport_1
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_spaceport_2
			}
			1 = {
				add_deposit = hfe_deposit_features_human_2_extended_spaceport_3
			}
		}
		# city
		add_deposit = hfe_deposit_features_human_2_extended_city_0
		while = {
			count = 3
			random_list = {
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_1
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_1
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_2
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_2
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_3
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_3
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_4
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_4
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_5
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_5
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_6
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_6
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_7
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_7
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_8
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_8
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_9
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_9
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_10
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_10
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_11
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_11
				}
				1 = {
					modifier = {
						factor = 0
						has_deposit = hfe_deposit_features_human_2_extended_city_12
					}
					add_deposit = hfe_deposit_features_human_2_extended_city_12
				}
			}
		}
		# government
		add_deposit = hfe_deposit_features_human_2_extended_government_0
		random_list = {
			1 = {
				add_blocker = {
					type = hfe_blocker_features_human_2_extended_0
					blocked_deposit = random
				}
			}
			1 = {
				add_blocker = {
					type = hfe_blocker_features_human_2_extended_1
					blocked_deposit = random
				}
			}
			1 = {
				add_blocker = {
					type = hfe_blocker_features_human_2_extended_2
					blocked_deposit = random
				}
			}
			1 = {
				add_blocker = {
					type = hfe_blocker_features_human_2_extended_3
					blocked_deposit = random
				}
			}
		}
		add_blocker = {
			type = hfe_blocker_features_human_2_extended_4
			blocked_deposit = random
		}
		add_blocker = {
			type = hfe_blocker_features_human_2_extended_5
			blocked_deposit = random
		}
		# more pops
		create_pop = {
			species = owner
			count = 18
		}
		# solar system flavor
		solar_system = {
			# energy
			random_system_planet = {
				limit = {
					has_resource = {
						type = energy
						amount > 0
					}
				}
				add_modifier = {
					modifier = hfe_features_human_2_energy_0
				}
			}
			random_system_planet = {
				limit = {
					has_resource = {
						type = energy
						amount > 0
					}
					not = {
						has_modifier = hfe_features_human_2_energy_0
					}
				}
				add_modifier = {
					modifier = hfe_features_human_2_energy_1
				}
			}
			# minerals
			random_system_planet = {
				limit = {
					is_asteroid = yes
					has_resource = {
						type = minerals
						amount > 0
					}
				}
				add_modifier = {
					modifier = hfe_features_human_2_minerals_0
				}
			}
			random_system_planet = {
				limit = {
					is_asteroid = no
					has_resource = {
						type = minerals
						amount > 0
					}
				}
				add_modifier = {
					modifier = hfe_features_human_2_minerals_1
				}
			}
			# food
			random_system_planet = {
				limit = {
					is_asteroid = yes
					has_deposit = no
				}
				add_deposit = d_food_10
				create_mining_station = {
					owner = root.owner
				}
				add_modifier = {
					modifier = hfe_features_human_2_food_0
				}
			}
			# science
			random_system_planet = {
				limit = {
					has_deposit_for = shipclass_research_station
				}
				add_modifier = {
					modifier = hfe_features_human_2_science_0
				}
			}
			random_system_planet = {
				limit = {
					has_deposit_for = shipclass_research_station
					not = {
						has_modifier = hfe_features_human_2_science_0
					}
				}
				add_modifier = {
					modifier = hfe_features_human_2_science_1
				}
			}
		}
	}
}

# launch to every country
country_event = {
	id = hfe_features.23
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_country = {
			limit = {
				has_country_flag = human_2
				exists = capital_scope
			}
			capital_scope = {
				planet_event = {
					id = hfe_features.22
				}
			}
		}
	}
}

# clean then non human gets planet
# on_planet_transfer
#Fired whenever a new owner is set for a planet,
#be it after a war or through a trade
#From = Country scope (new owner)
#This = Planet scope
planet_event = {
	id = hfe_features.24
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_planet_flag = hfe_features_human_2_extended
		exists = solar_system
		exists = from
		from = {
			hfe_trigger_is_human = no
		}
	}
	immediate = {
		remove_planet_flag = hfe_features_human_2_extended
		solar_system = {
			every_system_planet = {
				remove_modifier = hfe_features_human_2_energy_0
				remove_modifier = hfe_features_human_2_energy_1
				remove_modifier = hfe_features_human_2_minerals_0
				remove_modifier = hfe_features_human_2_minerals_1
				remove_modifier = hfe_features_human_2_food_0
				remove_modifier = hfe_features_human_2_science_0
				remove_modifier = hfe_features_human_2_science_1
			}
		}
		remove_modifier = hfe_features_human_2_extended_corruption
		remove_modifier = hfe_features_human_2_extended_unhappy_officials
		remove_modifier = hfe_features_human_2_extended_inequality
		remove_modifier = hfe_features_human_2_extended_dignity
		remove_modifier = hfe_features_human_2_extended_ozone
		reroll_deposits = yes
	}
}
