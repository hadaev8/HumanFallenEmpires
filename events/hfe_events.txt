#
namespace = hfe
# functional section 0 - 50
# egypt features 10 - 46
# assimilator policy notification
country_event = {
	id = hfe.10
	title = hfe.10.name
	desc = hfe.10.desc
	picture = GFX_evt_hfe_fallen_3
	is_triggered_only = yes
	option = {
		name = hfe.10.0
	}
}

# contact with egypt 46 - 47
country_event = {
	id = hfe.46
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			has_country_flag = hfe_egypt
			is_country_type = hfe_fallen
		}
	}
	immediate = {
		establish_communications = from
		set_country_flag = hfe_egypt_contacted
		if = {
			limit = {
				is_ai = no
			}
			set_country_flag = hfe.47.step0
			country_event = {
				id = hfe.47
			}
		}
	}
}

# meeting dialog egypt
country_event = {
	id = hfe.47
	title = TRANSMISSION
	# TODO is this sound even triggered each stage? Probably not good
	show_sound = event_psionic
	desc = {
		trigger = {
			success_text = {
				text = hfe.47.desc.0.0
				has_country_flag = hfe.47.step0
			}
			success_text = {
				text = hfe.47.desc.0.1
				has_country_flag = hfe.47.step0
				has_country_flag = hfe_egypt_wormhole
			}
			success_text = {
				text = hfe.47.desc.1
				has_country_flag = hfe.47.step1
			}
			success_text = {
				text = hfe.47.desc.2
				has_country_flag = hfe.47.step2
			}
			success_text = {
				text = hfe.47.desc.3.0.0.0
				has_country_flag = hfe.47.step3
				has_country_flag = hfe.47.step3_bad_news.0
			}
			success_text = {
				text = hfe.47.desc.3.0.0.1
				has_country_flag = hfe.47.step3
				has_country_flag = hfe.47.step3_bad_news.1
			}
			success_text = {
				text = hfe.47.desc.3.0.1
				has_country_flag = hfe.47.step3
				or = {
					has_country_flag = hfe.47.step3_bad_news.0
					has_country_flag = hfe.47.step3_bad_news.1
				}
			}
			success_text = {
				text = hfe.47.desc.3.1
				has_country_flag = hfe.47.step3
			}
			success_text = {
				text = hfe.47.desc.4
				has_country_flag = hfe.47.step4
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:hfe_egypt_country
		room = hfe_egypt_room
	}
	# step 0
	option = {
		name = hfe.47.0.0
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.0.1
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
			any_relation = {
				has_country_flag = hfe_future
			}
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.0.2
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
			hfe_trigger_is_human = yes
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.0.3
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.2 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.0.4
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.2 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.0.5
		trigger = {
			is_homicidal = no
			has_country_flag = hfe.47.step0
			hfe_trigger_is_human = no
			any_relation = {
				hfe_trigger_is_human = yes
				not = {
					has_country_flag = hfe_egypt
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# exiting dialog options
	option = {
		name = hfe.47.0.6
		response_text = hfe.47.desc.badend
		trigger = {
			has_country_flag = hfe.47.step0
			is_militarist = yes
			fleet_power > 75000
		}
		hfe_effect_militarist_attraction.5 = yes
		# need it to trigger wormhole event
		hidden_effect = {
			set_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
		event_target:hfe_egypt_country = {
			add_opinion_modifier = {
				who = root
				modifier = hfe_opinion_egypt_first_contact_bad
			}
		}
	}
	option = {
		name = hfe.47.0.7
		response_text = hfe.47.desc.badend
		trigger = {
			has_country_flag = hfe.47.step0
			hfe_trigger_is_human = no
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.3 = yes
		# need it to trigger wormhole event
		hidden_effect = {
			set_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
		event_target:hfe_egypt_country = {
			add_opinion_modifier = {
				who = root
				modifier = hfe_opinion_egypt_first_contact_bad
			}
		}
	}
	option = {
		name = hfe.47.0.8
		response_text = hfe.47.desc.badend.2
		trigger = {
			has_country_flag = hfe.47.step0
			has_civic = civic_machine_terminator
		}
		# need it to trigger wormhole event
		hidden_effect = {
			set_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
		event_target:hfe_egypt_country = {
			add_opinion_modifier = {
				who = root
				modifier = hfe_opinion_egypt_first_contact_outraged
			}
		}
	}
	option = {
		name = hfe.47.0.9
		response_text = hfe.47.desc.badend.3
		trigger = {
			has_country_flag = hfe.47.step0
			has_civic = civic_hive_devouring_swarm
		}
		# need it to trigger wormhole event
		hidden_effect = {
			set_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
		event_target:hfe_egypt_country = {
			add_opinion_modifier = {
				who = root
				modifier = hfe_opinion_egypt_first_contact_outraged
			}
		}
	}
	option = {
		name = hfe.47.0.10
		response_text = hfe.47.desc.badend.4
		trigger = {
			has_country_flag = hfe.47.step0
			hfe_trigger_is_human = no
			has_civic = civic_fanatic_purifiers
		}
		# need it to trigger wormhole event
		hidden_effect = {
			set_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
		event_target:hfe_egypt_country = {
			add_opinion_modifier = {
				who = root
				modifier = hfe_opinion_egypt_first_contact_bad
			}
		}
	}
	# step 1
	option = {
		name = hfe.47.1.0
		trigger = {
			has_country_flag = hfe.47.step1
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.1
		trigger = {
			has_country_flag = hfe.47.step1
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.2
		trigger = {
			has_country_flag = hfe.47.step1
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.3
		trigger = {
			has_country_flag = hfe.47.step1
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.4
		trigger = {
			has_country_flag = hfe.47.step1
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.5
		trigger = {
			has_country_flag = hfe.47.step1
			OR = {
				is_xenophile = yes
				has_civic = civic_machine_servitor
			}
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.6
		trigger = {
			has_country_flag = hfe.47.step1
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.7
		trigger = {
			has_country_flag = hfe.47.step1
			is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.8
		trigger = {
			has_country_flag = hfe.47.step1
			is_machine_empire = yes
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.1.9
		trigger = {
			has_country_flag = hfe.47.step1
			is_hive_empire = yes
		}
		hfe_effect_event_47_next = yes
	}
	# step 2
	# human and own earth
	option = {
		name = hfe.47.2.0
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = yes
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_owned_by = root
			}
		}
		hfe_effect_event_47_next = yes
	}
	# human 2 and not surveyed earth
	option = {
		name = hfe.47.2.1
		trigger = {
			has_country_flag = hfe.47.step2
			has_country_flag = human_2
			nand = {
				exists = event_target:hfe_earth
				event_target:hfe_earth = {
					is_surveyed = {
						who = root
						status = yes
					}
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# human and surveyed earth
	option = {
		name = hfe.47.2.2
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = yes
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = yes
				}
				not = {
					is_owned_by = root
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# human, not human 2 and not surveyed earth
	option = {
		name = hfe.47.2.3
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = yes
			not = {
				has_country_flag = human_2
			}
			nand = {
				exists = event_target:hfe_earth
				event_target:hfe_earth = {
					is_surveyed = {
						who = root
						status = yes
					}
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# not human, know default human
	option = {
		name = hfe.47.2.4
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = no
			any_relation = {
				not = {
					is_country_type = primitive
				}
				hfe_trigger_is_human = yes
				exists = event_target:hfe_earth
				event_target:hfe_earth = {
					is_owned_by = prev
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# not human and not surveyed earth
	option = {
		name = hfe.47.2.5
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = no
			nand = {
				exists = event_target:hfe_earth
				event_target:hfe_earth = {
					is_surveyed = {
						who = root
						status = yes
					}
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# surveyed nuked earth
	option = {
		name = hfe.47.2.6
		trigger = {
			has_country_flag = hfe.47.step2
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = yes
				}
				has_planet_flag = nuked_earth
			}
		}
		hidden_effect = {
			set_country_flag = hfe.47.step3_bad_news.0
		}
		hfe_effect_event_47_next = yes
	}
	# surveyed primitive earth
	option = {
		name = hfe.47.2.7
		trigger = {
			has_country_flag = hfe.47.step2
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = yes
				}
				exists = owner
				owner = {
					is_country_type = primitive
				}
			}
		}
		hfe_effect_event_47_next = yes
	}
	# want to survey earth
	option = {
		name = hfe.47.2.8
		trigger = {
			has_country_flag = hfe.47.step2
			OR = {
				hfe_trigger_is_human = yes
				is_xenophile = yes
				has_civic = civic_machine_servitor
			}
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = no
				}
			}
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_47_next = yes
		hidden_effect = {
			begin_event_chain = {
				event_chain = hfe_chain_find_sol
				target = root
			}
			event_target:hfe_earth.solar_system = {
				save_event_target_as = hfe_sol
				set_star_flag = hfe_sol_target@root
			}
			create_point_of_interest = {
				id = hfe_chain_find_sol.0
				name = sol_1_poi
				desc = hfe_chain_find_sol_desc.0
				event_chain = hfe_chain_find_sol
				location = event_target:hfe_sol
			}
		}
	}
	# earth have not original owner but not root
	option = {
		name = hfe.47.2.9
		trigger = {
			has_country_flag = hfe.47.step2
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = yes
				}
				exists = owner
				nor = {
					owner = {
						hfe_trigger_is_human = yes
					}
					is_owned_by = root
				}
			}
		}
		hidden_effect = {
			set_country_flag = hfe.47.step3_bad_news.1
		}
		hfe_effect_event_47_next = yes
	}
	# earth have no owner
	option = {
		name = hfe.47.2.10
		trigger = {
			has_country_flag = hfe.47.step2
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_surveyed = {
					who = root
					status = yes
				}
				nor = {
					exists = owner
					has_planet_flag = nuked_earth
				}
			}
		}
		hidden_effect = {
			set_country_flag = hfe.47.step3_bad_news.0
		}
		hfe_effect_event_47_next = yes
	}
	# own earth, non human, not original owner eg took it by force
	option = {
		name = hfe.47.2.11
		trigger = {
			has_country_flag = hfe.47.step2
			hfe_trigger_is_human = no
			exists = event_target:hfe_earth
			event_target:hfe_earth = {
				is_owned_by = root
				# should it block alien (non human portrait) started on earth?
				# not = {
				# 	is_original_owner = owner
				# }
			}
		}
		hfe_effect_event_47_next = yes
	}
	# step 3
	option = {
		name = hfe.47.3.0
		trigger = {
			has_country_flag = hfe.47.step3
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.1
		trigger = {
			has_country_flag = hfe.47.step3
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.2
		trigger = {
			has_country_flag = hfe.47.step3
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.3
		trigger = {
			has_country_flag = hfe.47.step3
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.4
		trigger = {
			has_country_flag = hfe.47.step3
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.5
		trigger = {
			has_country_flag = hfe.47.step3
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.6
		trigger = {
			has_country_flag = hfe.47.step3
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.3.7
		trigger = {
			has_country_flag = hfe.47.step3
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	#step 4
	option = {
		name = hfe.47.4.0
		trigger = {
			has_country_flag = hfe.47.step4
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.4.1
		trigger = {
			has_country_flag = hfe.47.step4
			hfe_trigger_is_human = yes
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.4.2
		trigger = {
			has_country_flag = hfe.47.step4
		}
		hfe_effect_event_47_next = yes
	}
	option = {
		name = hfe.47.4.3
		trigger = {
			is_machine_empire = yes
		}
		hfe_effect_event_47_next = yes
	}
}

# awake make egypt default country 48
country_event = {
	id = hfe.48
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		hfe_trigger_human_fallen_awake = yes
	}
	immediate = {
		set_timed_global_flag = {
			flag = hfe_awake_block
			years = 10
		}
		set_country_type = default
		change_government = {
			civics = {
				civic = hfe_civic_egypt_genetic
				civic = hfe_civic_egypt_rulers
				civic = hfe_civic_egypt_fury
			}
		}
		every_playable_country = {
			establish_communications_no_message = root
			if = {
				limit = {
					is_ai = no
				}
				country_event = {
					id = hfe.49
				}
				set_country_flag = hfe_egypt_contacted
			}
		}
	}
}

# dialog awake
country_event = {
	id = hfe.49
	title = hfe.49.name
	desc = hfe.49.desc.0
	diplomatic = yes
	location = event_target:hfe_egypt_country.capital_scope
	is_triggered_only = yes
	show_sound = event_alien_signal
	picture_event_data = {
		portrait = event_target:hfe_egypt_country.ruler
		room = hfe_egypt_room
	}
	option = {
		name = hfe.49.0
		default_hide_option = yes
	}
}

# anomalies and after survey on actions 50 - 100
# wormhole to ju ahet 50
ship_event = {
	id = hfe.50
	title = hfe.50.name
	desc = hfe.50.desc
	picture = GFX_evt_hfe_wormhole
	show_sound = event_ship_thrusters
	location = root
	is_triggered_only = yes
	trigger = {
		exists = solar_system
		exists = from
		exists = owner
		exists = event_target:hfe_egypt_country.capital_scope
	}
	immediate = {
		solar_system = {
			save_event_target_as = hfe_wormhole_system
		}
		from = {
			hfe_effect_remove_signal_object_from_this = yes
		}
		owner = {
			set_country_flag = hfe_egypt_wormhole
		}
	}
	option = {
		name = hfe.50.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		hidden_effect = {
			fleet = {
				set_location = {
					target = event_target:hfe_egypt_country.capital_scope
					distance = 5
					angle = random
				}
			}
		}
	}
}

# varelse fleet in time trap 51-54
# start event
ship_event = {
	id = hfe.51
	title = hfe.51.name
	desc = hfe.51.desc
	picture = GFX_evt_hfe_station
	show_sound = event_ship_thrusters
	# bugged
	#location = event_target:hfe_varelse_fleet_location
	location = root
	trackable = yes
	is_triggered_only = yes
	trigger = {
		hfe_trigger_story_enabled = yes
		not = {
			has_global_flag = hfe_has_event.51
		}
		exists = owner
		owner = {
			is_ai = no
		}
		not = {
			exists = solar_system.owner
		}
	}
	immediate = {
		set_global_flag = hfe_has_event.51
		create_ambient_object = {
			type = ancient_battlefield_object
			location = solar_system
			#use_3d_location = yes
			# entity_offset_height = {
			# 	min = -0
			# 	max = -25
			# }
		}
		last_created_ambient_object = {
			save_event_target_as = hfe_varelse_fleet_location
			hfe_effect_create_signal_object = yes
		}
		enable_special_project = {
			name = hfe_project_varelse_fleet
			location = event_target:hfe_varelse_fleet_location
			owner = root.owner
		}
	}
	option = {
		name = hfe.51.0
		trigger = {
			is_ship_size = science
		}
		# fleet = {
		# 	hidden_effect = {
		# 		clear_fleet_actions = this
		# 		clear_orders = yes
		# 	}
		# 	fleet_action_research_special_project = {
		# 		special_project = hfe_project_varelse_fleet
		# 		target = event_target:hfe_varelse_fleet_location
		# 	}
		# }
	}
	option = {
		name = hfe.51.1
	}
}

# project complete
ship_event = {
	id = hfe.52
	title = hfe.52.name
	desc = {
		trigger = {
			success_text = {
				text = hfe.52.desc.0
				owner = {
					has_country_flag = hfe_egypt_contacted
				}
			}
			text = hfe.52.desc.1
		}
	}
	picture = GFX_evt_hfe_wormhole
	show_sound = event_ship_thrusters
	location = root
	is_triggered_only = yes
	immediate = {
		event_target:hfe_varelse_fleet_location = {
			hfe_effect_remove_signal_object_from_this = yes
		}
		owner = {
			set_country_flag = hfe_has_event_52
		}
		create_country = {
			name = "Varelse Fleet Trapped In Time"
			type = faction
			species = event_target:hfe_varelse_species
			ignore_initial_colony_error = yes
			origin = origin_remnants
			effect = {
				hfe_effect_init_give_tech_t3 = yes
				establish_communications_no_message = root.owner
				set_faction_hostility = {
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
				create_leader = {
					class = commander
					species = event_target:hfe_varelse_species
					skill = 8
				}
				create_fleet = {
					name = "11th Strike Force"
					settings = {
						can_change_composition = no
						uses_naval_capacity = no
					}
					effect = {
						set_owner = prev
						while = {
							count = 10
							create_ship = {
								random_existing_design = cruiser
							}
						}
						assign_leader = last_created_leader
						while = {
							count = 50
							create_ship = {
								random_existing_design = corvette
							}
						}
						set_location = event_target:hfe_varelse_fleet_location
						save_event_target_as = hfe_varelse_fleet
					}
				}
			}
		}
		if = {
			limit = {
				has_global_flag = HFE_TSP_spawn_test
			}
			log = "Varelse Time Trapped Fleet"
		}
	}
	option = {
		name = hfe_at_the_sreen
		custom_tooltip = hfe.53.0.tooltip
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		hidden_effect = {
			owner = {
				country_event = {
					id = hfe.53
				}
				set_country_flag = hfe.53.0
			}
		}
		# default_hide_option = yes
	}
}

# dialog with fleet
country_event = {
	id = hfe.53
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.53.desc.0
				has_country_flag = hfe.53.0
			}
			success_text = {
				text = hfe.53.desc.1
				has_country_flag = hfe.53.1
			}
			success_text = {
				text = hfe.53.desc.2.0
				has_country_flag = hfe.53_offer_coordinates
			}
			success_text = {
				text = hfe.53.desc.2.1
				has_country_flag = hfe.53_new_home
			}
			success_text = {
				text = hfe.53.desc.2.2
				has_country_flag = hfe.53_good_luck
			}
			success_text = {
				text = hfe.53.desc.2.3
				has_country_flag = hfe.53_not_exists
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:hfe_varelse_species
		room = hfe_varelse_room
	}
	# step 0
	option = {
		name = hfe.53.0
		trigger = {
			has_country_flag = hfe.53.0
			is_homicidal = no
		}
		hfe_effect_event_53_next = yes
	}
	# step 1
	option = {
		name = hfe.53.1.0
		custom_tooltip = hfe.53.1.0.tooltip
		trigger = {
			has_country_flag = hfe.53.1
			has_country_flag = hfe_egypt_contacted
			is_xenophobe = yes
		}
		hidden_effect = {
			set_country_flag = hfe.53_offer_coordinates
		}
		hfe_effect_xenophobe_attraction.2 = yes
		hfe_effect_event_53_next = yes
	}
	option = {
		name = hfe.53.1.1
		custom_tooltip = hfe.53.1.1.tooltip
		trigger = {
			has_country_flag = hfe.53.1
			has_country_flag = hfe_egypt_contacted
			is_militarist = yes
		}
		hidden_effect = {
			set_country_flag = hfe.53_offer_coordinates
		}
		hfe_effect_militarist_attraction.2 = yes
		hfe_effect_event_53_next = yes
	}
	option = {
		name = hfe.53.1.2
		trigger = {
			has_country_flag = hfe.53.1
			has_country_flag = hfe_egypt_contacted
		}
		hidden_effect = {
			set_country_flag = hfe.53_new_home
		}
		hfe_effect_event_53_next = yes
	}
	option = {
		name = hfe.53.1.3
		trigger = {
			has_country_flag = hfe.53.1
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.3 = yes
		hidden_effect = {
			set_country_flag = hfe.53_new_home
		}
		hfe_effect_event_53_next = yes
	}
	option = {
		name = hfe.53.1.4
		trigger = {
			has_country_flag = hfe.53.1
			not = {
				has_country_flag = hfe_egypt_contacted
			}
		}
		hidden_effect = {
			set_country_flag = hfe.53_good_luck
		}
		hfe_effect_event_53_next = yes
	}
	option = {
		name = hfe.53.1.5
		trigger = {
			has_country_flag = hfe.53.1
			has_country_flag = hfe_egypt_contacted
			not = {
				exists = event_target:hfe_egypt_country
			}
		}
		hidden_effect = {
			set_country_flag = hfe.53_not_exists
		}
		hfe_effect_event_53_next = yes
	}
	# end
	option = {
		name = hfe_end_transmission
		default_hide_option = yes
		trigger = {
			or = {
				is_homicidal = yes
				has_country_flag = hfe.53.2
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.53.2
			remove_country_flag = hfe.53_offer_coordinates
			remove_country_flag = hfe.53_good_luck
			event_target:hfe_varelse_fleet = {
				fleet_event = {
					id = hfe.54
				}
			}
		}
	}
}

# move fleet, need separate event couz of root switch
fleet_event = {
	id = hfe.54
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		from = {
			# found new home
			if = {
				limit = {
					or = {
						has_country_flag = hfe.53_new_home
						has_country_flag = hfe.53_not_exists
					}
				}
				remove_country_flag = hfe.53_new_home
				remove_country_flag = hfe.53_not_exists
				root = {
					hfe_effect_varelse_fleet_find_new_home = yes
				}
			}
			# attack home of light
			else = {
				root = {
					hfe_effect_varelse_fleet_attack_home_of_light = yes
				}
			}
		}
	}
}

# bonus to egypt contact wormhole anomaly 55
country_event = {
	id = hfe.55
	title = hfe.55.name
	desc = {
		trigger = {
			text = hfe.55.desc.0
			success_text = {
				text = hfe.55.desc.1
				has_seen_any_bypass = wormhole
				not = {
					has_technology = tech_wormhole_stabilization
				}
			}
		}
	}
	picture = GFX_evt_hfe_wormhole
	location = event_target:hfe_wormhole_system
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_wormhole_system
	}
	immediate = {
		event_target:hfe_wormhole_system = {
			random_system = {
				limit = {
					has_natural_wormhole = no
					not = {
						has_star_flag = sealed_system
					}
					distance = {
						source = prev
						min_distance >= 500
					}
				}
				weights = {
					base = 100
					modifier = {
						factor = 0.01
						exists = owner
						# surprize extermination
						owner = {
							is_homicidal = no
						}
					}
				}
				prev = {
					# done this way to ensure we don't spawn "orphan" wormholes (wormholes that aren't linked to anything)
					spawn_natural_wormhole = {
						bypass_type = hfe_wormhole
						random_pos = yes
						orbit_angle = 360
					}
				}
				spawn_natural_wormhole = {
					bypass_type = hfe_wormhole
					random_pos = yes
					orbit_angle = 360
				}
				link_wormholes = prev
			}
		}
	}
	option = {
		name = hfe.55.0
		exclusive_trigger = {
			has_policy_flag = diplo_stance_belligerent
		}
	}
	option = {
		name = hfe.55.1
		exclusive_trigger = {
			has_policy_flag = diplo_stance_cooperative
		}
	}
	option = {
		name = hfe.55.2
		exclusive_trigger = {
			has_policy_flag = diplo_stance_isolationist
		}
	}
	option = {
		name = hfe.55.3
		exclusive_trigger = {
			has_policy_flag = diplo_stance_expansionist
		}
	}
	option = {
		name = hfe.55.4
		exclusive_trigger = {
			has_policy_flag = diplo_stance_mercantile
		}
	}
	option = {
		name = hfe.55.5
		exclusive_trigger = {
			has_policy_flag = diplo_stance_supremacist
		}
	}
	option = {
		name = hfe.55.6
		exclusive_trigger = {
			has_policy_flag = diplo_stance_hunger
		}
	}
	option = {
		name = hfe.55.7
		exclusive_trigger = {
			has_policy_flag = diplo_stance_extermination
		}
	}
	option = {
		name = hfe.55.8
		exclusive_trigger = {
			has_policy_flag = diplo_stance_purification
		}
	}
	option = {
		name = INTERESTING
	}
}

# presapient dolphin anomaly 60
ship_event = {
	id = hfe.60
	title = hfe.60.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.60.desc.0
				success_text = {
					text = hfe.60.desc.1.0
					has_country_flag = found_presapients
				}
				fail_text = {
					text = hfe.60.desc.1.1
					has_country_flag = found_presapients
				}
				text = hfe.60.desc.2
			}
		}
	}
	picture = GFX_evt_ocean
	location = from
	show_sound = event_default
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
			if = {
				limit = {
					root.owner = {
						hfe_trigger_is_human = yes
					}
				}
				# root = {
				# 	set_name = "[solar_system.GetName] Delphinidae"
				# }
				# TODO check if it work
				create_species = {
					name = "[solar_system.GetName] Delphinidae"
					class = PRE_MAM
					traits = {
						trait = hfe_species_trait_dolphin
					}
					homeworld = this
					sapient = no
				}
				# root = {
				# 	set_name = random
				# }
			}
			else = {
				create_species = {
					name = "Ksotry"
					class = PRE_MAM
					traits = {
						trait = hfe_species_trait_dolphin
					}
					homeworld = this
					sapient = no
				}
			}
			while = {
				count = 5
				create_pop = {
					species = last_created_species
				}
			}
		}
	}
	after = {
		hidden_effect = {
			owner = {
				set_country_flag = found_presapients
				country_event = {
					id = tutorial.57
					days = 5
				}
				country_event = {
					id = story.4
					days = 30
				}
			}
		}
	}
	option = {
		name = uplift.6000.a
		trigger = {
			owner = {
				has_technology = tech_epigenetic_triggers
			}
		}
	}
	option = {
		name = uplift.6000.b
		trigger = {
			owner = {
				not = {
					has_technology = tech_epigenetic_triggers
				}
			}
		}
	}
}

# varelse section 100 - 150
# varelse colony after survey 100
ship_event = {
	id = hfe.100
	title = hfe.100.name
	desc = hfe.100.desc
	picture = GFX_evt_hfe_varelse_planet
	location = root
	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		exists = from
		from = {
			has_planet_flag = hfe_varelse_colony
		}
		exists = from.owner
		from.owner = {
			is_country_type = primitive
		}
	}
	option = {
		name = hfe.100.0
		custom_tooltip = hfe.100.0_tooltip
	}
}

# observation outpost events
# varelse mehanicus
# start event
# Fires biannually
planet_event = {
	id = hfe.101
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = solar_system.owner
		has_observation_outpost = yes
	}
	immediate = {
		set_global_flag = hfe_varelse_mehanicus
		save_event_target_as = hfe_varelse_colony_target
		observation_outpost_owner = {
			country_event = {
				id = hfe.102
			}
		}
	}
}

# choice
country_event = {
	id = hfe.102
	title = hfe.102.name
	desc = hfe.102.desc
	picture = GFX_evt_hfe_varelse_planet
	show_sound = event_mystic_reveal
	location = event_target:hfe_varelse_colony_target
	is_triggered_only = yes
	# lets go to artifact
	option = {
		name = hfe.102.0
		custom_tooltip = hfe.102.0.tooltip
		hidden_effect = {
			country_event = {
				id = hfe.103
				days = 12
				random = 4
			}
		}
	}
	# lets go to factory
	option = {
		name = hfe.102.1
		custom_tooltip = hfe.102.1.tooltip
		hidden_effect = {
			if = {
				limit = {
					OR = {
						is_xenophobe = yes
						is_homicidal = yes
						has_civic = civic_barbaric_despoilers
					}
				}
				set_country_flag = hfe_plundered_godforge
			}
			country_event = {
				id = hfe.105
				days = 10
				random = 5
			}
		}
	}
	# lets revolt (materialist)
	option = {
		name = hfe.102.2
		allow = {
			is_materialist = yes
		}
		hidden_effect = {
			country_event = {
				id = hfe.107
				days = 100
				random = 20
			}
		}
	}
	# lets infiltrate and make them our friend
	option = {
		name = hfe.102.3
		custom_tooltip = hfe.102.3.tooltip
		allow = {
			is_xenophobe = no
			NOT = {
				has_ethic = ethic_fanatic_materialist
			}
		}
		hidden_effect = {
			country_event = {
				id = hfe.108
				days = 10
				random = 20
			}
		}
	}
	option = {
		name = hfe.102.4
		hfe_effect_add_influence.2 = yes
	}
}

# lets go to artifact
country_event = {
	id = hfe.103
	title = hfe.103.name
	desc = hfe.103.desc
	picture = GFX_evt_hfe_varelse_planet
	show_sound = event_mystic_reveal
	location = event_target:hfe_varelse_colony_planet
	is_triggered_only = yes
	option = {
		name = hfe_at_the_sreen
		hidden_effect = {
			country_event = {
				id = hfe.104
			}
		}
	}
}

# history of varelse
country_event = {
	id = hfe.104
	title = hfe.104.name
	desc = hfe.104.desc
	diplomatic = yes
	is_triggered_only = yes
	show_sound = event_screams
	picture_event_data = {
		room = hfe_varelse_room
	}
	option = {
		name = hfe.104.0
		response_text = hfe.104.0.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.104.1
		response_text = hfe.104.1.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.104.2
		response_text = hfe.104.2.response
		default_hide_option = yes
		hfe_effect_give_random_tech = yes
	}
}

# lets go to factory
country_event = {
	id = hfe.105
	title = hfe.105.name
	desc = {
		trigger = {
			text = hfe.105.desc.0
			success_text = {
				text = hfe.105.desc.1
				has_country_flag = hfe_plundered_godforge
			}
			text = hfe.105.desc.2
		}
	}
	picture = GFX_evt_hfe_varelse_planet
	show_sound = event_robo
	location = event_target:hfe_varelse_colony_planet
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				has_country_flag = hfe_plundered_godforge
			}
			event_target:hfe_varelse_colony_planet = {
				owner = {
					kill_leader = {
						ruler = yes
					}
					hfe_effect_primitive_down = yes
					set_country_flag = hfe_mechanicus_plundered
					set_country_flag = hfe_mechanicus_plundered@root
				}
				add_planet_devastation = 25
			}
		}
	}
	option = {
		name = hfe_good_job
		trigger = {
			NOT = {
				has_country_flag = hfe_plundered_godforge
			}
		}
	}
	option = {
		name = hfe.105.1
		trigger = {
			has_country_flag = hfe_plundered_godforge
		}
	}
	after = {
		add_resource = {
			minor_artifacts = 3
		}
		if = {
			limit = {
				has_country_flag = hfe_plundered_godforge
			}
			remove_country_flag = hfe_plundered_godforge
			play_sound = event_planetary_riot
			hfe_effect_xenophobe_attraction.3 = yes
			hfe_effect_add_society_research.2 = yes
			hfe_effect_add_engineering_research.2 = yes
		}
		else = {
			hfe_effect_add_engineering_research.2 = yes
		}
	}
}

# materialist result lets revolt
country_event = {
	id = hfe.107
	title = hfe.107.name
	desc = hfe.107.desc
	picture = GFX_evt_hfe_varelse_planet
	show_sound = event_planetary_riot
	location = event_target:hfe_varelse_colony_planet
	is_triggered_only = yes
	immediate = {
		event_target:hfe_varelse_colony_planet = {
			owner = {
				kill_leader = {
					ruler = yes
				}
				set_name = "Immortal Institute"
				hfe_effect_cleanse_ethics = yes
				country_add_ethic = ethic_fanatic_materialist
				country_add_ethic = ethic_militarist
				change_government = {
					authority = auth_oligarchic
					civics = {
						civic = civic_technocracy
						civic = hfe_civic_godforge_mat
					}
				}
				hfe_effect_primitive_up = yes
			}
		}
	}
	option = {
		name = hfe.107.0
		hfe_effect_materialist_attraction.3 = yes
		hfe_effect_add_society_research.3 = yes
	}
}

# lets infiltrate
country_event = {
	id = hfe.108
	title = hfe.108.name
	desc = hfe.108.desc
	picture = GFX_evt_hfe_varelse_planet
	show_sound = event_pre_ftl_civilization
	location = event_target:hfe_varelse_colony_planet
	is_triggered_only = yes
	option = {
		name = hfe_good_job
		hidden_effect = {
			event_target:hfe_varelse_colony_planet.owner = {
				set_country_flag = hfe_high_mechanicus_befriended@root
			}
		}
		# TODO fix it later
		# maybe switch type of ongoing outpost mission
		# if = {
		# 	limit = {
		# 		event_target:hfe_varelse_colony_planet = {
		# 			observation_outpost = {
		# 				has_mission = covert_infiltration
		# 			}
		# 		}
		# 	}
		# 	event_target:hfe_varelse_colony_planet = {
		# 		observation_outpost = {
		# 			add_mission_progress = 0.3
		# 		}
		# 	}
		# }
		# else_if = {
		# 	limit = {
		# 		event_target:hfe_varelse_colony_planet = {
		# 			observation_outpost = {
		# 				OR = {
		# 					has_mission = technological_enlightenment_1
		# 					has_mission = technological_enlightenment_2
		# 					has_mission = technological_enlightenment_3
		# 					has_mission = technological_enlightenment_4
		# 					has_mission = technological_enlightenment_5
		# 					has_mission = technological_enlightenment_6
		# 					has_mission = technological_enlightenment_7
		# 					has_mission = technological_enlightenment_8
		# 					has_mission = technological_enlightenment_9
		# 				}
		# 			}
		# 		}
		# 	}
		# 	event_target:hfe_varelse_colony_planet = {
		# 		observation_outpost = {
		# 			add_mission_progress = 0.6
		# 		}
		# 	}
		# }
		hfe_effect_add_influence.1 = yes
	}
}

# memorial section 150 - 350
# pyramid events 150 - 200
# start
planet_event = {
	id = hfe.150
	title = hfe.150.name
	desc = hfe.150.desc
	picture = GFX_evt_hfe_temple
	show_sound = event_mystic_reveal
	location = root
	trackable = yes
	is_triggered_only = yes
	pre_triggers = {
		has_ground_combat = no
	}
	trigger = {
		is_planet_class = hfe_pc_memorial
		exists = owner
		num_pops > 0
		not = {
			has_planet_flag = hfe_memorial_pyramid
		}
	}
	immediate = {
		set_planet_flag = hfe_memorial_pyramid
	}
	option = {
		name = hfe.150.0
		# add_building = building_great_pyramid
		hidden_effect = {
			save_event_target_as = hfe_memorial_planet
		}
		enable_special_project = {
			name = hfe_project_pyramid
			location = root
			owner = root.owner
		}
	}
	option = {
		name = hfe_not_interested
	}
}

# golocube
ship_event = {
	id = hfe.151
	title = hfe.151.name
	desc = hfe.151.desc
	picture = GFX_evt_hfe_temple
	show_sound = event_mystic_reveal
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	option = {
		name = hfe.151.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		hidden_effect = {
			owner = {
				country_event = {
					id = hfe.152
				}
				set_country_flag = hfe_has_event.151
			}
		}
	}
}

# memorial story
country_event = {
	id = hfe.152
	title = hfe.152.name
	desc = {
		trigger = {
			fail_text = {
				text = hfe.152.desc.0
				has_country_flag = hfe.152.0
			}
			success_text = {
				text = hfe.152.desc.1
				has_country_flag = hfe.152.0
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = hfe_memorial_story_room
	}
	option = {
		name = hfe.152.0
		trigger = {
			not = {
				has_country_flag = hfe.152.0
			}
		}
		hidden_effect = {
			set_country_flag = hfe.152.0
			country_event = {
				id = hfe.152
			}
		}
	}
	option = {
		name = hfe.152.1
		trigger = {
			has_country_flag = hfe.152.0
		}
		default_hide_option = yes
		hidden_effect = {
			create_leader = {
				class = official
				species = event_target:hfe_egypt_species
				leader_age_min = 50
				leader_age_max = 650
				skill = 4
				event_leader = yes
				effect = {
					add_trait = hfe_leader_trait_brainwashed
				}
			}
			remove_country_flag = hfe.152.0
		}
	}
	option = {
		name = hfe.152.2
		trigger = {
			has_country_flag = hfe.152.0
		}
		hidden_effect = {
			create_leader = {
				class = scientist
				species = event_target:hfe_egypt_species
				leader_age_min = 50
				leader_age_max = 650
				skill = 4
				event_leader = yes
				effect = {
					add_trait = hfe_leader_trait_brainwashed
				}
			}
			remove_country_flag = hfe.152.0
		}
	}
	option = {
		name = hfe.152.3
		trigger = {
			has_country_flag = hfe.152.0
		}
		hidden_effect = {
			create_leader = {
				class = commander
				species = event_target:hfe_egypt_species
				leader_age_min = 50
				leader_age_max = 650
				skill = 4
				event_leader = yes
				effect = {
					add_trait = hfe_leader_trait_brainwashed
				}
			}
			remove_country_flag = hfe.152.0
		}
	}
	option = {
		name = hfe.152.4
		trigger = {
			has_country_flag = hfe.152.0
		}
		hfe_effect_add_society_research.4 = yes
		hfe_effect_materialist_attraction.0 = yes
		remove_country_flag = hfe.152.0
	}
	option = {
		name = hfe.152.5
		trigger = {
			has_country_flag = hfe.152.0
		}
		hfe_effect_spiritualist_attraction.4 = yes
		remove_country_flag = hfe.152.0
	}
	# add no brainwashing and hive options
}

# obelisk
ship_event = {
	id = hfe.153
	title = hfe.153.name
	desc = hfe.153.desc
	picture = GFX_evt_hfe_obelisk
	show_sound = event_mystic_reveal
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.153
		}
		# need to rewrite it
		event_target:hfe_memorial_planet = {
			create_country = {
				name = Gnosis
				type = faction
				species = root.owner
				effect = {
					establish_communications_no_message = root.owner
				}
			}
			create_army = {
				name = Gnosis
				owner = last_created_country
				type = titanic_guardian_army
			}
			create_army = {
				name = Gnosis
				owner = last_created_country
				type = titanic_assault_army
			}
			create_army = {
				name = Gnosis
				owner = last_created_country
				type = titanic_assault_army
			}
		}
	}
	option = {
		name = hfe.153.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
	}
}

# mutant cloud
ship_event = {
	id = hfe.154
	title = hfe.154.name
	desc = hfe.154.desc
	picture = GFX_evt_hfe_city_cloud
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.154
		}
		event_target:hfe_memorial_planet = {
			planet_event = {
				id = hfe.155
				days = 15
			}
		}
	}
	option = {
		name = hfe.155.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
	}
}

# lets mutate
planet_event = {
	id = hfe.155
	title = hfe.154.name
	desc = hfe.155.desc
	picture = GFX_evt_hfe_city_cloud
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		every_owned_pop = {
			limit = {
				hfe_trigger_is_robot = no
			}
			modify_species = {
				add_trait = hfe_species_trait_test
			}
		}
		random_owned_pop = {
			limit = {
				has_trait = hfe_species_trait_test
			}
			species = {
				mutate_species = yes
			}
		}
		every_owned_pop = {
			limit = {
				has_trait = hfe_species_trait_test
			}
			modify_species = {
				remove_trait = hfe_species_trait_test
			}
		}
	}
	option = {
		name = hfe.155.0
		custom_tooltip = hfe.155.tooltip
	}
}

# tomb
ship_event = {
	id = hfe.156
	title = hfe.156.name
	desc = hfe.156.desc
	picture = GFX_evt_hfe_strange_tech
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.156
		}
	}
	option = {
		name = hfe.156.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		hidden_effect = {
			owner = {
				hfe_effect_media_random = yes
			}
		}
	}
}

# military warehouse events 200 - 250
# start
planet_event = {
	id = hfe.200
	title = hfe.200.name
	desc = hfe.200.desc
	picture = GFX_evt_hfe_weapon_storage
	show_sound = event_mystic_reveal
	location = root
	trackable = yes
	is_triggered_only = yes
	pre_triggers = {
		has_ground_combat = no
	}
	trigger = {
		is_planet_class = hfe_pc_memorial
		exists = owner
		num_pops > 0
		not = {
			has_planet_flag = hfe_memorial_warehouse
		}
	}
	immediate = {
		set_planet_flag = hfe_memorial_warehouse
	}
	option = {
		name = hfe.200.0
		hidden_effect = {
			save_event_target_as = hfe_memorial_planet
		}
		enable_special_project = {
			name = hfe_project_military_warehouse
			location = root
			owner = root.owner
		}
	}
	option = {
		name = hfe_not_interested
	}
}

# defense system
ship_event = {
	id = hfe.201
	title = hfe.201.name
	desc = hfe.201.desc
	picture = GFX_evt_hfe_weapon_storage_2
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.201
		}
	}
	option = {
		name = hfe.201.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		event_target:hfe_memorial_planet = {
			add_modifier = {
				modifier = hfe_army_planet_defense_damage_mult
			}
		}
	}
}

# abandoned armory
ship_event = {
	id = hfe.202
	title = hfe.202.name
	desc = hfe.202.desc
	picture = GFX_evt_engineering_research
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.202
		}
	}
	option = {
		name = hfe.202.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			add_modifier = {
				modifier = hfe_army_attack_damage_mult
			}
		}
	}
}

# abandoned librariy
ship_event = {
	id = hfe.203
	title = hfe.203.name
	desc = hfe.203.desc
	picture = GFX_evt_hfe_library_old
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.203
		}
	}
	option = {
		name = hfe.203.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			add_modifier = {
				modifier = hfe_army_defense_damage_mult
			}
		}
	}
}

# abandoned military academy
ship_event = {
	id = hfe.204
	title = hfe.204.name
	desc = hfe.204.desc
	picture = GFX_evt_hfe_weapon_storage
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.204
		}
	}
	option = {
		name = hfe.204.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		event_target:hfe_memorial_planet = {
			add_modifier = {
				modifier = hfe_army_academy
			}
		}
	}
}

# explosion of the warehouse
country_event = {
	id = hfe.205
	title = hfe.205.name
	desc = {
		trigger = {
			success_text = {
				text = hfe.205.desc.1.0
				# should simplify this trigger i guess
				or = {
					has_country_flag = hfe_random_0
					has_country_flag = hfe_random_1
					has_country_flag = hfe_random_2
				}
			}
			# scientist survived
			success_text = {
				text = hfe.205.desc.1.0
				has_country_flag = hfe_random_0
			}
			# scientist dead
			success_text = {
				text = hfe.205.desc.1.1
				has_country_flag = hfe_random_1
			}
			# scientist wounded
			success_text = {
				text = hfe.205.desc.1.2
				has_country_flag = hfe_random_2
			}
			# scientist recovered
			success_text = {
				text = hfe.205.desc.2
				nor = {
					has_country_flag = hfe_random_0
					has_country_flag = hfe_random_1
					has_country_flag = hfe_random_2
				}
			}
		}
	}
	picture = GFX_evt_hfe_explosion
	show_sound = event_ship_explosion
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	immediate = {
		set_country_flag = hfe_has_event.205
	}
	option = {
		name = hfe.205.0
		exclusive_trigger = {
			has_country_flag = hfe_random_0
		}
	}
	option = {
		name = hfe.205.1
		exclusive_trigger = {
			has_country_flag = hfe_random_1
		}
		hidden_effect = {
			event_target:hfe_fleet = {
				kill_leader = {
					class = scientist
				}
			}
		}
	}
	option = {
		name = hfe.205.2
		exclusive_trigger = {
			has_country_flag = hfe_random_2
		}
		hidden_effect = {
			event_target:hfe_fleet = {
				exile_leader_as = hfe_scientist_wounded
			}
			country_event = {
				id = hfe.205
				days = 60
				random = 120
			}
		}
	}
	option = {
		name = hfe.205.3
		hidden_effect = {
			if = {
				limit = {
					exists = event_target:hfe_fleet
					event_target:hfe_fleet = {
						not = {
							exists = leader
						}
					}
				}
				event_target:hfe_fleet = {
					set_leader = hfe_scientist_wounded
					leader = {
						save_event_target_as = hfe_205_scientist
					}
				}
			}
			else = {
				create_fleet = {
					effect = {
						set_owner = root
						create_ship = {
							random_existing_design = science
						}
						set_location = root.capital_scope
						set_leader = hfe_scientist_wounded
						leader = {
							save_event_target_as = hfe_205_scientist
							unassign_leader = this
						}
						delete_fleet = this
					}
				}
			}
		}
		event_target:hfe_205_scientist = {
			add_trait = leader_trait_resilient
		}
	}
}

# scientific bonus of the warehouse
ship_event = {
	id = hfe.206
	title = hfe.206.name
	desc = hfe.206.desc
	picture = GFX_evt_hfe_weapon_storage
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.206
		}
	}
	option = {
		name = hfe.206.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_give_random_tech = yes
		}
	}
}

# dr moro
ship_event = {
	id = hfe.207
	title = hfe.207.name
	desc = hfe.207.desc
	picture = GFX_evt_hfe_weapon_storage
	show_sound = event_alien_nature
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.207
		}
	}
	option = {
		name = hfe.207.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_media_negative = yes
		}
	}
}

# found cruiser 250 - 300
# start
planet_event = {
	id = hfe.250
	title = hfe.250.name
	desc = hfe.250.desc
	picture = GFX_evt_hfe_ship_old
	show_sound = event_mystic_reveal
	location = root
	trackable = yes
	is_triggered_only = yes
	pre_triggers = {
		has_ground_combat = no
	}
	trigger = {
		is_planet_class = hfe_pc_memorial
		exists = owner
		num_pops > 0
		not = {
			has_planet_flag = hfe_memorial_cruiser
		}
	}
	immediate = {
		set_planet_flag = hfe_memorial_cruiser
	}
	option = {
		name = hfe.250.0
		hidden_effect = {
			save_event_target_as = hfe_memorial_planet
		}
		enable_special_project = {
			name = hfe_project_found_cruiser
			location = root
			owner = root.owner
		}
	}
	option = {
		name = hfe_not_interested
	}
}

# rotten skeleton
ship_event = {
	id = hfe.251
	title = hfe.251.name
	desc = hfe.251.desc
	picture = GFX_evt_hfe_ship_old
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.251
		}
	}
	option = {
		name = hfe.251.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_add_minerals.2 = yes
		}
	}
	option = {
		name = hfe.251.1
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_add_energy.2 = yes
		}
	}
	option = {
		name = hfe.251.2
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_add_physics_research.2 = yes
		}
	}
}

# explosion on the cruiser scientist dead
ship_event = {
	id = hfe.252
	title = hfe.252.name
	desc = hfe.252.desc
	picture = GFX_evt_archaeological_dig
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.252
		}
	}
	option = {
		name = hfe.252.0
		hidden_effect = {
			kill_leader = {
				class = scientist
			}
		}
	}
}

# runaway cruiser
ship_event = {
	id = hfe.253
	title = hfe.253.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.253.desc.0
				fail_text = {
					text = hfe.253.desc.1.0
					has_country_flag = hfe_egypt_contacted
				}
				success_text = {
					text = hfe.253.desc.1.1
					has_country_flag = hfe_egypt_contacted
				}
			}
		}
	}
	picture = GFX_evt_hfe_ship
	show_sound = event_ship_thrusters
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.253
		}
		create_country = {
			name = "Bizarre Titanic Cruiser"
			type = neutral_faction
			species = root.owner
			effect = {
				establish_communications_no_message = root.owner
				#		set_faction_hostility = {
				#			set_hostile = no
				#		}
				create_fleet = {
					name = "Bizarre Titanic Cruiser"
					effect = {
						#save_event_target_as = hfe_cruiser # ??????, ???? ???????? / owner
						set_owner = event_target:hfe_egypt_country
						create_ship = {
							random_existing_design = titan
							prefix = no
						}
						set_owner = prev
						set_location = root
						set_fleet_stance = aggressive
						queue_actions = {
							find_closest_system = {
								trigger = {
									id = hfe.253.trigger.0
									any_system_planet = {
										has_planet_flag = hfe_varelse_colony
									}
								}
								found_system = {
									move_to = this
								}
							}
							find_closest_planet = {
								trigger = {
									id = hfe.253.trigger.1
									has_planet_flag = hfe_varelse_colony
								}
								found_planet = {
									orbit_planet = this
									effect = {
										id = hfe.253.effect.0
										# TODO need test it
										prev.owner = {
											set_faction_hostility = {
												set_hostile = yes
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = hfe.253.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
	}
}

# cruiser became aggressive
ship_event = {
	id = hfe.254
	title = hfe.254.name
	desc = hfe.254.desc
	picture = GFX_evt_hfe_ship
	show_sound = event_ship_thrusters
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.254
		}
		create_country = {
			name = "Mad Cruiser"
			type = hfe_berserk
			species = root.owner
			effect = {
				every_country = {
					establish_communications_no_message = prev
				}
				create_fleet = {
					name = "Mad Cruiser"
					effect = {
						set_owner = event_target:hfe_egypt_country
						create_ship = {
							random_existing_design = titan
							prefix = no
						}
						set_owner = prev
						set_fleet_stance = aggressive
						set_location = root
					}
				}
			}
		}
	}
	option = {
		name = hfe.254.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
	}
}

# love is
ship_event = {
	id = hfe.255
	title = hfe.255.name
	desc = hfe.255.desc
	picture = GFX_evt_hfe_ship_new
	show_sound = event_ship_thrusters
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.255
		}
		create_fleet = {
			name = "Marvin"
			effect = {
				set_owner = event_target:hfe_egypt_country
				create_ship = {
					name = "Marvin"
					random_existing_design = titan
				}
				set_owner = root.owner
				set_fleet_stance = aggressive
				set_location = root
			}
		}
	}
	option = {
		name = hfe.255.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
	}
}

# sputnik 300 - 350
# start
planet_event = {
	id = hfe.300
	title = hfe.300.name
	desc = hfe.300.desc
	picture = GFX_evt_hfe_satellite_in_orbit
	show_sound = event_mystic_reveal
	location = root
	trackable = yes
	is_triggered_only = yes
	pre_triggers = {
		has_ground_combat = no
	}
	trigger = {
		is_planet_class = hfe_pc_memorial
		exists = owner
		owner = {
			nand = {
				has_country_flag = hfe_has_event.301
				has_country_flag = hfe_has_event.302
				has_country_flag = hfe_has_event.304
			}
		}
		num_pops > 0
		not = {
			has_planet_flag = hfe_memorial_sputnik
		}
	}
	immediate = {
		set_planet_flag = hfe_memorial_sputnik
	}
	option = {
		name = hfe.300.0
		hidden_effect = {
			save_event_target_as = hfe_memorial_planet
		}
		enable_special_project = {
			name = hfe_project_sputnik
			location = root
			owner = root.owner
		}
	}
	option = {
		name = hfe_not_interested
	}
}

# bonus to the sensors
ship_event = {
	id = hfe.301
	title = hfe.301.name
	desc = hfe.301.desc
	picture = GFX_evt_hfe_satellite_in_orbit
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.301
		}
	}
	option = {
		name = hfe.301.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		event_target:hfe_memorial_planet = {
			add_modifier = {
				modifier = hfe_planet_sensor_range_mult
			}
		}
	}
}

# go to another events
ship_event = {
	id = hfe.302
	title = hfe.302.name
	desc = hfe.302.desc
	picture = GFX_evt_hfe_satellite_in_orbit
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.302
		}
	}
	option = {
		name = hfe.302.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		hidden_effect = {
			event_target:hfe_memorial_planet = {
				random_list = {
					33 = {
						modifier = {
							factor = 0
							has_planet_flag = hfe_memorial_pyramid
						}
						planet_event = {
							id = hfe.150
							days = 1
							random = 10
						}
					}
					33 = {
						modifier = {
							factor = 0
							has_planet_flag = hfe_memorial_warehouse
						}
						planet_event = {
							id = hfe.200
							days = 1
							random = 10
						}
					}
					33 = {
						modifier = {
							factor = 0
							has_planet_flag = hfe_memorial_cruiser
						}
						planet_event = {
							id = hfe.250
							days = 1
							random = 10
						}
					}
					1 = {
						root = {
							ship_event = {
								id = hfe.303
								days = 15
								random = 10
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = hfe.302.1
	}
}

# go to nothing
ship_event = {
	id = hfe.303
	title = hfe.303.name
	desc = hfe.303.desc
	picture = GFX_evt_hfe_satellite_in_orbit
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	option = {
		name = hfe.303.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_add_engineering_research.1 = yes
		}
	}
}

# engineering bonus
ship_event = {
	id = hfe.304
	title = hfe.304.name
	desc = hfe.304.desc
	picture = GFX_evt_hfe_satellite_in_orbit
	show_sound = event_airlock
	location = event_target:hfe_memorial_planet
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		owner = {
			set_country_flag = hfe_has_event.304
		}
	}
	option = {
		name = hfe.304.0
		hfe_effect_leader_add_exp = {
			hfe_exp = 100
		}
		owner = {
			hfe_effect_add_engineering_research.3 = yes
		}
	}
}

# find sol 350
fleet_event = {
	id = hfe.350
	title = hfe.350.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.350.desc.0
				success_text = {
					text = hfe.350.desc.1.0
					hfe_trigger_is_human = yes
				}
				fail_text = {
					text = hfe.350.desc.1.1
					hfe_trigger_is_human = yes
				}
				success_text = {
					text = hfe.350.desc.2.0
					exists = event_target:hfe_earth
					event_target:hfe_earth = {
						not = {
							is_planet_class = pc_nuked
						}
						or = {
							not = {
								exists = owner
							}
							owner = {
								is_country_type = primitive
							}
						}
					}
				}
				success_text = {
					text = hfe.350.desc.2.1
					exists = event_target:hfe_earth
					event_target:hfe_earth = {
						is_planet_class = pc_nuked
					}
				}
			}
		}
	}
	picture = GFX_evt_hfe_sol_system
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = {
			has_event_chain = hfe_chain_find_sol
		}
		exists = from
		from = {
			has_star_flag = hfe_sol_target@root.owner
		}
	}
	immediate = {
		from = {
			remove_star_flag = hfe_sol_target@root.owner
		}
		owner = {
			end_event_chain = hfe_chain_find_sol
		}
	}
	option = {
		name = hfe.350.0
		trigger = {
			owner = {
				hfe_trigger_is_human = yes
			}
			from = {
				not = {
					has_star_flag = nuked_sol
				}
			}
		}
		owner = {
			hfe_effect_add_influence.2 = yes
		}
	}
	option = {
		name = hfe.350.1
		trigger = {
			from = {
				has_star_flag = nuked_sol
			}
		}
		owner = {
			hfe_effect_add_influence.2 = yes
		}
	}
	option = {
		name = hfe.350.1
		trigger = {
			owner = {
				is_xenophile = yes
				is_authoritarian = no
				hfe_trigger_is_human = no
			}
			from = {
				not = {
					has_star_flag = nuked_sol
				}
			}
		}
		owner = {
			hfe_effect_xenophile_attraction.0 = yes
			hfe_effect_add_influence.2 = yes
		}
	}
	option = {
		name = hfe.350.2
		trigger = {
			owner = {
				is_xenophile = yes
				is_authoritarian = yes
				hfe_trigger_is_human = no
			}
			from = {
				not = {
					has_star_flag = nuked_sol
				}
			}
		}
		owner = {
			hfe_effect_xenophile_attraction.0 = yes
			hfe_effect_authoritarian_attraction.0 = yes
			hfe_effect_add_influence.2 = yes
		}
	}
}

# abort chain if contacted with sol owner 351
country_event = {
	id = hfe.351
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_event_chain = hfe_chain_find_sol
		exists = from
		from = {
			or = {
				has_country_flag = human_1
				event_target:hfe_earth = {
					is_owned_by = prev
				}
			}
		}
	}
	immediate = {
		end_event_chain = hfe_chain_find_sol
		random_system = {
			limit = {
				has_star_flag = hfe_sol_target@root
			}
			remove_star_flag = hfe_sol_target@root
		}
	}
}

# copernicus event 355 - 365
# enter system
# ? ?????? ??????? ????? ???? ??????????? ??? ?????????? ??????? ???????
ship_event = {
	id = hfe.355
	title = hfe.355.name
	desc = {
		trigger = {
			text = hfe.355.desc.0
			fail_text = {
				text = hfe.355.desc.1.0
				exists = event_target:hfe_copernicus_owner
			}
			success_text = {
				text = hfe.355.desc.1.1
				exists = event_target:hfe_copernicus_owner
			}
		}
	}
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			has_star_flag = hfe_copernicus
		}
		exists = owner
		owner = {
			or = {
				is_ai = no
				is_country_type = default
			}
		}
	}
	immediate = {
		from = {
			save_global_event_target_as = hfe_copernicus
			random_system_planet = {
				limit = {
					has_planet_flag = hfe_copernicus.0
				}
				if = {
					limit = {
						is_surveyed = {
							who = root.owner
							status = yes
						}
					}
					if = {
						limit = {
							exists = solar_system.owner
						}
						solar_system.owner = {
							save_event_target_as = hfe_copernicus_owner
						}
					}
				}
				else = {
					begin_event_chain = {
						event_chain = hfe_chain_copernicus
						target = root.owner
					}
					if = {
						limit = {
							exists = owner
							owner = {
								is_country_type = primitive
							}
						}
						owner = {
							species = {
								# TODO check if ok without global target
								save_global_event_target_as = hfe_copernicus_species
							}
						}
						root.owner = {
							set_country_flag = hfe_copernicus_has_primitive
						}
					}
				}
			}
		}
	}
	option = {
		name = hfe.355.0
		trigger = {
			owner = {
				has_event_chain = hfe_chain_copernicus
			}
		}
		tooltip = {
			begin_event_chain = {
				event_chain = hfe_chain_copernicus
				target = root.owner
			}
		}
	}
	option = {
		name = hfe.355.1
		trigger = {
			owner = {
				not = {
					has_event_chain = hfe_chain_copernicus
				}
			}
		}
		tooltip = {
			owner = {
				end_event_chain = hfe_chain_copernicus
			}
		}
	}
}

# scan planet
ship_event = {
	id = hfe.356
	title = hfe.356.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.356.desc.0
				success_text = {
					text = hfe.356.desc.1
					has_country_flag = hfe_copernicus_has_primitive
				}
				success_text = {
					text = hfe.356.desc.2
					has_country_flag = hfe_copernicus_has_primitive
					has_completed_event_chain_counter = {
						event_chain = hfe_chain_copernicus
						counter = hfe_scans
					}
				}
			}
		}
	}
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			has_planet_flag = hfe_copernicus.0
		}
		exists = owner
		owner = {
			has_event_chain = hfe_chain_copernicus
		}
	}
	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = hfe_chain_copernicus
				counter = hfe_scans
				amount = 1
			}
		}
	}
	option = {
		name = INTERESTING
		hidden_effect = {
			owner = {
				if = {
					limit = {
						has_completed_event_chain_counter = {
							event_chain = hfe_chain_copernicus
							counter = hfe_scans
						}
					}
					country_event = {
						id = hfe.359
						days = 5
					}
				}
			}
		}
	}
}

# scan asteroid
ship_event = {
	id = hfe.357
	title = hfe.357.name
	desc = {
		trigger = {
			text = hfe.357.desc.0
			success_text = {
				text = hfe.357.desc.1
				owner = {
					has_country_flag = hfe_copernicus_has_primitive
					has_completed_event_chain_counter = {
						event_chain = hfe_chain_copernicus
						counter = hfe_scans
					}
				}
			}
		}
	}
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			has_planet_flag = hfe_copernicus.1
		}
		exists = owner
		owner = {
			has_event_chain = hfe_chain_copernicus
		}
	}
	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = hfe_chain_copernicus
				counter = hfe_scans
				amount = 1
			}
		}
	}
	option = {
		name = CURIOUS
		hidden_effect = {
			owner = {
				if = {
					limit = {
						has_completed_event_chain_counter = {
							event_chain = hfe_chain_copernicus
							counter = hfe_scans
						}
					}
					country_event = {
						id = hfe.359
						days = 5
					}
				}
			}
		}
	}
}

# scan star
ship_event = {
	id = hfe.358
	title = hfe.358.name
	desc = hfe.358.desc
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			has_planet_flag = hfe_copernicus.2
		}
		exists = owner
		owner = {
			has_event_chain = hfe_chain_copernicus
		}
	}
	option = {
		name = ASTOUNDING
	}
}

# start project
country_event = {
	id = hfe.359
	title = hfe.359.name
	desc = hfe.359.desc
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	trackable = yes
	is_triggered_only = yes
	trigger = {
		not = {
			has_special_project = hfe_project_copernicus
		}
	}
	immediate = {
		enable_special_project = {
			name = hfe_project_copernicus
			location = root.capital_scope
			owner = root
		}
	}
	option = {
		name = hfe.359.0
		tooltip = {
			enable_special_project = {
				name = hfe_project_copernicus
				location = root.capital_scope
				owner = root
			}
		}
	}
}

# project complete
country_event = {
	id = hfe.360
	title = hfe.360.name
	desc = {
		trigger = {
			text = hfe.360.desc.0
			success_text = {
				text = hfe.360.desc.1.0
				has_country_flag = hfe_copernicus_has_primitive
			}
			fail_text = {
				text = hfe.360.desc.1.1
				has_country_flag = hfe_copernicus_has_primitive
			}
			success_text = {
				text = hfe.360.desc.2.0
				has_country_flag = hfe_egypt_contacted
			}
			fail_text = {
				text = hfe.360.desc.2.1
				has_country_flag = hfe_egypt_contacted
			}
			success_text = {
				text = hfe.360.desc.3.0
				is_xenophile = yes
			}
			success_text = {
				text = hfe.360.desc.3.1
				is_xenophobe = yes
			}
			success_text = {
				text = hfe.360.desc.4
				has_country_flag = hfe_copernicus_has_primitive
			}
		}
	}
	picture = GFX_evt_hfe_copernicus
	show_sound = event_scanner
	is_triggered_only = yes
	option = {
		name = AMAZING
		hfe_effect_add_influence.2 = yes
		end_event_chain = hfe_chain_copernicus
		hidden_effect = {
			remove_country_flag = hfe_copernicus_has_primitive
		}
	}
}

# observation outpost event
# start
planet_event = {
	id = hfe.361
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			or = {
				has_mission = passive_observation
				has_mission = specimen_collection
				# has_mission = technological_enlightenment_1
				# has_mission = technological_enlightenment_2
				# has_mission = technological_enlightenment_3
				# has_mission = technological_enlightenment_4
				# has_mission = technological_enlightenment_5
				# has_mission = technological_enlightenment_6
				# has_mission = technological_enlightenment_7
				# has_mission = technological_enlightenment_8
				# has_mission = technological_enlightenment_9
			}
		}
		not = {
			has_planet_flag = hfe_has_event.362
		}
		observation_outpost_owner = {
			not = {
				has_country_flag = hfe_has_event.362
			}
		}
	}
	immediate = {
		observation_outpost_owner = {
			country_event = {
				id = hfe.362
			}
		}
	}
}

country_event = {
	id = hfe.362
	title = hfe.362.name
	desc = {
		trigger = {
			hidden:from = {
				observation_outpost = {
					success_text = {
						text = hfe.362.desc.0
						has_mission = passive_observation
					}
					success_text = {
						text = hfe.362.desc.1
						has_mission = specimen_collection
					}
					# TODO fix it later
					# success_text = {
					# 	text = hfe.362.desc.2
					# 	or = {
					# 		has_mission = technological_enlightenment_1
					# 		has_mission = technological_enlightenment_2
					# 		has_mission = technological_enlightenment_3
					# 		has_mission = technological_enlightenment_4
					# 		has_mission = technological_enlightenment_5
					# 		has_mission = technological_enlightenment_6
					# 		has_mission = technological_enlightenment_7
					# 		has_mission = technological_enlightenment_8
					# 		has_mission = technological_enlightenment_9
					# 	}
					# }
				}
			}
		}
	}
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	is_triggered_only = yes
	immediate = {
		set_country_flag = hfe_has_event.362
	}
	# return
	option = {
		name = hfe.362.0
		trigger = {
			is_xenophobe = no
			from = {
				observation_outpost = {
					has_mission = passive_observation
				}
			}
		}
		hfe_effect_xenophile_attraction.2 = yes
	}
	# use
	option = {
		name = hfe.362.1
		trigger = {
			is_xenophile = no
			from = {
				observation_outpost = {
					has_mission = passive_observation
				}
			}
		}
		hfe_effect_add_engineering_research.3 = yes
		hidden_effect = {
			from = {
				set_planet_flag = hfe_has_event.362
				set_global_flag = hfe_has_event.362
			}
		}
	}
	# good job
	option = {
		name = hfe_good_job
		trigger = {
			from = {
				observation_outpost = {
					has_mission = specimen_collection
				}
			}
		}
		hfe_effect_add_engineering_research.3 = yes
		hidden_effect = {
			from = {
				set_planet_flag = hfe_has_event.362
				set_global_flag = hfe_has_event.362
			}
		}
	}
	# TODO fix it later
	# option = {
	# 	name = hfe_good_job
	# 	trigger = {
	# 		from = {
	# 			observation_outpost = {
	# 				or = {
	# 					has_mission = technological_enlightenment_1
	# 					has_mission = technological_enlightenment_2
	# 					has_mission = technological_enlightenment_3
	# 					has_mission = technological_enlightenment_4
	# 					has_mission = technological_enlightenment_5
	# 					has_mission = technological_enlightenment_6
	# 					has_mission = technological_enlightenment_7
	# 					has_mission = technological_enlightenment_8
	# 					has_mission = technological_enlightenment_9
	# 				}
	# 			}
	# 		}
	# 	}
	# 	hfe_effect_add_engineering_research.3 = yes
	# 	from = {
	# 		observation_outpost = {
	# 			add_mission_progress = 0.5
	# 		}
	# 	}
	# 	hidden_effect = {
	# 		from = {
	# 			set_planet_flag = hfe_has_event.362
	# 			set_global_flag = hfe_has_event.362
	# 		}
	# 	}
	# }
}

# then gain planet
planet_event = {
	id = hfe.363
	title = hfe.362.name
	desc = hfe.363.desc
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	is_triggered_only = yes
	trigger = {
		has_planet_flag = hfe_copernicus.0
		not = {
			has_planet_flag = hfe_has_event.362
		}
		exists = owner
	}
	immediate = {
		set_planet_flag = hfe_has_event.362
	}
	option = {
		name = hfe_good_job
		owner = {
			hfe_effect_add_engineering_research.3 = yes
			hidden_effect = {
				set_country_flag = hfe_has_event.362
				set_global_flag = hfe_has_event.362
			}
		}
	}
}

# ahet events section 400 - 401
# ahet colonys after survey
# ?olony 1 400
ship_event = {
	id = hfe.400
	title = hfe.400.name
	desc = {
		trigger = {
			hidden:owner = {
				success_text = {
					text = hfe.400.desc.0
					has_country_flag = hfe_ahet_found
					has_country_flag = hfe_egypt_contacted
				}
				success_text = {
					text = hfe.400.desc.1
					has_country_flag = hfe_ahet_found
					not = {
						has_country_flag = hfe_egypt_contacted
					}
				}
				success_text = {
					text = hfe.400.desc.2
					not = {
						has_country_flag = hfe_ahet_found
					}
					has_country_flag = hfe_egypt_contacted
				}
				success_text = {
					text = hfe.400.desc.3
					nor = {
						has_country_flag = hfe_ahet_found
						has_country_flag = hfe_egypt_contacted
					}
				}
			}
		}
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_0
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_1
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle_2
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_2
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle_3
	}
	location = from
	is_triggered_only = yes
	trigger = {
		exists = owner
		exists = from.owner
		from = {
			has_planet_flag = hfe_ahet_colony_0
			owner = {
				is_country_type = primitive
			}
		}
	}
	immediate = {
		owner = {
			hfe_effect_random_roll_flags_3_country = yes
		}
	}
	option = {
		name = hfe.400.0
		trigger = {
			owner = {
				has_country_flag = hfe_ahet_found
			}
		}
	}
	option = {
		name = hfe.400.1
		trigger = {
			owner = {
				is_materialist = no
			}
		}
	}
	option = {
		name = hfe.400.2
		trigger = {
			owner = {
				is_materialist = yes
			}
		}
		owner = {
			hfe_effect_materialist_attraction.0 = yes
		}
	}
	after = {
		hidden_effect = {
			owner = {
				set_country_flag = hfe_ahet_found
			}
		}
	}
}

# colony 2 401
ship_event = {
	id = hfe.401
	title = hfe.401.name
	desc = {
		trigger = {
			hidden:owner = {
				success_text = {
					text = hfe.401.desc.0
					has_country_flag = hfe_ahet_found
					has_country_flag = hfe_egypt_contacted
				}
				success_text = {
					text = hfe.401.desc.1
					has_country_flag = hfe_ahet_found
					not = {
						has_country_flag = hfe_egypt_contacted
					}
				}
				success_text = {
					text = hfe.401.desc.2
					not = {
						has_country_flag = hfe_ahet_found
					}
					has_country_flag = hfe_egypt_contacted
				}
				success_text = {
					text = hfe.401.desc.3
					nor = {
						has_country_flag = hfe_ahet_found
						has_country_flag = hfe_egypt_contacted
					}
				}
			}
		}
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_0
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_1
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle_2
	}
	picture = {
		trigger = {
			owner = {
				has_country_flag = hfe_random_2
			}
		}
		picture = GFX_evt_hfe_ship_old_jungle_3
	}
	location = from
	is_triggered_only = yes
	trigger = {
		exists = owner
		exists = from.owner
		from = {
			has_planet_flag = hfe_ahet_colony_1
			owner = {
				is_country_type = primitive
			}
		}
	}
	immediate = {
		owner = {
			hfe_effect_random_roll_flags_3_country = yes
		}
	}
	option = {
		name = hfe.401.0
		trigger = {
			owner = {
				has_country_flag = hfe_ahet_found
			}
		}
	}
	option = {
		name = hfe.401.1
		trigger = {
			owner = {
				is_xenophile = yes
			}
		}
		owner = {
			hfe_effect_xenophile_attraction.0 = yes
		}
	}
	option = {
		name = hfe.401.2
		trigger = {
			owner = {
				is_xenophobe = yes
			}
		}
		owner = {
			hfe_effect_xenophobe_attraction.0 = yes
		}
	}
	option = {
		name = hfe.401.3
		trigger = {
			owner = {
				is_xenophile = no
				is_xenophobe = no
			}
		}
	}
	after = {
		hidden_effect = {
			owner = {
				set_country_flag = hfe_ahet_found
			}
		}
	}
}

# ahet home events 410 - 413
# enter system
ship_event = {
	id = hfe.410
	title = hfe.410.name
	desc = hfe.410.desc
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
		from = {
			has_star_flag = hfe_ahet_home
		}
		owner = {
			is_ai = no
		}
	}
	immediate = {
		begin_event_chain = {
			event_chain = hfe_chain_ahet_home
			target = root.owner
		}
	}
	option = {
		name = hfe.410.0
		from = {
			if = {
				limit = {
					any_system_planet = {
						has_planet_flag = hfe_ahet_home
						is_surveyed = {
							who = root.owner
							status = yes
						}
					}
				}
				random_system_planet = {
					limit = {
						has_planet_flag = hfe_ahet_home
					}
					save_event_target_as = hfe_target_ahet_home
					enable_special_project = {
						name = hfe_project_ahet_home
						location = this
						owner = root.owner
					}
				}
			}
		}
	}
}

# explore planet
ship_event = {
	id = hfe.411
	title = hfe.411.name
	desc = hfe.411.desc
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	location = root
	trackable = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
		from = {
			has_planet_flag = hfe_ahet_home
		}
		owner = {
			is_ai = no
		}
	}
	immediate = {
		from = {
			save_event_target_as = hfe_target_ahet_home
		}
	}
	option = {
		name = hfe.411.0
		enable_special_project = {
			name = hfe_project_ahet_home
			location = from
			owner = root.owner
		}
	}
	option = {
		name = hfe.411.1
		owner = {
			end_event_chain = hfe_chain_ahet_home
		}
	}
}

# project complete remove scientist
ship_event = {
	id = hfe.412
	title = hfe.412.name
	desc = hfe.412.desc
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	location = root
	is_triggered_only = yes
	option = {
		name = hfe.412.0
		hidden_effect = {
			leader = {
				exile_leader_as = hfe_412_scientist
			}
			owner = {
				country_event = {
					id = hfe.413
					days = 18250
					random = 3600
				}
				#country_event = { id = hfe.413 days = 1 }
			}
		}
	}
}

# scientist returns after 50 - 60 years
country_event = {
	id = hfe.413
	title = hfe.413.name
	desc = {
		trigger = {
			text = hfe.413.desc.0
			success_text = {
				text = hfe.413.desc.1.0
				or = {
					is_xenophobe = yes
					is_militarist = yes
					hfe_trigger_is_authoritarian = yes
				}
			}
			fail_text = {
				text = hfe.413.desc.1.1
				or = {
					is_xenophobe = yes
					is_militarist = yes
					hfe_trigger_is_authoritarian = yes
				}
			}
			text = hfe.413.desc.2
		}
	}
	picture = GFX_evt_hfe_black_hole
	show_sound = event_scanner
	location = event_target:hfe_target_ahet_home
	is_triggered_only = yes
	immediate = {
		create_fleet = {
			effect = {
				set_owner = root
				create_ship = {
					random_existing_design = science
					graphical_culture = extra_dimensional_01
				}
				set_location = root.capital_scope
				set_leader = hfe_412_scientist
				leader = {
					save_event_target_as = hfe_413_scientist
					unassign_leader = this
				}
				delete_fleet = this
			}
		}
		event_target:hfe_target_ahet_home = {
			set_planet_entity = {
				entity = hfe_gaia_brown_shield_01_entity
			}
		}
	}
	option = {
		name = hfe.413.0
		event_target:hfe_413_scientist = {
			add_or_level_up_veteran_trait_effect = {
				TRAIT = leader_trait_maniacal
			}
		}
		if = {
			limit = {
				or = {
					is_xenophobe = yes
					is_militarist = yes
					is_authoritarian = yes
				}
			}
			hfe_effect_xenophobe_attraction.2 = yes
		}
		else = {
			hfe_effect_xenophile_attraction.2 = yes
		}
		if = {
			limit = {
				is_materialist = no
				not = {
					has_technology = tech_psionic_theory
				}
			}
			if = {
				limit = {
					has_tech_option = tech_psionic_theory
				}
				add_tech_progress = {
					tech = tech_psionic_theory
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_psionic_theory
			}
		}
		else_if = {
			limit = {
				is_spiritualist = no
				not = {
					has_technology = tech_sapient_ai
				}
			}
			if = {
				limit = {
					has_tech_option = tech_sapient_ai
				}
				add_tech_progress = {
					tech = tech_sapient_ai
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_sapient_ai
			}
		}
		else_if = {
			limit = {
				#				is_spiritualist = no
				not = {
					has_technology = tech_synthetic_workers
				}
			}
			if = {
				limit = {
					has_tech_option = tech_synthetic_workers
				}
				add_tech_progress = {
					tech = tech_synthetic_workers
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_synthetic_workers
			}
		}
		else_if = {
			limit = {
				not = {
					has_technology = tech_epigenetic_triggers
				}
			}
			if = {
				limit = {
					has_tech_option = tech_epigenetic_triggers
				}
				add_tech_progress = {
					tech = tech_epigenetic_triggers
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_epigenetic_triggers
			}
		}
		else_if = {
			limit = {
				not = {
					has_technology = tech_gene_tailoring
				}
			}
			if = {
				limit = {
					has_tech_option = tech_gene_tailoring
				}
				add_tech_progress = {
					tech = tech_gene_tailoring
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_gene_tailoring
			}
		}
		end_event_chain = hfe_chain_ahet_home
	}
}

# Ra'ar story (then home of light captured) 500 - 501
# start event
planet_event = {
	id = hfe.500
	title = hfe.500.name
	desc = hfe.500.desc
	picture = GFX_evt_hfe_holocube_2
	location = root
	is_triggered_only = yes
	trigger = {
		has_planet_flag = hfe_home_of_light
		exists = owner
		owner = {
			is_ai = no
		}
	}
	option = {
		name = hfe_at_the_sreen
		hidden_effect = {
			owner = {
				country_event = {
					id = hfe.501
				}
			}
		}
	}
}

# raar story
country_event = {
	id = hfe.501
	title = hfe.501.name
	desc = hfe.501.desc
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = hfe_raar_room
	}
	option = {
		name = hfe.501.0
		response_text = hfe.501.0.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.1
		response_text = hfe.501.1.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.2
		response_text = hfe.501.2.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.3
		response_text = hfe.501.3.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.4
		response_text = hfe.501.4.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.5
		response_text = hfe.501.5.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.6
		response_text = hfe.501.6.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.7
		response_text = hfe.501.7.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.8
		response_text = hfe.501.8.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.9
		response_text = hfe.501.9.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.10
		response_text = hfe.501.10.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.11
		response_text = hfe.501.11.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.12
		response_text = hfe.501.12.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.501.13
		default_hide_option = yes
		custom_tooltip = hfe.501.13.tooltip
	}
}

# stargate anomaly 510 - 550
# after anomaly 510
ship_event = {
	id = hfe.510
	title = hfe.510.name
	desc = {
		trigger = {
			hidden:owner = {
				# non hive
				# all
				success_text = {
					text = hfe.510.desc.0.0
					is_gestalt = no
				}
				# have discovered L gate
				success_text = {
					text = hfe.510.desc.0.1.0
					is_gestalt = no
					has_seen_any_bypass = lgate
				}
				# have discovered regular gateway
				success_text = {
					text = hfe.510.desc.0.1.1
					is_gestalt = no
					not = {
						has_seen_any_bypass = lgate
					}
					has_seen_any_bypass = gateway
				}
				# not L gateway and not regular gateway
				success_text = {
					text = hfe.510.desc.0.1.2
					is_gestalt = no
					nor = {
						has_seen_any_bypass = lgate
						has_seen_any_bypass = gateway
					}
				}
				# all
				success_text = {
					text = hfe.510.desc.0.2
					is_gestalt = no
				}
				# have discovered L gate
				success_text = {
					text = hfe.510.desc.0.3.0
					is_gestalt = no
					has_seen_any_bypass = lgate
				}
				# have discovered regular gateway
				success_text = {
					text = hfe.510.desc.0.3.1
					is_gestalt = no
					not = {
						has_seen_any_bypass = lgate
					}
					has_seen_any_bypass = gateway
				}
				# not L gateway and not regular gateway
				success_text = {
					text = hfe.510.desc.0.3.2
					is_gestalt = no
					nor = {
						has_seen_any_bypass = lgate
						has_seen_any_bypass = gateway
					}
				}
				# all
				success_text = {
					text = hfe.510.desc.0.4
					is_gestalt = no
				}
				# non synth
				success_text = {
					text = hfe.510.desc.0.5.0
					is_gestalt = no
					not = {
						has_trait = trait_mechanical
					}
				}
				# synth
				success_text = {
					text = hfe.510.desc.0.5.1
					is_gestalt = no
					has_trait = trait_mechanical
				}
				# robo hive
				success_text = {
					text = hfe.510.desc.1.0
					is_machine_empire = yes
				}
				# have discovered L gate
				success_text = {
					text = hfe.510.desc.1.1.0
					is_machine_empire = yes
					has_seen_any_bypass = lgate
				}
				# have discovered regular gateway
				success_text = {
					text = hfe.510.desc.1.1.1
					is_machine_empire = yes
					not = {
						has_seen_any_bypass = lgate
					}
					has_seen_any_bypass = gateway
				}
				# not L gateway and not regular gateway
				success_text = {
					text = hfe.510.desc.1.1.2
					is_machine_empire = yes
					nor = {
						has_seen_any_bypass = lgate
						has_seen_any_bypass = gateway
					}
				}
				success_text = {
					text = hfe.510.desc.1.2
					is_machine_empire = yes
				}
				# bio hive
				success_text = {
					text = hfe.510.desc.2
					is_hive_empire = yes
				}
			}
		}
	}
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_ship_explosion
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		fleet = {
			set_event_locked = yes
		}
		from = {
			hfe_effect_remove_signal_object_from_this = yes
			set_planet_flag = hfe_stargate_planet
			save_event_target_as = hfe_stargate_planet
		}
	}
	option = {
		name = hfe.510.0
		exclusive_trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
	}
	option = {
		name = hfe.510.1
		exclusive_trigger = {
			owner = {
				is_hive_empire = yes
			}
		}
	}
	option = {
		name = hfe.510.2
	}
	after = {
		begin_event_chain = {
			event_chain = hfe_chain_stargate
			target = owner
		}
		create_point_of_interest = {
			id = hfe_chain_stargate.0
			name = hfe_chain_stargate_name.0
			desc = hfe_chain_stargate_desc.0
			event_chain = hfe_chain_stargate
			location = from
		}
		hidden_effect = {
			fleet = {
				set_event_locked = no
			}
			create_country = {
				name = "Drontection"
				type = hfe_berserk
				species = root.owner
				effect = {
					set_graphical_culture = hfe_graphical_culture_drone
					every_country = {
						establish_communications_no_message = prev
					}
					hfe_effect_init_give_tech_t2 = yes
					create_fleet = {
						name = "Drontection"
						effect = {
							set_owner = prev
							while = {
								count = 20
								create_ship = {
									random_existing_design = corvette
									prefix = no
								}
							}
							while = {
								count = 10
								create_ship = {
									random_existing_design = destroyer
									prefix = no
								}
							}
							set_fleet_stance = aggressive
							set_location = root
						}
					}
				}
			}
			destroy_fleet = fleet
		}
	}
}

# after colonisation 511
# TODO TRIGGER ON PLANERT WITH 20 POPS
planet_event = {
	id = hfe.511
	title = hfe.511.name
	desc = {
		trigger = {
			hidden:owner = {
				success_text = {
					text = hfe.511.desc.0
					is_gestalt = no
				}
				success_text = {
					text = hfe.511.desc.1
					is_gestalt = yes
				}
			}
		}
	}
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_conversation
	location = root
	is_triggered_only = yes
	trigger = {
		exists = owner
		has_planet_flag = hfe_stargate_planet
	}
	immediate = {
		remove_planet_flag = hfe_stargate_planet
		save_event_target_as = hfe_stargate_planet
		owner = {
			add_event_chain_counter = {
				event_chain = hfe_chain_stargate
				counter = colony_established
				amount = 1
			}
			remove_point_of_interest = hfe_chain_stargate.0
		}
	}
	option = {
		name = hfe.511.0
		enable_special_project = {
			name = hfe_project_stargate
			owner = owner
			location = this
		}
	}
	option = {
		name = hfe.511.1
		trigger = {
			owner = {
				is_materialist = no
				is_gestalt = no
			}
		}
		add_modifier = {
			modifier = hfe_event_511
		}
		owner = {
			end_event_chain = hfe_chain_stargate
		}
	}
	option = {
		name = hfe.511.2
		trigger = {
			owner = {
				is_materialist = yes
			}
		}
		add_modifier = {
			modifier = hfe_event_511
		}
		owner = {
			end_event_chain = hfe_chain_stargate
		}
	}
	option = {
		name = hfe.511.3
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
		add_modifier = {
			modifier = hfe_event_511
		}
		owner = {
			end_event_chain = hfe_chain_stargate
		}
	}
}

# after special project gateway event 512
ship_event = {
	id = hfe.512
	title = hfe.512.name
	desc = {
		trigger = {
			hidden:owner = {
				success_text = {
					text = hfe.512.desc.0
					is_gestalt = no
				}
				success_text = {
					text = hfe.512.desc.1
					is_gestalt = yes
				}
			}
		}
	}
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		exists = leader
		exists = owner
	}
	immediate = {
		leader = {
			save_event_target_as = hfe_stargate_scientist
		}
	}
	option = {
		name = hfe.512.0
		custom_tooltip = hfe.512.tooltip
		exclusive_trigger = {
			owner = {
				is_spiritualist = yes
			}
		}
	}
	option = {
		name = hfe.512.1
		custom_tooltip = hfe.512.tooltip
		exclusive_trigger = {
			owner = {
				is_materialist = yes
			}
		}
	}
	option = {
		name = hfe.512.2
		custom_tooltip = hfe.512.tooltip
		exclusive_trigger = {
			owner = {
				is_gestalt = yes
			}
		}
	}
	option = {
		name = hfe.512.3
		custom_tooltip = hfe.512.tooltip
	}
	after = {
		hidden_effect = {
			owner = {
				random_list = {
					10 = {
						country_event = {
							id = hfe.520
						}
					}
					10 = {
						modifier = {
							factor = 0
							is_gestalt = no
						}
						country_event = {
							id = hfe.522
						}
					}
					10 = {
						country_event = {
							id = hfe.523
						}
					}
					10 = {
						country_event = {
							id = hfe.524
						}
					}
					10 = {
						modifier = {
							factor = 0
							not = {
								is_species_class = HUM
							}
						}
						country_event = {
							id = hfe.525
						}
					}
					10 = {
						modifier = {
							factor = 0
							not = {
								is_species_class = HUM
							}
						}
						country_event = {
							id = hfe.527
						}
					}
					10 = {
						country_event = {
							id = hfe.528
						}
					}
					10 = {
						modifier = {
							factor = 0
							not = {
								is_species_class = FUN
							}
						}
						country_event = {
							id = hfe.529
						}
					}
					10 = {
						country_event = {
							id = hfe.531
						}
					}
					10 = {
						modifier = {
							factor = 0
							is_machine_empire = yes
							not = {
								has_valid_civic = civic_machine_servitor
							}
						}
						country_event = {
							id = hfe.532
						}
					}
				}
			}
		}
	}
}

# outcomes, country events 520-550
# 1
country_event = {
	id = hfe.520
	title = hfe.520.name
	desc = {
		trigger = {
			success_text = {
				text = hfe.520.desc.0
				is_gestalt = no
			}
			success_text = {
				text = hfe.520.desc.1
				is_gestalt = yes
			}
		}
	}
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_laboratory_sound
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		event_target:hfe_stargate_scientist = {
			kill_leader = {
				show_notification = yes
			}
		}
		destroy_fleet = from.fleet
		hfe_effect_stargate_off = yes
		random = {
			chance = 50
			country_event = {
				id = hfe.521
				days = 180
				random = 30
			}
		}
	}
	option = {
		name = hfe.520.0
		exclusive_trigger = {
			is_gestalt = no
		}
	}
	option = {
		name = hfe.520.1
	}
}

# 1.1 Forsakens
country_event = {
	id = hfe.521
	title = hfe.521.name
	desc = hfe.521.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_space_battle
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		is_gestalt = no
		exists = event_target:hfe_stargate
		exists = event_target:hfe_stargate_planet.starbase
	}
	immediate = {
		create_country = {
			name = "Forsakens"
			type = default
			species = root
			auto_delete = no
			authority = auth_dictatorial
			ignore_initial_colony_error = yes
			ethos = {
				ethic = ethic_authoritarian
				ethic = ethic_fanatic_militarist
			}
			effect = {
				set_country_flag = hfe_forsaken
				set_country_flag = hfe_auto_delete
				set_graphical_culture = hfe_graphical_culture_pirate
				save_event_target_as = hfe_forsaken
				event_target:hfe_stargate_planet = {
					# conquer = prev
					set_owner = prev
					starbase = {
						set_owner = prevprev
					}
					while = {
						limit = {
							num_pops < 20
						}
						create_pop = {
							species = root
						}
					}
					add_modifier = {
						modifier = hfe_idustrial_boom
						years = 5
					}
				}
				copy_techs_from = {
					target = root
				}
				establish_communications_no_message = root
				add_opinion_modifier = {
					who = root
					modifier = hfe_opinion_forsaken
				}
				add_modifier = {
					modifier = hfe_navy_size
					years = 10
				}
				hfe_effect_resource_bonus = yes
				while = {
					count = 3
					root = {
						create_fleet_from_naval_cap = 0.3
					}
					create_leader = {
						class = commander
					}
					last_created_fleet = {
						set_owner = prev
						set_location = event_target:hfe_stargate
						assign_leader = last_created_leader
					}
				}
				create_leader = {
					class = commander
				}
				create_fleet = {
					effect = {
						set_owner = prev
						while = {
							count = 20
							create_army_transport = {
								army_type = assault_army
							}
						}
						assign_leader = last_created_leader
						set_location = event_target:hfe_stargate
					}
				}
				declare_war = {
					target = root
					name = "War with Forsakens"
					attacker_war_goal = hfe_wg_annex
				}
				set_war_goal = {
					type = hfe_wg_annex
					target = root
					enemy = this
				}
			}
		}
	}
	option = {
		name = hfe.521.0
	}
	option = {
		name = hfe.521.1
		set_player = event_target:hfe_forsaken
		# TODO remove cheat modifiers?
	}
}

# 2 horror confirmed
country_event = {
	id = hfe.522
	title = hfe.522.name
	desc = hfe.522.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_laboratory_sound
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		event_target:hfe_stargate_scientist = {
			kill_leader = {
				show_notification = yes
			}
		}
		destroy_fleet = from.fleet
		hfe_effect_stargate_off = yes
	}
	option = {
		name = hfe.522.0
	}
}

# 3 drone evolution
country_event = {
	id = hfe.523
	title = hfe.523.name
	desc = hfe.523.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_laboratory_sound
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		hfe_effect_stargate_off = yes
	}
	option = {
		name = hfe.523.0
		hfe_effect_media_negative = yes
	}
}

# 4 start of universe
country_event = {
	id = hfe.524
	title = hfe.524.name
	desc = hfe.524.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_laboratory_sound
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	option = {
		name = hfe.524.0
		hfe_effect_add_physics_research.5 = yes
		# ???????? ??????????? ?? ??????? ?? ?????? ?????????, ??? ?? ????? ???????? ? ??
		# energy from another universe modifier?
	}
}

# 5 exodus
country_event = {
	id = hfe.525
	title = hfe.525.name
	desc = hfe.525.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_radio_chatter_02
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		event_target:hfe_stargate_scientist = {
			kill_leader = {
				show_notification = yes
			}
		}
		destroy_fleet = from.fleet
		hfe_effect_stargate_off = yes
		create_fleet = {
			effect = {
				set_owner = root
				create_ship = {
					random_existing_design = colonizer
				}
				set_location = event_target:hfe_stargate
				add_modifier = {
					modifier = hfe_unkeep_80
				}
				save_event_target_as = hfe_stargate_exodus_fleet
			}
		}
	}
	# niarest planet
	option = {
		name = hfe.525.0
		custom_tooltip = hfe.525.0.tooltip
		hfe_effect_add_physics_research.2 = yes
		hfe_effect_add_society_research.2 = yes
		hidden_effect = {
			event_target:hfe_stargate_exodus_fleet = {
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = hfe_stargate_exodus_fleet_trigger.0.0
							any_system_planet = {
								is_owned_by = root
								#free_pop_tiles > 0
								habitability = {
									who = root.species
									value > 0.7
								}
							}
						}
						found_system = {
							move_to = this
						}
					}
					find_closest_planet = {
						trigger = {
							id = hfe_stargate_exodus_fleet_trigger.0.1
							is_owned_by = root
							#free_pop_tiles > 0
							habitability = {
								who = root.species
								value > 0.7
							}
						}
						found_planet = {
							move_to = this
							effect = {
								id = hfe_stargate_exodus_fleet_effect.0.1
								create_pop = {
									species = root
								}
								delete_fleet = event_target:hfe_stargate_exodus_fleet
							}
						}
					}
				}
			}
		}
	}
	# make new colony
	option = {
		name = hfe.525.1
		custom_tooltip = hfe.525.0.tooltip
		hfe_effect_add_physics_research.2 = yes
		hfe_effect_add_society_research.2 = yes
		hidden_effect = {
			event_target:hfe_stargate_exodus_fleet = {
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = hfe_stargate_exodus_fleet_trigger.1.0
							any_system_planet = {
								not = {
									exists = owner
								}
								habitability = {
									who = root.species
									value > 0.7
								}
							}
						}
						found_system = {
							move_to = this
						}
					}
					find_closest_planet = {
						trigger = {
							id = hfe_stargate_exodus_fleet_trigger.1.1
							not = {
								exists = owner
							}
							habitability = {
								who = root.species
								value > 0.7
							}
						}
						found_planet = {
							move_to = this
							effect = {
								id = hfe_stargate_exodus_fleet_effect.1.1
								start_colony = {
									owner = root
								}
								planet_event = {
									id = hfe.526
								}
								delete_fleet = event_target:hfe_stargate_exodus_fleet
							}
						}
					}
				}
			}
		}
	}
	# kill them
	option = {
		name = hfe.525.2
		trigger = {
			is_xenophobe = yes
		}
		custom_tooltip = hfe.525.2.tooltip
		destroy_fleet = event_target:hfe_stargate_exodus_fleet
		hfe_effect_add_physics_research.2 = yes
		hfe_effect_add_society_research.2 = yes
		hfe_effect_xenophobe_attraction.3 = yes
	}
}

# 5.1 live long and prosper
planet_event = {
	id = hfe.526
	title = hfe.526.name
	desc = hfe.526.desc
	picture = GFX_evt_hfe_colony_new
	show_sound = event_celebration
	location = root
	is_triggered_only = yes
	option = {
		name = hfe.526.0
	}
}

# 6 records from empty ship
country_event = {
	id = hfe.527
	title = hfe.527.name
	desc = hfe.527.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		event_target:hfe_stargate_scientist = {
			kill_leader = {
				show_notification = yes
			}
		}
		destroy_fleet = from.fleet
		hfe_effect_stargate_off = yes
	}
	option = {
		name = hfe.527.0
	}
	option = {
		name = hfe.527.1
		exclusive_trigger = {
			allows_slavery = yes
		}
		add_modifier = {
			modifier = hfe_event_527
		}
	}
	after = {
		if = {
			limit = {
				exists = ruler
			}
			ruler = {
				add_trait = hfe_leader_trait_nightmare
			}
		}
	}
}

# 7 Shambhala
country_event = {
	id = hfe.528
	title = hfe.528.name
	desc = hfe.528.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	option = {
		name = hfe.528.0
		custom_tooltip = hfe.528.0.tooltip
		if = {
			limit = {
				has_ethic = ethic_fanatic_spiritualist
			}
			hfe_effect_add_unity.5 = yes
		}
		else_if = {
			limit = {
				is_spiritualist = yes
			}
			shift_ethic = ethic_spiritualist
			hfe_effect_add_unity.4 = yes
		}
		else = {
			shift_ethic = ethic_spiritualist
			shift_ethic = ethic_spiritualist
			hfe_effect_add_unity.3 = yes
		}
		add_modifier = {
			modifier = hfe_event_528.0.0
		}
		event_target:hfe_stargate_planet = {
			add_modifier = {
				modifier = hfe_event_528.0.1
			}
		}
	}
	option = {
		name = hfe.528.1
		custom_tooltip = hfe.528.1.tooltip
		exclusive_trigger = {
			is_materialist = yes
		}
		add_modifier = {
			modifier = hfe_event_528.1
		}
		hidden_effect = {
			event_target:hfe_stargate_scientist = {
				kill_leader = {
					show_notification = yes
				}
			}
			play_sound = amb_super_explosion
			hfe_effect_stargate_off = yes
		}
	}
	option = {
		name = hfe.528.2
		custom_tooltip = hfe.528.2.tooltip
		exclusive_trigger = {
			is_xenophobe = yes
		}
		add_modifier = {
			modifier = hfe_event_528.2
		}
		hidden_effect = {
			event_target:hfe_stargate_scientist = {
				kill_leader = {
					show_notification = yes
				}
			}
			play_sound = amb_super_explosion
			hfe_effect_stargate_off = yes
		}
	}
}

# 8 hands from portal
country_event = {
	id = hfe.529
	title = hfe.529.name
	desc = {
		trigger = {
			text = hfe.529.desc.0
			success_text = {
				text = hfe.529.desc.1.0
				hfe_trigger_is_human = yes
			}
			fail_text = {
				text = hfe.529.desc.1.1
				hfe_trigger_is_human = yes
			}
			text = hfe.529.desc.2
		}
	}
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
		exists = from.fleet.solar_system
	}
	immediate = {
		event_target:hfe_stargate_scientist = {
			kill_leader = {
				show_notification = yes
			}
		}
		destroy_fleet = from.fleet
		from.fleet.solar_system = {
			every_fleet_in_system = {
				every_owned_ship = {
					reduce_hp_percent = 0.99
				}
			}
		}
	}
	option = {
		name = hfe_next
		hidden_effect = {
			country_event = {
				id = hfe.530
			}
		}
	}
}

# 8.1
country_event = {
	id = hfe.530
	title = hfe.530.name
	desc = hfe.530.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		hfe_effect_stargate_off = yes
	}
	option = {
		name = hfe.530.0
		exclusive_trigger = {
			is_xenophobe = no
		}
		add_modifier = {
			modifier = hfe_event_530
		}
	}
	option = {
		name = hfe.530.1
		add_modifier = {
			modifier = hfe_event_530
		}
	}
}

# 9 galaxy war
country_event = {
	id = hfe.531
	title = hfe.531.name
	desc = hfe.531.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_space_battle
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		hfe_effect_stargate_off = yes
	}
	option = {
		name = FASCINATING
		hfe_effect_give_random_tech = yes
	}
}

# 10 geck
country_event = {
	id = hfe.532
	title = hfe.532.name
	desc = hfe.532.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_activating_unknown_technology
	location = event_target:hfe_stargate
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_stargate
	}
	immediate = {
		hfe_effect_stargate_off = yes
		set_country_flag = hfe_has_event_532
	}
	option = {
		name = hfe.532.0
	}
	option = {
		name = hfe.532.1
	}
	option = {
		name = hfe.532.2
	}
}

# 11 planet mutate
# country_event = {
# 	id = hfe.533
# 	title = hfe.533.name
# 	desc = hfe.533.desc
# 	picture = GFX_evt_hfe_holocube_2
# 	show_sound = event_activating_unknown_technology
# 	location = event_target:hfe_stargate
# 	is_triggered_only = yes
# 	trigger = {
# 		exists = event_target:hfe_stargate
# 	}
# 	immediate = {
# 		event_target:hfe_stargate = {
# 			destroy_ambient_object = this
# 		}
# 		event_target:hfe_stargate_planet = {
# 			# change planet model
# 			# mutate pops
# 			every_owned_pop = {
# 				limit = {
# 					is_robot_pop = no
# 				}
# 				modify_species = {
# 					add_trait = hfe_species_trait_tough
# 				}
# 			}
# 			# add deposit
# 			add_deposit = hfe_deposit_stargate_impact
# 		}
# 	}
# 	option = {
# 		name = hfe.533.0
# 	}
# }
# terminator event part of memorial events 550 - 600
# start event nothing, complitly nothing
ship_event = {
	id = hfe.550
	title = hfe.550.name
	desc = hfe.550.desc
	picture = GFX_evt_hfe_holocube_2
	location = root
	is_triggered_only = yes
	trigger = {
		exists = owner
		exists = leader
	}
	immediate = {
		leader = {
			save_event_target_as = hfe_550_scientist
		}
		# TODO for debuging
		if = {
			limit = {
				not = {
					exists = event_target:hfe_memorial_planet
				}
			}
			random_galaxy_planet = {
				limit = {
					is_planet_class = hfe_pc_memorial
				}
				save_event_target_as = hfe_memorial_planet
			}
		}
		owner = {
			country_event = {
				id = hfe.551
				days = 50
				random = 150
			}
		}
	}
	option = {
		name = hfe.550.0
	}
}

# check scientist position
country_event = {
	id = hfe.551
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = capital_scope
		any_owned_leader = {
			is_same_value = event_target:hfe_550_scientist
		}
	}
	immediate = {
		random_owned_leader = {
			limit = {
				is_same_value = event_target:hfe_550_scientist
			}
			if = {
				limit = {
					exists = fleet
				}
				# branch 1
				fleet = {
					random_list = {
						# kill ship
						10 = {
							fleet_event = {
								id = hfe.552
							}
						}
						# disappeared, move to branch 2
						10 = {
							fleet_event = {
								id = hfe.553
							}
						}
					}
				}
			}
			else = {
				root = {
					# branch 2
					random_list = {
						# attempt failed
						10 = {
							country_event = {
								id = hfe.554
							}
						}
						# main event
						10 = {
							capital_scope = {
								planet_event = {
									id = hfe.555
								}
							}
						}
					}
				}
			}
		}
	}
}

# branch 1 ship
# kill ship
fleet_event = {
	id = hfe.552
	title = hfe.552.name
	desc = hfe.552.desc
	show_sound = event_ship_explosion
	picture = GFX_evt_hfe_holocube_2
	location = root
	is_triggered_only = yes
	immediate = {
		kill_leader = {
			class = scientist
		}
		destroy_fleet = this
	}
	option = {
		name = hfe.552.0
	}
}

# branch 2 planet
# disappeared, move to branch 2
fleet_event = {
	id = hfe.553
	title = hfe.553.name
	desc = hfe.553.desc
	picture = GFX_evt_hfe_holocube_2
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		exists = owner
		exists = owner.capital_scope
		exists = leader
	}
	immediate = {
		leader = {
			exile_leader_as = hfe_553_scientist
		}
		owner = {
			random_list = {
				# attempt failed
				10 = {
					country_event = {
						id = hfe.554
						days = 80
						random = 100
					}
				}
				# main event
				10 = {
					capital_scope = {
						planet_event = {
							id = hfe.555
							days = 180
							random = 100
						}
					}
				}
			}
		}
	}
	option = {
		name = hfe.553.0
	}
}

# attempt failed
country_event = {
	id = hfe.554
	title = hfe.554.name
	desc = hfe.554.desc
	show_sound = event_structural_collapse
	picture = GFX_evt_hfe_holocube_2
	location = capital_scope
	is_triggered_only = yes
	option = {
		name = hfe.554.0
	}
}

# main event planet desc
planet_event = {
	id = hfe.555
	title = hfe.555.name
	desc = {
		trigger = {
			fail_text = {
				text = hfe.555.desc.0.0
				or = {
					habitable_structure = yes
					solar_system.system_star = {
						is_planet_class = pc_black_hole
					}
				}
			}
			success_text = {
				text = hfe.555.desc.0.1
				or = {
					habitable_structure = yes
					solar_system.system_star = {
						is_planet_class = pc_black_hole
					}
				}
			}
			text = newline
			success_text = {
				text = hfe.555.desc.1.0
				or = {
					is_wet = yes
					is_planet_class = pc_gaia
				}
			}
			success_text = {
				text = hfe.555.desc.1.1
				is_dry = yes
			}
			success_text = {
				text = hfe.555.desc.1.2
				is_cold = yes
			}
			success_text = {
				text = hfe.555.desc.1.3
				habitable_structure = yes
			}
			success_text = {
				text = hfe.555.desc.1.4
				is_planet_class = pc_nuked
			}
			text = newline
			success_text = {
				text = hfe.555.desc.2.0
				is_moon = no
				has_moon = yes
				not = {
					is_planet_class = pc_nuked
				}
				habitable_structure = no
			}
			success_text = {
				text = hfe.555.desc.2.1
				is_moon = no
				num_moons < 1
				# has_moon = no seems broken
				not = {
					is_planet_class = pc_nuked
				}
				habitable_structure = no
			}
			success_text = {
				text = hfe.555.desc.2.2
				is_moon = yes
				not = {
					is_planet_class = pc_nuked
				}
				habitable_structure = no
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = no_video_feed_room		# event_target:hfe_555_room.ruler
	}
	immediate = {
		# set up all needed targets
		save_global_event_target_as = hfe_555_planet
		create_country = {
			type = ambient
			species = root.owner
			effect = {
				set_country_flag = hfe_555_room
				save_event_target_as = hfe_555_room
			}
		}
		owner = {
			save_global_event_target_as = hfe_555_room_target
			random_planet_within_border = {
				limit = {
					is_dry = yes
					not = {
						is_planet = root
					}
				}
				save_event_target_as = hfe_555_dry_planet
			}
			random_planet_within_border = {
				limit = {
					is_planet_class = pc_ocean
					not = {
						is_planet = root
					}
				}
				save_event_target_as = hfe_555_ocean_planet
			}
			random_relation = {
				limit = {
					opinion = {
						who = prev
						value > 100
					}
				}
				save_event_target_as = hfe_555_friendly_relation
			}
		}
		if = {
			limit = {
				is_moon = yes
			}
			solar_system = {
				random_system_planet = {
					limit = {
						any_moon = {
							is_planet = root
						}
					}
					save_event_target_as = hfe_555_orbiting_planet
				}
			}
		}
	}
	option = {
		name = hfe_next
		default_hide_option = yes
		hidden_effect = {
			clear_global_event_target = hfe_555_planet
			owner = {
				country_event = {
					id = hfe.556
				}
				set_country_flag = hfe_556.0
			}
		}
	}
}

# main event ruler desc, switch to country scope
country_event = {
	id = hfe.556
	title = hfe.556.name
	desc = {
		trigger = {
			success_text = {
				text = hfe.556.desc.0
				has_country_flag = hfe_556.0
			}
			success_text = {
				text = hfe.556.desc.1
				has_country_flag = hfe_556.1
			}
			# option 0
			success_text = {
				text = hfe.556.desc.2.0
				or = {
					has_country_flag = hfe_556.2.0.0
					has_country_flag = hfe_556.2.0.1
				}
			}
			success_text = {
				text = hfe.556.desc.2.0.0
				has_country_flag = hfe_556.2.0.0
			}
			success_text = {
				text = hfe.556.desc.2.0.1
				has_country_flag = hfe_556.2.0.1
			}
			# option 1
			success_text = {
				text = hfe.556.desc.2.1
				or = {
					has_country_flag = hfe_556.2.1.0.0
					has_country_flag = hfe_556.2.1.1
				}
			}
			success_text = {
				text = hfe.556.desc.2.1.0.0
				has_country_flag = hfe_556.2.1.0.0
			}
			success_text = {
				text = hfe.556.desc.2.1.0.1
				has_country_flag = hfe_556.2.1.0.1
			}
			success_text = {
				text = hfe.556.desc.2.1.1
				has_country_flag = hfe_556.2.1.1
			}
			# option 2
			success_text = {
				text = hfe.556.desc.2.2
				has_country_flag = hfe_556.2.2
			}
			success_text = {
				text = hfe.556.desc.3
				or = {
					has_country_flag = hfe_556.3.0
					has_country_flag = hfe_556.3.1
				}
			}
			success_text = {
				text = hfe.556.desc.3.0
				has_country_flag = hfe_556.3.0
			}
			success_text = {
				text = hfe.556.desc.3.1
				has_country_flag = hfe_556.3.1
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = event_target:hfe_555_room.ruler
	}
	# step 0
	option = {
		name = hfe_next
		trigger = {
			has_country_flag = hfe_556.0
		}
		hidden_effect = {
			remove_country_flag = hfe_556.0
			set_country_flag = hfe_556.1
			country_event = {
				id = hfe.556
			}
		}
	}
	# step 1 left pekar and run away
	option = {
		name = hfe_556.1.0
		custom_tooltip = hfe_556.1.0.tooltip
		trigger = {
			has_country_flag = hfe_556.1
			is_militarist = no
		}
		hidden_effect = {
			remove_country_flag = hfe_556.1
			random_list = {
				# fail
				100 = {
					set_country_flag = hfe_556.2.0.0
				}
				# success
				50 = {
					set_country_flag = hfe_556.2.0.1
				}
			}
			country_event = {
				id = hfe.556
			}
		}
	}
	# step 2 left pekar and run away
	option = {
		name = hfe_556.2.0.0
		trigger = {
			has_country_flag = hfe_556.2.0.0
		}
		kill_leader = {
			ruler = yes
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.0.0
			clear_global_event_target = hfe_555_room_target
			event_target:hfe_555_room = {
				destroy_country = yes
			}
		}
	}
	option = {
		name = hfe_556.2.0.1
		trigger = {
			has_country_flag = hfe_556.2.0.1
		}
		if = {
			limit = {
				exists = ruler
			}
			ruler = {
				add_trait = hfe_leader_trait_imperialist
			}
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.0.1
			clear_global_event_target = hfe_555_room_target
			event_target:hfe_555_room = {
				destroy_country = yes
			}
		}
	}
	# step 1 dont left pekar and run away
	option = {
		name = hfe_556.1.1
		custom_tooltip = hfe_556.1.1.tooltip
		trigger = {
			has_country_flag = hfe_556.1
			is_militarist = no
		}
		hidden_effect = {
			remove_country_flag = hfe_556.1
			random_list = {
				# fail
				100 = {
					set_country_flag = hfe_556.2.1.0.0
				}
				# success
				100 = {
					set_country_flag = hfe_556.2.1.1
				}
			}
			country_event = {
				id = hfe.556
			}
		}
	}
	# step 2 dont left pekar and run away
	option = {
		name = hfe_next
		trigger = {
			has_country_flag = hfe_556.2.1.0.0
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.1.0.0
			set_country_flag = hfe_556.2.1.0.1
			country_event = {
				id = hfe.556
			}
		}
	}
	option = {
		name = hfe_556.2.1.0.1
		trigger = {
			has_country_flag = hfe_556.2.1.0.1
		}
		kill_leader = {
			ruler = yes
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.1.0.1
			clear_global_event_target = hfe_555_room_target
			event_target:hfe_555_room = {
				destroy_country = yes
			}
		}
	}
	option = {
		name = hfe_556.2.1.1
		trigger = {
			has_country_flag = hfe_556.2.1.1
		}
		if = {
			limit = {
				exists = ruler
			}
			ruler = {
				add_trait = hfe_leader_trait_jean_luc
			}
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.1.1
			clear_global_event_target = hfe_555_room_target
			event_target:hfe_555_room = {
				destroy_country = yes
			}
		}
	}
	# step 1 attack
	option = {
		name = hfe_556.1.2
		custom_tooltip = hfe_556.1.2.tooltip
		trigger = {
			has_country_flag = hfe_556.1
		}
		hidden_effect = {
			remove_country_flag = hfe_556.1
			set_country_flag = hfe_556.2.2
			country_event = {
				id = hfe.556
			}
		}
	}
	# step 2 attack
	option = {
		name = hfe_next
		trigger = {
			has_country_flag = hfe_556.2.2
		}
		hidden_effect = {
			remove_country_flag = hfe_556.2.2
			random_list = {
				# fail
				50 = {
					set_country_flag = hfe_556.3.0
				}
				# success
				100 = {
					set_country_flag = hfe_556.3.1
				}
			}
			country_event = {
				id = hfe.556
			}
		}
	}
	# step 3 attack
	option = {
		name = hfe_556.3
		trigger = {
			or = {
				has_country_flag = hfe_556.3.0
				has_country_flag = hfe_556.3.1
			}
		}
		if = {
			limit = {
				has_country_flag = hfe_556.3.0
			}
			kill_leader = {
				ruler = yes
			}
		}
		else_if = {
			limit = {
				exists = ruler
			}
			ruler = {
				add_trait = hfe_leader_trait_jean_luc
			}
		}
		hidden_effect = {
			remove_country_flag = hfe_556.3.0
			remove_country_flag = hfe_556.3.1
			clear_global_event_target = hfe_555_room_target
			event_target:hfe_555_room = {
				destroy_country = yes
			}
		}
	}
}

# drone country section 600
# contact event
country_event = {
	id = hfe.604
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = hfe_drone
		exists = from
	}
	immediate = {
		establish_communications_no_message = from
		from = {
			if = {
				limit = {
					is_ai = no
				}
				country_event = {
					id = hfe.605
				}
				set_country_flag = hfe.605.step0
			}
		}
	}
}

# diplomatic contact event
country_event = {
	id = hfe.605
	title = TRANSMISSION
	desc = {
		trigger = {
			# start
			fail_text = {
				text = hfe.605.desc.0
				has_country_flag = hfe.605.step3
			}
			success_text = {
				text = hfe.605.desc.1
				has_country_flag = hfe.605.step3
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = no_video_feed_room
	}
	# step 0
	option = {
		name = hfe.605.0.0
		trigger = {
			has_country_flag = hfe.605.step0
		}
		hidden_effect = {
			remove_country_flag = hfe.605.step0
			set_country_flag = hfe.605.step1
			country_event = {
				id = hfe.605
			}
		}
	}
	# step 1
	option = {
		name = hfe.605.1.0
		trigger = {
			has_country_flag = hfe.605.step1
		}
		hidden_effect = {
			remove_country_flag = hfe.605.step1
			set_country_flag = hfe.605.step2
			country_event = {
				id = hfe.605
			}
		}
	}
	# step 2
	option = {
		name = hfe.605.2.0
		trigger = {
			has_country_flag = hfe.605.step2
			hfe_trigger_is_clever_for_event = yes
		}
		hfe_effect_materialist_attraction.1 = yes
		hidden_effect = {
			remove_country_flag = hfe.605.step2
			set_country_flag = hfe.605.step3
			country_event = {
				id = hfe.605
			}
		}
	}
	# step 3
	option = {
		name = hfe.605.3.0
		trigger = {
			has_country_flag = hfe.605.step3
		}
		is_dialog_only = yes
		response_text = hfe.605.3.0.response
	}
	option = {
		name = hfe.605.3.1
		trigger = {
			has_country_flag = hfe.605.step3
		}
		is_dialog_only = yes
		response_text = hfe.605.3.1.response
	}
	option = {
		name = hfe.605.3.2
		trigger = {
			has_country_flag = hfe.605.step3
		}
		is_dialog_only = yes
		response_text = hfe.605.3.2.response
	}
	option = {
		name = hfe.605.3.3
		trigger = {
			has_country_flag = hfe.605.step3
		}
		is_dialog_only = yes
		response_text = hfe.605.3.3.response
	}
	option = {
		name = hfe.605.3.4
		trigger = {
			has_country_flag = hfe.605.step3
		}
		is_dialog_only = yes
		response_text = hfe.605.3.4.response
	}
	option = {
		name = hfe_end_transmission
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = hfe.605.step0
			remove_country_flag = hfe.605.step1
			remove_country_flag = hfe.605.step2
			remove_country_flag = hfe.605.step3
		}
	}
}

# drone awake
country_event = {
	id = hfe.606
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		hfe_trigger_story_enabled = yes
		exists = event_target:hfe_drone_country
		nor = {
			has_global_flag = hfe_drone_awake
			has_global_flag = hfe_has_event.606
		}
		# start it on 40+ year or earlier depend on difficulity
		check_variable_arithmetic = {
			which = trigger:years_passed
			divide = 5
			add = trigger:is_difficulty
			value > 8
		}
	}
	immediate = {
		random_playable_country = {
			weights = {
				base = 1
				modifier = {
					add = 1000
					is_ai = no
				}
			}
			save_event_target_as = hfe_606_target_country
		}
		if = {
			limit = {
				exists = event_target:hfe_606_target_country
			}
			random_system = {
				limit = {
					has_presence = no
					distance_to_empire = {
						who = event_target:hfe_606_target_country
						distance <= 50
					}
					any_system_planet = {
						is_planet_class = pc_gas_giant
					}
				}
				random_system_planet = {
					limit = {
						is_planet_class = pc_gas_giant
					}
					save_event_target_as = hfe_606_target
				}
			}
			if = {
				limit = {
					not = {
						exists = event_target:hfe_606_target
					}
				}
				event_target:hfe_606_target_country = {
					random_system_within_border = {
						limit = {
							any_system_planet = {
								not = {
									exists = owner
								}
								is_planet_class = pc_gas_giant
							}
						}
						random_system_planet = {
							limit = {
								not = {
									exists = owner
								}
							}
							save_event_target_as = hfe_606_target
						}
					}
				}
			}
			if = {
				limit = {
					exists = event_target:hfe_606_target
				}
				set_global_flag = hfe_has_event.606
				event_target:hfe_606_target_country = {
					country_event = {
						id = hfe.607
					}
				}
			}
		}
	}
}

# start special project
country_event = {
	id = hfe.607
	title = hfe.607.name
	desc = hfe.607.desc
	picture = GFX_evt_gas_giant
	show_sound = event_sensor_ping
	location = event_target:hfe_606_target
	trackable = yes
	is_triggered_only = yes
	immediate = {
		enable_special_project = {
			name = hfe_project_drone_awake
			location = event_target:hfe_606_target
			owner = root
		}
	}
	option = {
		name = hfe.607.0
		tooltip = {
			enable_special_project = {
				name = hfe_project_drone_awake
				location = event_target:hfe_606_target
				owner = root
			}
		}
	}
}

# project complete
ship_event = {
	id = hfe.608
	title = hfe.608.name
	desc = hfe.608.desc
	picture = GFX_evt_gas_giant
	show_sound = event_ship_thrusters
	location = event_target:hfe_606_target
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_drone_country
	}
	immediate = {
		event_target:hfe_drone_country = {
			country_event = {
				id = hfe.611
			}
		}
	}
	option = {
		name = hfe_at_the_sreen
		hidden_effect = {
			owner = {
				country_event = {
					id = hfe.609
				}
			}
		}
	}
}

# diplo event
country_event = {
	id = hfe.609
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.609.desc.0
				hfe_trigger_is_human = yes
			}
			fail_text = {
				text = hfe.609.desc.1
				hfe_trigger_is_human = yes
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = no_video_feed_room
	}
	option = {
		name = hfe.609.0
		exclusive_trigger = {
			hfe_trigger_is_human = yes
		}
		custom_tooltip = hfe.609.0.tooltip
	}
	option = {
		name = hfe.609.1
		exclusive_trigger = {
			exists = event_target:hfe_drone_country
			has_communications = event_target:hfe_drone_country
		}
		custom_tooltip = hfe.609.0.tooltip
	}
	option = {
		name = hfe.609.2
		exclusive_trigger = {
			is_machine_empire = yes
		}
		custom_tooltip = hfe.609.0.tooltip
	}
	option = {
		name = hfe.609.3
		custom_tooltip = hfe.609.0.tooltip
	}
}

# project failed
country_event = {
	id = hfe.610
	title = hfe.610.name
	desc = {
		trigger = {
			success_text = {
				text = hfe.610.desc.0.0
				has_country_flag = hfe_random_0
			}
			success_text = {
				text = hfe.610.desc.0.1
				has_country_flag = hfe_random_1
			}
			success_text = {
				text = hfe.610.desc.1
				has_communications = event_target:hfe_drone_country
			}
		}
	}
	picture = GFX_evt_gas_giant
	show_sound = event_sensor_ping
	location = event_target:hfe_606_target
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_drone_country
	}
	immediate = {
		hfe_effect_random_roll_flags_2_country = yes
		event_target:hfe_drone_country = {
			country_event = {
				id = hfe.611
			}
		}
	}
	option = {
		name = INTERESTING
	}
}

# actual awake effect
country_event = {
	id = hfe.611
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_global_flag = hfe_drone_awake
		remove_global_flag = hfe_has_event.606
		event_target:hfe_drone_country = {
			every_system_within_border = {
				every_neighbor_system = {
					limit = {
						is_surveyed = {
							who = root.owner
							status = no
						}
					}
					set_surveyed = {
						surveyed = yes
						surveyor = root.owner
					}
				}
			}
		}
	}
}

# friendly ai vol 1 thoth
first_contact_event = {
	id = hfe.698
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		contact_country = {
			is_country_type = hfe_thoth
		}
	}
	immediate = {
		if = {
			limit = {
				has_global_flag = hfe_thoth_awaked
			}
			finish_first_contact = yes
			owner = {
				establish_communications = event_target:hfe_thoth
				country_event = {
					id = hfe.705
				}
			}
		}
		else = {
			set_first_contact_stage = hfe_first_contact_thoth_1
		}
	}
}

# start event, spawn system
# Scope = Ship
# From = System
# FromFrom = Country
ship_event = {
	id = hfe.699
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		hfe_trigger_story_enabled = yes
		NOT = {
			has_global_flag = hfe_has_event.699
		}
		exists = owner
		owner = {
			is_ai = no
		}
		exists = from
	}
	immediate = {
		set_global_flag = hfe_has_event.699
		from = {
			spawn_system = {
				min_distance >= 3
				max_distance <= 10
				min_orientation_angle = 24
				max_orientation_angle = 66
				initializer = hfe_tsp_ssb_thoth_system_initializer
				hyperlane = yes
			}
		}
	}
}

# Scopes:
# - Root = first contact site
# - Root.Owner = your country (i.e. you should be able to scope from first contact scope to the owner via eventtarget.cpp)
# - From = other country
first_contact_event = {
	id = hfe.700
	title = hfe.700.name
	desc = hfe.700.desc
	picture = GFX_evt_hfe_thoth
	show_sound = event_ship_thrusters
	first_contact = yes
	location = solar_system
	is_triggered_only = yes
	immediate = {
		set_site_progress_locked = yes
	}
	after = {
		set_site_progress_locked = no
	}
	option = {
		name = hfe.700.0
		set_first_contact_stage = hfe_first_contact_thoth_2
	}
}

first_contact_event = {
	id = hfe.701
	title = hfe.701.name
	desc = hfe.701.desc
	picture = GFX_evt_hfe_thoth
	show_sound = event_ship_thrusters
	first_contact = yes
	location = solar_system
	is_triggered_only = yes
	immediate = {
		set_site_progress_locked = yes
		event_target:hfe_thoth_station = {
			hfe_effect_remove_signal_object_from_this = yes
		}
		set_global_flag = hfe_thoth_awaked
	}
	after = {
		set_site_progress_locked = no
	}
	option = {
		name = hfe_at_the_sreen
		hidden_effect = {
			owner = {
				establish_communications = event_target:hfe_thoth
				# ai doesnt need this event
				if = {
					limit = {
						is_ai = no
					}
					set_country_flag = hfe.702.0
					country_event = {
						id = hfe.702
					}
				}
			}
			finish_first_contact = yes
		}
	}
}

# dialog with station
country_event = {
	id = hfe.702
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.702.desc.0
				has_country_flag = hfe.702.0
			}
			success_text = {
				text = hfe.702.desc.1
				has_country_flag = hfe.702.1
			}
			success_text = {
				text = hfe.702.desc.2
				has_country_flag = hfe.702.2
			}
			success_text = {
				text = hfe.702.desc.3
				has_country_flag = hfe.702.3
			}
			success_text = {
				text = hfe.702.desc.4
				has_country_flag = hfe.702.4
			}
			success_text = {
				text = hfe.702.desc.5
				has_country_flag = hfe.702.5
			}
			success_text = {
				text = hfe.702.desc.6
				has_country_flag = hfe.702.6
			}
			success_text = {
				text = hfe.702.desc.goodend
				has_country_flag = hfe.702.goodend
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	# step 0
	option = {
		name = hfe.702.0.0
		exclusive_trigger = {
			has_country_flag = hfe.702.0
			is_xenophile = yes
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.0.1
		trigger = {
			has_country_flag = hfe.702.0
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.0.2
		exclusive_trigger = {
			has_country_flag = hfe.702.0
			is_hive_empire = yes
			NOT = {
				has_civic = civic_hive_devouring_swarm
			}
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.0.3
		# Terminators to other machine
		exclusive_trigger = {
			has_country_flag = hfe.702.0
			has_civic = civic_machine_terminator
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.0.4
		# Machine to machine
		exclusive_trigger = {
			has_country_flag = hfe.702.0
			is_machine_empire = yes
			NOT = {
				has_civic = civic_machine_terminator
			}
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.0.5
		# Obscure "Captain Underpants" reference
		exclusive_trigger = {
			has_country_flag = hfe.702.0
			has_civic = civic_hive_devouring_swarm
		}
		hfe_effect_event_702_next = yes
	}
	# step 1
	option = {
		name = hfe.702.1.0
		trigger = {
			has_country_flag = hfe.702.1
		}
		hfe_effect_event_702_next = yes
	}
	# step 2
	option = {
		name = hfe.702.2.0
		trigger = {
			has_country_flag = hfe.702.2
		}
		hfe_effect_event_702_next = yes
	}
	# step 3
	option = {
		name = hfe.702.3.0
		trigger = {
			has_country_flag = hfe.702.3
			is_gestalt = yes
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.1
		trigger = {
			has_country_flag = hfe.702.3
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.2
		trigger = {
			has_country_flag = hfe.702.3
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.3
		trigger = {
			has_country_flag = hfe.702.3
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.4
		trigger = {
			has_country_flag = hfe.702.3
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.5
		trigger = {
			has_country_flag = hfe.702.3
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.6
		trigger = {
			has_country_flag = hfe.702.3
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.7
		trigger = {
			has_country_flag = hfe.702.3
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.702.3.8
		trigger = {
			has_country_flag = hfe.702.3
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_702_next = yes
	}
	# step 4
	option = {
		name = hfe.702.4
		trigger = {
			has_country_flag = hfe.702.4
		}
		hfe_effect_event_702_next = yes
	}
	# step 5 ju ahet coming
	option = {
		name = hfe.702.5.0
		trigger = {
			has_country_flag = hfe.702.5
			exists = event_target:hfe_egypt_country
			event_target:hfe_egypt_country = {
				any_owned_fleet = {
					is_ship_class = shipclass_military
					fleet_power > 10000
				}
			}
		}
		hidden_effect = {
			event_target:hfe_egypt_country = {
				if = {
					limit = {
						not = {
							has_communications = root
						}
					}
					establish_communications_no_message = root
					root = {
						set_country_flag = hfe_egypt_contacted
					}
				}
				random_owned_fleet = {
					limit = {
						is_ship_class = shipclass_military
						fleet_power > 10000
					}
					set_location = {
						target = event_target:hfe_thoth_station
						distance = 30
						angle = random
					}
				}
			}
			hfe_effect_event_702_next = yes
		}
	}
	# if haven't ju ahet
	option = {
		name = hfe.702.5.1
		trigger = {
			has_country_flag = hfe.702.5
			nand = {
				exists = event_target:hfe_egypt_country
				event_target:hfe_egypt_country = {
					any_owned_fleet = {
						is_ship_class = shipclass_military
						fleet_power > 10000
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.702.5
			set_country_flag = hfe.702.6
			country_event = {
				id = hfe.702
			}
		}
	}
	# step 6 if haven't ju ahet
	option = {
		name = hfe.702.6.0
		response_text = hfe.702.6.0.response
		trigger = {
			has_country_flag = hfe.702.6
			has_country_flag = hfe_egypt_contacted
			not = {
				exists = event_target:hfe_egypt_country
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.702.6
		}
	}
	option = {
		name = hfe.702.6.1
		response_text = hfe.702.6.0.response
		trigger = {
			has_country_flag = hfe.702.6
			has_country_flag = hfe_egypt_contacted
			event_target:hfe_egypt_country = {
				not = {
					any_owned_fleet = {
						is_ship_class = shipclass_military
						fleet_power > 10000
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.702.6
		}
	}
	option = {
		name = hfe.702.6.2
		response_text = hfe.702.6.0.response
		trigger = {
			has_country_flag = hfe.702.6
			nand = {
				has_country_flag = hfe_egypt_contacted
				exists = event_target:hfe_egypt_country
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.702.6
		}
	}
	# end
	option = {
		name = hfe.702.goodend
		trigger = {
			has_country_flag = hfe.702.goodend
		}
		hidden_effect = {
			remove_country_flag = hfe.702.goodend
		}
	}
}

# dialog with fleet
country_event = {
	id = hfe.703
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.703.desc.6
				has_country_flag = hfe.702.6
			}
			success_text = {
				text = hfe.703.desc.7
				has_country_flag = hfe.702.7
			}
			success_text = {
				text = hfe.703.desc.goodend
				has_country_flag = hfe.702.goodend
			}
			success_text = {
				text = hfe.703.desc.badend.0
				has_country_flag = hfe.702.badend
				not = {
					has_country_flag = hfe.702.badend.0
				}
			}
			success_text = {
				text = hfe.703.desc.badend.1
				has_country_flag = hfe.702.badend
				has_country_flag = hfe.702.badend.0
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:hfe_egypt_country.species
		room = hfe_egypt_room
	}
	# step 6
	option = {
		name = hfe.703.6.0
		trigger = {
			has_country_flag = hfe.702.6
		}
		hfe_effect_event_702_next = yes
	}
	option = {
		name = hfe.703.6.1
		trigger = {
			has_country_flag = hfe.702.6
		}
		hidden_effect = {
			set_country_flag = hfe.702.badend
			set_country_flag = hfe.702.badend.0
		}
		hfe_effect_event_702_next = yes
	}
	# step 7
	option = {
		name = hfe.703.7.0
		custom_tooltip = hfe.703.7.high.tooltip
		trigger = {
			has_country_flag = hfe.702.7
			opinion = {
				who = event_target:hfe_egypt_country
				value > 50
			}
		}
		hidden_effect = {
			random_list = {
				9 = {
					set_country_flag = hfe.702.goodend
				}
				1 = {
					set_country_flag = hfe.702.badend
				}
			}
			hfe_effect_event_702_next = yes
		}
	}
	option = {
		name = hfe.703.7.1
		custom_tooltip = hfe.703.7.high.tooltip
		trigger = {
			has_country_flag = hfe.702.7
			relative_power = {
				who = event_target:hfe_egypt_country
				category = fleet
				value > equivalent
			}
		}
		hidden_effect = {
			# If you are stronger than a Fallen Emprie, a single, pacifistic heretic is not worth a war
			set_country_flag = hfe.702.goodend
			hfe_effect_event_702_next = yes
		}
	}
	option = {
		name = hfe.703.7.2
		custom_tooltip = hfe.703.7.high.tooltip
		trigger = {
			has_country_flag = hfe.702.7
			has_trait = trait_charismatic
		}
		hidden_effect = {
			random_list = {
				90 = {
					set_country_flag = hfe.702.goodend
				}
				10 = {
					set_country_flag = hfe.702.badend
				}
			}
			hfe_effect_event_702_next = yes
		}
	}
	option = {
		name = hfe.703.7.3
		custom_tooltip = hfe.703.7.midle.tooltip
		trigger = {
			has_country_flag = hfe.702.7
			is_militarist = yes
		}
		hidden_effect = {
			random_list = {
				6 = {
					set_country_flag = hfe.702.goodend
				}
				4 = {
					set_country_flag = hfe.702.badend
				}
			}
			hfe_effect_event_702_next = yes
		}
	}
	option = {
		name = hfe.703.7.4
		custom_tooltip = hfe.703.7.low.tooltip
		trigger = {
			has_country_flag = hfe.702.7
		}
		hidden_effect = {
			random_list = {
				10 = {
					# Low means low
					set_country_flag = hfe.702.goodend
				}
				10 = {
					set_country_flag = hfe.702.badend
				}
			}
			hfe_effect_event_702_next = yes
		}
	}
	# end
	option = {
		name = hfe.703.goodend
		trigger = {
			has_country_flag = hfe.702.goodend
		}
		hidden_effect = {
			country_event = {
				id = hfe.702
			}
		}
	}
	option = {
		name = hfe.703.badend
		custom_tooltip = hfe.703.badend.tooltip
		trigger = {
			has_country_flag = hfe.702.badend
		}
		hidden_effect = {
			remove_country_flag = hfe.702.badend
			event_target:hfe_thoth = {
				destroy_country = yes
			}
		}
	}
}

# not first contact, just info
country_event = {
	id = hfe.705
	title = TRANSMISSION
	desc = hfe.705.desc
	is_triggered_only = yes
	diplomatic = yes
	location = solar_system
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	trigger = {
		is_ai = no
	}
	option = {
		name = hfe.705.0
		default_hide_option = yes
	}
}

# start event diplomacy
country_event = {
	id = hfe.710
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			is_country_type = hfe_thoth
		}
		not = {
			has_country_flag = hfe.711_block
		}
		is_ai = no
	}
	immediate = {
		country_event = {
			id = hfe.711
		}
		set_country_flag = hfe.711_block
	}
}

# trade dialog
country_event = {
	id = hfe.711
	title = TRANSMISSION
	location = event_target:hfe_thoth_station
	# trackable = yes
	desc = hfe.711.desc.0.0
	desc = hfe.711.desc.0.1
	desc = hfe.711.desc.0.2
	desc = {
		exclusive_trigger = {
			or = {
				has_country_flag = hfe.711.4.1
				has_country_flag = hfe.711.4.2
				has_country_flag = hfe.711.4.3
				has_country_flag = hfe.711.4.4
				has_country_flag = hfe.711.4.5
			}
		}
		trigger = {
			# Gender question
			# dialog 0
			success_text = {
				text = hfe.711.desc.4.1
				has_country_flag = hfe.711.4.1
			}
			success_text = {
				text = hfe.711.desc.4.2
				has_country_flag = hfe.711.4.2
			}
			success_text = {
				text = hfe.711.desc.4.3
				has_country_flag = hfe.711.4.3
			}
			success_text = {
				text = hfe.711.desc.4.4
				has_country_flag = hfe.711.4.4
			}
			success_text = {
				text = hfe.711.desc.4.5.0
				has_country_flag = hfe.711.4.5
				any_relation = {
					has_country_flag = hfe_egypt
				}
			}
			success_text = {
				text = hfe.711.desc.4.5.1
				has_country_flag = hfe.711.4.5
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	force_open = yes
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	option = {
		name = hfe.711.0
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= @hfe_thoth_module_cost
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= @hfe_thoth_module_cost
			}
			custom_tooltip = {
				fail_text = hfe.711.module_ordered
				not = {
					has_country_flag = hfe.711.module_ordered
				}
			}
		}
		response_text = hfe.711.0.response
		is_dialog_only = yes
		add_resource = {
			energy = @hfe_thoth_module_cost_minus
			minerals = @hfe_thoth_module_cost_minus
		}
		hidden_effect = {
			set_country_flag = hfe.711.module_ordered
			set_country_flag = hfe.711.0.module_ordered
			country_event = {
				id = hfe.712
				days = 365
			}
		}
	}
	option = {
		name = hfe.711.1
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= @hfe_thoth_module_cost
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= @hfe_thoth_module_cost
			}
			custom_tooltip = {
				fail_text = hfe.711.module_ordered
				not = {
					has_country_flag = hfe.711.module_ordered
				}
			}
		}
		response_text = hfe.711.1.response
		is_dialog_only = yes
		add_resource = {
			energy = @hfe_thoth_module_cost_minus
			minerals = @hfe_thoth_module_cost_minus
		}
		hidden_effect = {
			set_country_flag = hfe.711.module_ordered
			set_country_flag = hfe.711.1.module_ordered
			country_event = {
				id = hfe.712
				days = 365
			}
		}
	}
	option = {
		name = hfe.711.2
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= @hfe_thoth_module_cost
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= @hfe_thoth_module_cost
			}
			custom_tooltip = {
				fail_text = hfe.711.module_ordered
				not = {
					has_country_flag = hfe.711.module_ordered
				}
			}
		}
		response_text = hfe.711.2.response
		is_dialog_only = yes
		add_resource = {
			energy = @hfe_thoth_module_cost_minus
			minerals = @hfe_thoth_module_cost_minus
		}
		hidden_effect = {
			set_country_flag = hfe.711.module_ordered
			set_country_flag = hfe.711.2.module_ordered
			country_event = {
				id = hfe.712
				days = 365
			}
		}
	}
	option = {
		name = hfe.711.3
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= @hfe_thoth_module_cost
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= @hfe_thoth_module_cost
			}
			custom_tooltip = {
				fail_text = hfe.711.module_ordered
				not = {
					has_country_flag = hfe.711.module_ordered
				}
			}
		}
		response_text = hfe.711.3.response
		is_dialog_only = yes
		add_resource = {
			energy = @hfe_thoth_module_cost_minus
			minerals = @hfe_thoth_module_cost_minus
		}
		hidden_effect = {
			set_country_flag = hfe.711.module_ordered
			set_country_flag = hfe.711.3.module_ordered
			country_event = {
				id = hfe.712
				days = 365
			}
		}
	}
	option = {
		name = hfe.711.4
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= @hfe_thoth_module_cost
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= @hfe_thoth_module_cost
			}
			custom_tooltip = {
				fail_text = hfe.711.module_ordered
				not = {
					has_country_flag = hfe.711.module_ordered
				}
			}
		}
		response_text = hfe.711.4.response
		is_dialog_only = yes
		add_resource = {
			energy = @hfe_thoth_module_cost_minus
			minerals = @hfe_thoth_module_cost_minus
		}
		hidden_effect = {
			set_country_flag = hfe.711.module_ordered
			set_country_flag = hfe.711.4.module_ordered
			country_event = {
				id = hfe.712
				days = 365
			}
		}
	}
	# dialog 0
	option = {
		name = hfe.711.4.0
		trigger = {
			NOR = {
				has_country_flag = hfe.711.4.1
				has_country_flag = hfe.711.4.2
				has_country_flag = hfe.711.4.3
				has_country_flag = hfe.711.4.4
				has_country_flag = hfe.711.4.5
				has_country_flag = hfe_did_you_just_assume_thoths_gender
			}
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.1
		trigger = {
			has_country_flag = hfe.711.4.1
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.2
		trigger = {
			has_country_flag = hfe.711.4.2
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.3
		trigger = {
			has_country_flag = hfe.711.4.3
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.4.0
		trigger = {
			has_country_flag = hfe.711.4.4
			any_relation = {
				has_country_flag = hfe_egypt
			}
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.4.1
		trigger = {
			has_country_flag = hfe.711.4.4
			not = {
				any_relation = {
					has_country_flag = hfe_egypt
				}
			}
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.4.5
		trigger = {
			has_country_flag = hfe.711.4.5
		}
		response_text = hfe.711.4.5.response
		is_dialog_only = yes
		allow = {
			hidden_trigger = {
				not = {
					has_country_flag = hfe.711.dialog.0.complete
				}
			}
		}
		enable_special_project = {
			name = hfe_project_thoth_memory
			location = event_target:hfe_thoth_station
			owner = root
		}
		if = {
			limit = {
				any_relation = {
					has_country_flag = hfe_egypt
				}
			}
			enable_special_project = {
				name = hfe_project_thoth_egypt_contact
				location = root.capital_scope
				owner = root
			}
		}
		hfe_effect_event_711_next = yes
	}
	option = {
		name = hfe.711.5
		trigger = {
			has_country_flag = hfe.711.dialog.0.complete
		}
		response_text = hfe.711.5.response
		is_dialog_only = yes
	}
	option = {
		name = hfe_end_transmission
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = hfe.711_block
		}
	}
	# after = {
	# 	every_country = {
	# 		limit = {
	# 			is_ai = yes
	# 			NOT = {
	# 				has_country_flag = ai_automatically_met_thoth
	# 			}
	# 		}
	# 		establish_communications_no_message = event_target:hfe_thoth
	# 		set_country_flag = ai_automatically_met_thoth
	# 	}
	# }
}

# complete module
country_event = {
	id = hfe.712
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.712.desc.0
				has_country_flag = hfe.711.0.module_ordered
			}
			success_text = {
				text = hfe.712.desc.1
				has_country_flag = hfe.711.1.module_ordered
			}
			success_text = {
				text = hfe.712.desc.2
				has_country_flag = hfe.711.2.module_ordered
			}
			success_text = {
				text = hfe.712.desc.3
				has_country_flag = hfe.711.3.module_ordered
			}
			success_text = {
				text = hfe.712.desc.4
				has_country_flag = hfe.711.4.module_ordered
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	force_open = yes
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	immediate = {
		switch = {
			trigger = has_country_flag
			hfe.711.0.module_ordered = {
				change_variable = {
					which = hfe_building_thoth_module_energy
					value = 1
				}
			}
			hfe.711.1.module_ordered = {
				change_variable = {
					which = hfe_building_thoth_module_mineral
					value = 1
				}
			}
			hfe.711.2.module_ordered = {
				change_variable = {
					which = hfe_building_thoth_module_food
					value = 1
				}
			}
			hfe.711.3.module_ordered = {
				change_variable = {
					which = hfe_building_thoth_module_science
					value = 1
				}
			}
			hfe.711.4.module_ordered = {
				change_variable = {
					which = hfe_building_thoth_module_industry
					value = 1
				}
			}
		}
	}
	option = {
		name = hfe.712.0
		hidden_effect = {
			remove_country_flag = hfe.711.module_ordered
			remove_country_flag = hfe.711.0.module_ordered
			remove_country_flag = hfe.711.1.module_ordered
			remove_country_flag = hfe.711.2.module_ordered
			remove_country_flag = hfe.711.3.module_ordered
			remove_country_flag = hfe.711.4.module_ordered
			country_event = {
				id = hfe.711
			}
		}
	}
	option = {
		name = hfe.712.1
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = hfe.711.module_ordered
			remove_country_flag = hfe.711.0.module_ordered
			remove_country_flag = hfe.711.1.module_ordered
			remove_country_flag = hfe.711.2.module_ordered
			remove_country_flag = hfe.711.3.module_ordered
		}
	}
	# after = {
	# 	every_country = {
	# 		limit = {
	# 			is_ai = yes
	# 			NOT = {
	# 				has_country_flag = ai_automatically_met_thoth
	# 			}
	# 		}
	# 		establish_communications_no_message = event_target:hfe_thoth
	# 		set_country_flag = ai_automatically_met_thoth
	# 	}
	# }
}

# memory installed
ship_event = {
	id = hfe.720
	title = hfe.720.name
	desc = hfe.720.desc
	picture = GFX_evt_hfe_thoth
	show_sound = event_ship_thrusters
	location = root
	is_triggered_only = yes
	immediate = {
		owner = {
			set_country_flag = hfe_thoth_memory_installed
		}
	}
	option = {
		name = hfe.720.0
	}
	option = {
		name = hfe.720.1
		hidden_effect = {
			random_list = {
				50 = {
					owner = {
						set_country_flag = hfe_thoth_memory_installed_spy
					}
				}
				50 = {
					owner = {
						country_event = {
							id = hfe.721
							days = 10
						}
					}
				}
			}
		}
	}
}

# fail
country_event = {
	id = hfe.721
	title = TRANSMISSION
	desc = hfe.721.desc
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	option = {
		name = hfe.721.0
		default_hide_option = yes
	}
}

# contact with ju ahet
country_event = {
	id = hfe.725
	title = TRANSMISSION
	desc = hfe.725.desc
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:hfe_egypt_species
		room = hfe_egypt_room
	}
	option = {
		name = hfe.725.0
		response_text = hfe.725.0.response
		default_hide_option = yes
	}
}

# kill country then station killed
# This = owner of ship 1 (destroyed)
# From = owner of ship 2 (combatant)
# FromFrom = ship 1
# FromFromFrom = ship 2
country_event = {
	id = hfe.726
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_country_flag = hfe_thoth
		fromfrom = {
			has_ship_flag = hfe_thoth_station
		}
	}
	immediate = {
		destroy_country = yes
	}
}

# A fleet has entered a system
# Scope = Fleet
# From = System
# on_entering_system_fleet
# try to relocate if hostiles enter system 727 - 729
fleet_event = {
	id = hfe.727
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		#		is_ship_class = shipclass_military
		exists = owner
		exists = event_target:hfe_thoth
		owner = {
			is_hostile = event_target:hfe_thoth
		}
		exists = solar_system
		solar_system = {
			any_fleet_in_system = {
				has_fleet_flag = hfe_thoth_station
			}
		}
	}
	immediate = {
		event_target:hfe_thoth = {
			country_event = {
				id = hfe.728
			}
		}
	}
}

# This = owner of fleet 1
# From = owner of fleet 2
# FromFrom = fleet 1
# FromFromFrom = fleet 2
# on_entering_battle
country_event = {
	id = hfe.728
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_thoth
		is_country = event_target:hfe_thoth
	}
	immediate = {
		random_relation = {
			limit = {
				NOT = {
					is_hostile = event_target:hfe_thoth
				}
				any_system_within_border = {
					not = {
						any_fleet_in_system = {
							exists = owner
							owner = {
								is_hostile = event_target:hfe_thoth
							}
						}
					}
				}
			}
			weights = {
				base = 1
				modifier = {
					add = 1000
					is_ai = no
				}
				modifier = {
					add = 100
					OR = {
						is_pacifist = yes
						is_xenophile = yes
					}
				}
				modifier = {
					factor = 0
					has_country_flag = hfe_egypt
				}
			}
			random_system_within_border = {
				limit = {
					not = {
						any_fleet_in_system = {
							exists = owner
							owner = {
								is_hostile = event_target:hfe_thoth
							}
						}
					}
				}
				random_system_planet = {
					event_target:hfe_thoth_station = {
						set_location = {
							target = prev
							distance = 10
						}
					}
				}
			}
			country_event = {
				id = hfe.729
			}
		}
	}
}

# notification dialog
country_event = {
	id = hfe.729
	title = hfe.729.name
	desc = {
		trigger = {
			fail_text = {
				text = hfe.729.desc.0
				has_country_flag = hfe.729.1
			}
			success_text = {
				text = hfe.729.desc.1
				has_country_flag = hfe.729.1
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = hfe_portrait_diplo_thoth
		room = hfe_thoth_room
	}
	trigger = {
		is_ai = no
	}
	option = {
		name = hfe.729.0.0
		trigger = {
			not = {
				has_country_flag = hfe.729.1
			}
		}
		default_hide_option = yes
		hidden_effect = {
			set_country_flag = hfe.729.1
			country_event = {
				id = hfe.729
			}
		}
	}
	option = {
		name = hfe.729.0.1
		trigger = {
			not = {
				has_country_flag = hfe.729.1
			}
			or = {
				has_ethic = ethic_gestalt_consciousness
				always = yes
			}
		}
		hidden_effect = {
			set_country_flag = hfe.729.1
			set_country_flag = hfe.729.1.0
			country_event = {
				id = hfe.729
			}
		}
	}
	option = {
		name = hfe.729.1.0
		trigger = {
			has_country_flag = hfe.729.1
			not = {
				has_country_flag = hfe.729.1.0
			}
		}
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = hfe.729.1
		}
	}
	option = {
		name = hfe.729.1.1
		trigger = {
			has_country_flag = hfe.729.1
			has_country_flag = hfe.729.1.0
		}
		hidden_effect = {
			remove_country_flag = hfe.729.1
			remove_country_flag = hfe.729.1.0
		}
	}
}

# Kad Republic section
# 5000-10000
# functional on actions events 5000 - 5050
# contact with future 5000 - 5002
country_event = {
	id = hfe.5000
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		from = {
			is_country_type = hfe_fallen
			has_country_flag = hfe_future
		}
	}
	immediate = {
		set_country_flag = hfe_future_contacted
		establish_communications = from
		if = {
			limit = {
				is_ai = no
			}
			from = {
				while = {
					limit = {
						nand = {
							any_owned_leader = {
								gender = female
							}
							any_owned_leader = {
								gender = male
								leader_class = commander
							}
						}
					}
					create_leader = {
						class = commander
						# TODO add gender
						species = this
						skill = 3
					}
				}
				random_owned_leader = {
					limit = {
						gender = female
					}
					save_event_target_as = hfe_female_leader
				}
				random_owned_leader = {
					limit = {
						gender = male
						leader_class = commander
					}
					save_event_target_as = hfe_male_leader
				}
			}
			set_country_flag = hfe.5001.step0
			country_event = {
				id = hfe.5001
			}
		}
	}
}

# main dialog
country_event = {
	id = hfe.5001
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.5001.desc.0
				has_country_flag = hfe.5001.step0
			}
			success_text = {
				text = hfe.5001.desc.1
				has_country_flag = hfe.5001.step1
			}
			success_text = {
				text = hfe.5001.desc.2
				has_country_flag = hfe.5001.step2
			}
			success_text = {
				text = hfe.5001.desc.3
				has_country_flag = hfe.5001.step3
			}
			success_text = {
				text = hfe.5001.desc.4
				has_country_flag = hfe.5001.step4
			}
			success_text = {
				text = hfe.5001.desc.5
				has_country_flag = hfe.5001.step5
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:hfe_female_leader
		room = hfe_future_room
	}
	# step 0
	option = {
		name = hfe.5001.0.0
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = no
			any_relation = {
				hfe_trigger_is_human = yes
			}
			is_xenophobe = yes
			is_homicidal = no
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.1
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = yes
			any_relation = {
				has_country_flag = hfe_egypt
			}
			is_homicidal = no
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.2
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = yes
			not = {
				any_relation = {
					has_country_flag = hfe_egypt
				}
			}
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.3
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = yes
			not = {
				any_relation = {
					has_country_flag = hfe_egypt
				}
			}
			is_materialist = yes
			is_homicidal = no
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.4
		trigger = {
			has_country_flag = hfe.5001.step0
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.5
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = no
			is_xenophobe = yes
			is_homicidal = no
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.6
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = no
			is_homicidal = no
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.7
		trigger = {
			has_country_flag = hfe.5001.step0
			hfe_trigger_is_human = no
			OR = {
				is_materialist = yes
				has_authority = auth_corporate
				has_civic = civic_merchant_guilds
				has_policy_flag = diplo_stance_mercantile
			}
			is_homicidal = no
		}
		hfe_effect_materialist_attraction.0 = yes
		add_resource = {
			energy = 500
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.8
		trigger = {
			has_country_flag = hfe.5001.step0
			is_machine_empire = yes
			is_homicidal = no
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.9
		trigger = {
			is_lithoid = yes
			is_homicidal = no
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.10
		custom_tooltip = hfe.5001.0.10.tooltip
		trigger = {
			has_country_flag = hfe.5001.step0
			is_hive_empire = yes
			is_homicidal = no
		}
		hfe_effect_add_unity.1 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.0.11
		trigger = {
			is_homicidal = yes
			NOT = {
				has_civic = civic_hive_devouring_swarm
			}
		}
		hfe_effect_event_47_clear_flags = yes
	}
	# I will milk this obscure reference dry
	option = {
		name = hfe_features.14.7
		trigger = {
			has_civic = civic_hive_devouring_swarm
		}
		hfe_effect_event_47_clear_flags = yes
	}
	option = {
		name = hfe.5001.0.12
		trigger = {
			has_civic = civic_hive_devouring_swarm
		}
		hfe_effect_event_47_clear_flags = yes
	}
	# step 1
	option = {
		name = hfe.5001.1.0
		trigger = {
			hfe_trigger_is_human = yes
			has_country_flag = hfe.5001.step1
		}
		hidden_effect = {
			set_country_flag = hfe.5001.step2.human
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.1.1
		trigger = {
			has_country_flag = hfe.5001.step1
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.1.2
		trigger = {
			has_country_flag = hfe.5001.step1
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.1.3
		trigger = {
			has_country_flag = hfe.5001.step1
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.1.4
		trigger = {
			has_country_flag = hfe.5001.step1
			is_xenophobe = no
			is_xenophile = no
			is_spiritualist = no
			hfe_trigger_is_human = no
		}
		hfe_effect_event_5001_next = yes
	}
	# step 2
	option = {
		name = hfe.5001.2.0
		trigger = {
			has_country_flag = hfe.5001.step2
			has_country_flag = hfe.5001.step2.human
		}
		hidden_effect = {
			remove_country_flag = hfe.5001.step2.human
			set_country_flag = hfe.5001.step3.human
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.2.1
		trigger = {
			has_country_flag = hfe.5001.step2
			not = {
				has_country_flag = hfe.5001.step2.human
			}
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.2.2
		trigger = {
			has_country_flag = hfe.5001.step2
			is_xenophobe = yes
			not = {
				has_country_flag = hfe.5001.step2.human
			}
		}
		hfe_effect_xenophobe_attraction.1 = yes
		hidden_effect = {
			remove_country_flag = hfe.5001.step2
		}
	}
	option = {
		name = hfe.5001.2.3
		trigger = {
			has_country_flag = hfe.5001.step2
			is_xenophobe = no
			not = {
				has_country_flag = hfe.5001.step2.human
			}
		}
		hidden_effect = {
			remove_country_flag = hfe.5001.step2
		}
	}
	# step 3
	option = {
		name = hfe.5001.3.0
		trigger = {
			has_country_flag = hfe.5001.step3
			has_country_flag = hfe.5001.step3.human
		}
		hidden_effect = {
			remove_country_flag = hfe.5001.step3.human
			set_country_flag = hfe.5001.step4.human
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.1
		trigger = {
			has_country_flag = hfe.5001.step3
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.2
		trigger = {
			has_country_flag = hfe.5001.step3
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.3
		trigger = {
			has_country_flag = hfe.5001.step3
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.4
		trigger = {
			has_country_flag = hfe.5001.step3
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.5
		trigger = {
			has_country_flag = hfe.5001.step3
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.6
		trigger = {
			has_country_flag = hfe.5001.step3
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.7
		trigger = {
			has_country_flag = hfe.5001.step3
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.3.8
		trigger = {
			has_country_flag = hfe.5001.step3
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	# step 4
	option = {
		name = hfe.5001.4.0
		trigger = {
			has_country_flag = hfe.5001.step4
			has_country_flag = hfe.5001.step4.human
		}
		hidden_effect = {
			remove_country_flag = hfe.5001.step4.human
			set_country_flag = hfe.5001.step5.human
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.1
		trigger = {
			has_country_flag = hfe.5001.step4
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.2
		trigger = {
			has_country_flag = hfe.5001.step4
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.3
		trigger = {
			has_country_flag = hfe.5001.step4
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.4
		trigger = {
			has_country_flag = hfe.5001.step4
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.5
		trigger = {
			has_country_flag = hfe.5001.step4
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.6
		trigger = {
			has_country_flag = hfe.5001.step4
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.7
		trigger = {
			has_country_flag = hfe.5001.step4
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.4.8
		trigger = {
			has_country_flag = hfe.5001.step4
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	# step 5
	option = {
		name = hfe.5001.5.0
		trigger = {
			has_country_flag = hfe.5001.step5
			has_country_flag = hfe.5001.step5.human
		}
		hidden_effect = {
			remove_country_flag = hfe.5001.step5.human
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.1
		trigger = {
			has_country_flag = hfe.5001.step5
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.2
		trigger = {
			has_country_flag = hfe.5001.step5
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.3
		trigger = {
			has_country_flag = hfe.5001.step5
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.4
		trigger = {
			has_country_flag = hfe.5001.step5
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.5
		trigger = {
			has_country_flag = hfe.5001.step5
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.6
		trigger = {
			has_country_flag = hfe.5001.step5
			is_pacifist = yes
		}
		hfe_effect_pacifist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.7
		trigger = {
			has_country_flag = hfe.5001.step5
			is_spiritualist = yes
		}
		hfe_effect_spiritualist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.5.8
		trigger = {
			has_country_flag = hfe.5001.step5
			is_materialist = yes
		}
		hfe_effect_materialist_attraction.0 = yes
		hfe_effect_event_5001_next = yes
	}
}

# part 2 for male portrait
country_event = {
	id = hfe.5002
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.5001.desc.6.1
				has_country_flag = hfe.5001.step6
				OR = {
					is_species_class = HUM
					is_species_class = MAM
					hfe_trigger_is_human = yes
				}
			}
			success_text = {
				text = hfe.5001.desc.6.2
				has_country_flag = hfe.5001.step6
				NOT = {
					is_species_class = HUM
					is_species_class = MAM
					hfe_trigger_is_human = yes
				}
			}
			success_text = {
				text = hfe.5001.desc.7
				has_country_flag = hfe.5001.step7
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:hfe_male_leader
		room = hfe_future_room
	}
	# step 6
	option = {
		name = hfe.5001.6.0
		trigger = {
			has_country_flag = hfe.5001.step6
			is_species_class = HUM
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.6.1
		trigger = {
			has_country_flag = hfe.5001.step6
			not = {
				is_species_class = HUM
			}
		}
		hfe_effect_event_5001_next = yes
	}
	option = {
		name = hfe.5001.7.0
		trigger = {
			has_country_flag = hfe.5001.step7
		}
		hfe_effect_event_5001_next = yes
	}
}

# awake make future default country, start expansion era 5010 - 5012
country_event = {
	id = hfe.5010
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		hfe_trigger_human_fallen_awake = yes
	}
	immediate = {
		set_timed_global_flag = {
			flag = hfe_awake_block
			years = 10
		}
		set_country_type = default
		hfe_effect_cleanse_ethics = yes
		country_add_ethic = ethic_militarist
		country_add_ethic = ethic_egalitarian
		country_add_ethic = ethic_xenophile
		change_government = {
			authority = auth_democratic
			civics = {
				civic = hfe_civic_future_virtual_train
				civic = hfe_civic_future_mobilisation
				civic = hfe_civic_future_comand
			}
		}
		every_owned_pop = {
			random_list = {
				1 = {
					pop_change_ethic = ethic_militarist
				}
				1 = {
					pop_change_ethic = ethic_egalitarian
				}
				1 = {
					pop_change_ethic = ethic_xenophile
				}
			}
		}
		kill_leader = {
			ruler = yes
		}
		create_leader = {
			class = random_ruler
			skill = 5
		}
		assign_leader = last_created_leader
		# really need it?
		# set_policy = {
		# 	policy = refugees
		# 	option = refugees_allowed
		# 	cooldown = yes
		# }
		every_playable_country = {
			establish_communications_no_message = root
			country_event = {
				id = hfe.5011
			}
		}
	}
}

# future expansion notification
country_event = {
	id = hfe.5011
	title = hfe.5011.name
	desc = hfe.5011.desc.0
	diplomatic = yes
	location = event_target:hfe_future_country.capital_scope
	show_sound = event_alien_signal
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:hfe_future_country.ruler
		room = hfe_future_room
	}
	option = {
		name = hfe.5011.0
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = hfe_future_contacted
				}
				custom_tooltip = hfe.5011.0.tooltip
				country_event = {
					id = hfe.5012
					days = 10
					random = 25
				}
			}
			else = {
				set_country_flag = hfe_future_contacted
			}
		}
	}
}

# future expansion notification invite
country_event = {
	id = hfe.5012
	title = TRANSMISSION
	desc = hfe.5012.desc
	diplomatic = yes
	show_sound = placeholder_sfx
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:hfe_future_country
		room = hfe_future_room
	}
	option = {
		name = hfe.5012.0
		join_alliance = {
			who = event_target:hfe_future_country
			name = hfe_future_federation_name
			override_requirements = yes
		}
		hfe_effect_advisor_future_on = yes
		play_sound = event_celebration
		ai_chance = {
			modifier = {
				factor = 4
				not = {
					exists = event_target:hfe_future_country.federation
				}
			}
			modifier = {
				factor = 2
				event_target:hfe_future_country.federation = {
					num_members < 4
				}
			}
			modifier = {
				factor = 0
				exists = overlord
				is_loyal_to = overlord
			}
		}
	}
	option = {
		name = hfe.5012.1
		default_hide_option = yes
	}
}

# assimilation event (turn regular subject into coalition member subject type) 5020 - 5021
# country_event = {
# 	id = hfe.5020
# 	hide_window = yes
# 	is_triggered_only = yes
# 	# trigger = {
# 	# 	any_subject = {
# 	# 		not = {
# 	# 			any_agreement = { agreement_preset = preset_hfe_vassal_future }
# 	# 		}
# 	# 	}
# 	# }
# 	immediate = {
# 		every_subject = {
# 			limit = {
# 				not = {
# 					any_agreement = {
# 						agreement_preset = preset_hfe_vassal_future
# 					}
# 				}
# 			}
# 			set_subject_of = {
# 				who = root
# 				preset = preset_hfe_vassal_future
# 			}
# 			country_event = {
# 				id = hfe.5021
# 			}
# 		}
# 	}
# }
# inform player
country_event = {
	id = hfe.5021
	title = hfe.5021.name
	desc = hfe.5021.desc
	show_sound = placeholder_sfx
	picture = {
		trigger = {
			has_country_flag = hfe_random_0
		}
		picture = GFX_evt_hfe_coalition
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_1
		}
		picture = GFX_evt_galactic_senate
	}
	show_sound = event_administrative_work
	is_triggered_only = yes
	trigger = {
		is_ai = no
	}
	immediate = {
		hfe_effect_random_roll_flags_2_country = yes
	}
	option = {
		name = hfe.5021.0
		hfe_effect_advisor_future_on = yes
	}
}

# anomalies and after survey on actions 5050 - 5100
# criopods anomaly 5050 - 5055
# switch to country
ship_event = {
	id = hfe.5050
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
			save_event_target_as = hfe_criopods_planet
		}
		owner = {
			country_event = {
				id = hfe.5051
			}
		}
	}
}

# main event
country_event = {
	id = hfe.5051
	title = hfe.5051.name
	desc = {
		trigger = {
			# step 0
			# have contact
			success_text = {
				text = hfe.5051.desc.0.0
				has_country_flag = hfe_future_contacted
			}
			# havent contact
			fail_text = {
				text = hfe.5051.desc.0.1
				has_country_flag = hfe_future_contacted
			}
			# human addition
			success_text = {
				text = hfe.5051.desc.0.2
				not = {
					has_country_flag = hfe_future_contacted
				}
				hfe_trigger_is_human = yes
			}
			# step 1
			text = hfe.5051.desc.1.0
			# step 2
			# human
			# have contact
			success_text = {
				text = hfe.5051.desc.2.0
				has_country_flag = hfe_future_contacted
				hfe_trigger_is_human = yes
			}
			# havent contact
			success_text = {
				text = hfe.5051.desc.2.1
				not = {
					has_country_flag = hfe_future_contacted
				}
				hfe_trigger_is_human = yes
			}
			# non human
			# xenophobe
			success_text = {
				text = hfe.5051.desc.2.2
				hfe_trigger_is_human = no
				is_xenophobe = yes
			}
			# xenophile
			success_text = {
				text = hfe.5051.desc.2.3
				hfe_trigger_is_human = no
				is_xenophile = yes
			}
			# authoritarian
			success_text = {
				text = hfe.5051.desc.2.4
				hfe_trigger_is_human = no
				is_xenophobe = no
				is_xenophile = no
				hfe_trigger_is_authoritarian = yes
			}
			# egalitarian
			success_text = {
				text = hfe.5051.desc.2.5
				hfe_trigger_is_human = no
				is_xenophobe = no
				is_xenophile = no
				is_egalitarian = yes
			}
		}
	}
	picture = {
		trigger = {
			is_xenophobe = yes
		}
		picture = GFX_evt_clones
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_0
		}
		picture = GFX_evt_hfe_criopods
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_1
		}
		picture = GFX_evt_hfe_colony_new
	}
	show_sound = event_mystic_reveal
	location = event_target:hfe_criopods_planet
	is_triggered_only = yes
	immediate = {
		hfe_effect_random_roll_flags_2_country = yes
	}
	option = {
		name = hfe.5051.0
		trigger = {
			has_country_flag = hfe_future_contacted
			hfe_trigger_is_human = yes
		}
		event_target:hfe_criopods_planet = {
			create_pop = {
				species = event_target:hfe_future_species
			}
			set_owner = root
		}
	}
	option = {
		name = hfe.5051.1
		trigger = {
			not = {
				has_country_flag = hfe_future_contacted
			}
			hfe_trigger_is_human = yes
		}
		event_target:hfe_criopods_planet = {
			create_pop = {
				species = event_target:hfe_future_species
			}
			set_owner = root
		}
	}
	option = {
		name = hfe.5051.2
		trigger = {
			hfe_trigger_is_human = no
			is_xenophobe = yes
			is_homicidal = no
		}
		event_target:hfe_criopods_planet = {
			create_pop = {
				species = event_target:hfe_future_species
			}
			set_owner = root
		}
	}
	option = {
		name = hfe.5051.3
		trigger = {
			hfe_trigger_is_human = no
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.3 = yes
	}
	option = {
		name = hfe.5051.4
		trigger = {
			hfe_trigger_is_human = no
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
		event_target:hfe_criopods_planet = {
			create_pop = {
				species = event_target:hfe_future_species
			}
			set_owner = root
		}
	}
	option = {
		name = hfe.5051.5
		trigger = {
			hfe_trigger_is_human = no
			is_xenophobe = no
			is_xenophile = no
			hfe_trigger_is_authoritarian = yes
		}
		hfe_effect_authoritarian_attraction.0 = yes
		event_target:hfe_criopods_planet = {
			create_pop = {
				species = event_target:hfe_future_species
			}
			set_owner = root
		}
	}
	option = {
		name = hfe.5051.6
		trigger = {
			hfe_trigger_is_human = no
			is_xenophobe = no
			is_xenophile = no
			is_egalitarian = yes
		}
		hfe_effect_egalitarian_attraction.0 = yes
		hidden_effect = {
			hfe_effect_random_roll_flags_3_country = yes
			country_event = {
				id = hfe.5052
				days = 15
				random = 15
			}
		}
	}
}

# step 2 for egalitarian
country_event = {
	id = hfe.5052
	title = hfe.5052.name
	desc = {
		trigger = {
			switch = {
				trigger = has_country_flag
				hfe_random_0 = {
					text = hfe.5052.desc.1
				}
				hfe_random_1 = {
					text = hfe.5052.desc.2
				}
				hfe_random_2 = {
					text = hfe.5052.desc.3
				}
			}
		}
	}
	picture = GFX_evt_hfe_colony_new
	show_sound = event_mystic_reveal
	location = event_target:hfe_criopods_planet
	is_triggered_only = yes
	immediate = {
		event_target:hfe_criopods_planet = {
			create_country = {
				type = default
				species = event_target:hfe_future_species
				ethos = {
					ethic = ethic_fanatic_egalitarian
					ethic = ethic_militarist
				}
				effect = {
					prev = {
						create_colony = {
							owner = prev
						}
					}
					establish_communications_no_message = root
					# TODO on revision put some bonus modifiers on planet and give tier tech to country
				}
			}
		}
	}
	option = {
		name = hfe.5052.1
		trigger = {
			has_country_flag = hfe_random_0
		}
		event_target:hfe_criopods_planet = {
			set_owner = root
		}
	}
	option = {
		name = hfe.5052.2
		trigger = {
			has_country_flag = hfe_random_1
		}
		event_target:hfe_criopods_planet.owner = {
			set_subject_of = {
				who = root
				preset = preset_protectorate
			}
		}
	}
	option = {
		name = hfe.5052.3
		trigger = {
			has_country_flag = hfe_random_2
		}
	}
	option = {
		name = hfe.5052.4
		trigger = {
			has_country_flag = hfe_random_2
			is_militarist = yes
		}
		hfe_effect_militarist_attraction.1 = yes
		declare_war = {
			target = event_target:hfe_criopods_planet.owner
			attacker_war_goal = hfe_wg_annex
		}
	}
}

# dead worms anomaly 5055 - 5057
# start
ship_event = {
	id = hfe.5055
	title = hfe.5055.name
	desc = hfe.5055.desc
	picture = GFX_evt_hfe_space_debris
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
		}
	}
	option = {
		name = hfe_at_the_sreen
		hfe_effect_leader_add_exp = {
			hfe_exp = 200
		}
		hidden_effect = {
			owner = {
				country_event = {
					id = hfe.5056
				}
			}
		}
	}
}

# diplo event
country_event = {
	id = hfe.5056
	title = hfe.5056.name
	desc = hfe.5056.desc
	is_triggered_only = yes
	diplomatic = yes
	immediate = {
		play_sound = olafur_arnalds_only_the_winds
	}
	picture_event_data = {
		room = hfe_dead_worms_room
	}
	option = {
		name = hfe.5056.0
		response_text = hfe.5056.0.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.5056.1
		response_text = hfe.5056.1.response
		is_dialog_only = yes
	}
	option = {
		name = hfe.5056.2
		hidden_effect = {
			country_event = {
				id = hfe.5057
			}
		}
	}
}

# for pic
country_event = {
	id = hfe.5057
	title = hfe.5056.name
	desc = hfe.5056.2.response
	#show_sound = event_space_battle
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = hfe_bombardment_room
	}
	option = {
		name = hfe.5056.3
		exclusive_trigger = {
			is_xenophobe = yes
		}
		hfe_effect_xenophobe_attraction.0 = yes
	}
	option = {
		name = hfe.5056.4
		exclusive_trigger = {
			is_xenophile = yes
		}
		hfe_effect_xenophile_attraction.0 = yes
	}
	option = {
		name = hfe.5056.5
		exclusive_trigger = {
			hfe_trigger_is_clever_for_event = yes
		}
		hfe_effect_materialist_attraction.0 = yes
	}
	option = {
		name = hfe.5056.6
	}
}

# necrotic autoevolution 5060
# after anomaly or if survey planet there someone get anomaly
ship_event = {
	id = hfe.5060
	title = hfe.5060.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.5060.desc.0
				text = newline
				success_text = {
					text = hfe.5060.desc.1.0
					has_country_flag = hfe_future_contacted
				}
				fail_text = {
					text = hfe.5060.desc.1.1
					has_country_flag = hfe_future_contacted
				}
				text = newline
				text = hfe.5060.desc.2
			}
		}
	}
	picture = GFX_evt_hfe_ruins_robots
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
			add_modifier = {
				modifier = hfe_necrotic_autoevolution
			}
			set_deposit = hfe_deposit_necrotic_autoevolution_0
		}
		owner = {
			country_event = {
				id = hfe.5070
			}
		}
	}
	option = {
		name = hfe.5060.0
		trigger = {
			owner = {
				is_militarist = yes
			}
		}
		owner = {
			hfe_effect_militarist_attraction.0 = yes
		}
	}
	option = {
		name = hfe.5060.1
		trigger = {
			owner = {
				is_pacifist = yes
			}
		}
		owner = {
			hfe_effect_pacifist_attraction.0 = yes
		}
	}
	option = {
		name = hfe.5060.2
		trigger = {
			owner = {
				is_xenophobe = yes
			}
		}
		owner = {
			hfe_effect_xenophobe_attraction.0 = yes
		}
	}
	option = {
		name = hfe.5060.3
		trigger = {
			owner = {
				is_militarist = no
				is_pacifist = no
				is_xenophobe = no
			}
		}
	}
}

# then mining station build
ship_event = {
	id = hfe.5061
	title = hfe.5061.name
	desc = hfe.5061.desc
	picture = GFX_evt_hfe_ruins_robots
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		exists = owner
		from = {
			has_modifier = hfe_necrotic_autoevolution
			not = {
				has_deposit = hfe_deposit_necrotic_autoevolution_1
			}
		}
	}
	immediate = {
		from = {
			set_deposit = hfe_deposit_necrotic_autoevolution_1
		}
	}
	option = {
		name = hfe.5061.0
		owner = {
			hfe_effect_materialist_attraction.0 = yes
		}
	}
}

# find kad republic chain 5070
country_event = {
	id = hfe.5070
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:hfe_future_country
		nor = {
			has_event_chain = hfe_chain_find_future_star
			event_target:hfe_future_country = {
				has_communications = root
			}
		}
		is_ai = no
	}
	immediate = {
		begin_event_chain = {
			event_chain = hfe_chain_find_future_star
			target = root
		}
		event_target:hfe_future_country.capital_scope.solar_system = {
			set_star_flag = hfe_chain_find_future_star@root
			root = {
				create_point_of_interest = {
					id = hfe_chain_find_future_star.0
					name = hfe_chain_find_future_star_name.0
					desc = hfe_chain_find_future_star_desc.0
					event_chain = hfe_chain_find_future_star
					location = prev
				}
			}
		}
	}
}

# end chain then contacted
country_event = {
	id = hfe.5071
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_event_chain = hfe_chain_find_future_star
		exists = from
		exists = event_target:hfe_future_country
		from = {
			is_country = event_target:hfe_future_country
		}
	}
	immediate = {
		end_event_chain = hfe_chain_find_future_star
	}
}

# blight event 5079 - 5090
# event after anomaly
ship_event = {
	id = hfe.5079
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
		}
		owner = {
			country_event = {
				id = hfe.5080
			}
		}
	}
}

# switch to country scope
country_event = {
	id = hfe.5080
	title = hfe.5080.name
	desc = {
		trigger = {
			# normal
			success_text = {
				text = hfe.5080.desc.0.0
				is_machine_empire = no
			}
			success_text = {
				text = hfe.5080.desc.0.1
				has_country_flag = hfe_future_contacted
				is_machine_empire = no
			}
			success_text = {
				text = hfe.5080.desc.0.2
				not = {
					has_country_flag = hfe_future_contacted
				}
				is_machine_empire = no
			}
			success_text = {
				text = hfe.5080.desc.0.3
				is_machine_empire = no
			}
			# robots
			success_text = {
				text = hfe.5080.desc.1
				has_valid_civic = civic_machine_servitor
			}
			success_text = {
				text = hfe.5080.desc.2
				has_valid_civic = civic_machine_assimilator
			}
			success_text = {
				text = hfe.5080.desc.3
				has_valid_civic = civic_machine_terminator
			}
			success_text = {
				text = hfe.5080.desc.4
				is_machine_empire = yes
				nor = {
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_terminator
				}
			}
		}
	}
	picture = GFX_evt_hfe_robot_city
	show_sound = event_activating_unknown_technology
	location = root
	is_triggered_only = yes
	immediate = {
		save_event_target_as = hfe_blight_remnants
		if = {
			limit = {
				is_machine_empire = no
			}
			# some generic machine species
			create_species = {
				class = MACHINE
				traits = {
					trait = trait_machine_unit
					trait = random_traits
				}
				effect = {
					save_event_target_as = hfe_blight_machine_species
				}
			}
		}
		else = {
			species = {
				save_event_target_as = hfe_blight_machine_species
			}
		}
		create_country = {
			type = default
			name = "The Great Blight"
			ship_prefix = "Manager Drone"
			name_list = HIVE
			# need to pass machine species because new bug/intended vanilla feature
			species = event_target:hfe_blight_machine_species
			ethos = {
				ethic = ethic_gestalt_consciousness
			}
			authority = auth_machine_intelligence
			origin = hfe_origin_blight
			civics = {
				civic = civic_machine_assimilator
				civic = random
			}
			flag = {
				icon = {
					category = hfe_emblem
					file = hfe_emblem_blight.dds
				}
				background = {
					category = backgrounds
					file = 00_solid.dds
				}
				colors = {
					"dark_green"
					"black"
					"null"
					"null"
				}
			}
			ignore_initial_colony_error = yes
			released_from_country = event_target:hfe_blight_remnants
			effect = {
				hfe_effect_resource_bonus = yes
				if = {
					limit = {
						event_target:hfe_blight_remnants = {
							is_machine_empire = no
						}
						exists = event_target:hfe_blight_remnants.ruler
					}
					clone_leader = {
						target = event_target:hfe_blight_remnants.ruler
						# class = random_ruler
						traits = {
							# immortal
							trait = leader_trait_ruler_machine_intelligence
							trait = leader_trait_cyborg
						}
						effect = {
							# its already in ruler's title
							# set_name = "Voice of Blight"
							owner = {
								assign_leader = prev
							}
						}
					}
				}
				save_event_target_as = hfe_blight
				# ai cheats
				add_modifier = {
					modifier = hfe_space_boom
					years = 10
				}
				# take planets
				event_target:hfe_blight_remnants.capital_scope = {
					while = {
						count = 30
						limit = {
							event_target:hfe_blight_remnants = {
								num_owned_planets > 1
								check_variable = {
									which = hfe_blight_counter
									value < 4
								}
							}
						}
						closest_system = {
							limit = {
								is_owned_by = event_target:hfe_blight_remnants
							}
							every_system_planet = {
								limit = {
									is_owned_by = event_target:hfe_blight_remnants
								}
								set_owner = event_target:hfe_blight
								every_planet_army = {
									limit = {
										is_owned_by = event_target:hfe_blight_remnants
									}
									set_owner = event_target:hfe_blight
								}
								event_target:hfe_blight_remnants = {
									change_variable = {
										which = hfe_blight_counter
										value = 1
									}
								}
							}
							every_fleet_in_system = {
								limit = {
									is_owned_by = event_target:hfe_blight_remnants
								}
								# this rename every fleet including mining stations but why not
								set_name = "Directive 666 Drones"
								set_owner = event_target:hfe_blight
								if = {
									limit = {
										exists = leader
									}
									leader = {
										# TODO test set owner on fleet should cover it?
										# set_owner = prev.owner
										add_trait_no_notify = leader_trait_cyborg
									}
								}
							}
							starbase = {
								set_owner = event_target:hfe_blight
							}
						}
					}
				}
				# upgrade taken leaders
				every_owned_leader = {
					add_trait_no_notify = leader_trait_cyborg
				}
				# ai need machine pop to build machine armies and it take too much time
				create_fleet = {
					name = "Integration Force"
					effect = {
						set_owner = prev
						while = {
							count = 12
							create_army_transport = {
								army_type = machine_assault_1
								species = event_target:hfe_blight_machine_species
							}
						}
						set_fleet_stance = passive
						set_location = prev.capital_scope
					}
				}
				set_built_species = event_target:hfe_blight_machine_species
				event_target:hfe_blight_remnants.species = {
					if = {
						limit = {
							hfe_trigger_is_robot = no
						}
						modify_species = {
							add_trait = trait_cybernetic
							change_scoped_species = no
							effect = {
								prevprev = {
									change_dominant_species = {
										species = prev
									}
								}
							}
						}
					}
				}
				every_owned_pop = {
					pop_event = {
						id = hfe.5085
					}
				}
				declare_war = {
					target = event_target:hfe_blight_remnants
					attacker_war_goal = hfe_wg_annex
					name = "The Great Blight"
				}
				event_target:hfe_blight_remnants = {
					random_list = {
						20 = {
							set_name = {
								key = "[species.GetName] Remnants"
								variable_string = "[species.GetName]"
							}
						}
						10 = {
							set_name = {
								key = "Final [species.GetNamePlural]"
								variable_string = "[species.GetNamePlural]"
							}
						}
						10 = {
							set_name = {
								key = "Last of [species.GetNamePlural]"
								variable_string = "[species.GetNamePlural]"
							}
						}
						5 = {
							set_name = {
								key = "[this.GetSpeciesNamePluralCompliment] the Enders"
								variable_string = "[this.GetSpeciesNamePluralCompliment]"
							}
						}
						5 = {
							set_name = {
								key = "[hfe_blight_machine_species.GetSpeciesNameInsult] Hunters"
								variable_string = "[hfe_blight_machine_species.GetSpeciesNameInsult]"
							}
						}
						1 = {
							set_name = "The End"
						}
						1 = {
							set_name = "Last Hope"
						}
						1 = {
							set_name = "Dark Days"
						}
					}
					if = {
						limit = {
							is_machine_empire = no
						}
						kill_leader = {
							ruler = yes
						}
					}
					clear_variable = hfe_blight_counter
				}
				country_event = {
					id = hfe.5086
				}
				# copy relics maybe
			}
		}
	}
	# switch to blight
	option = {
		name = hfe.5080.0
		trigger = {
			is_ai = no
		}
		allow = {
			event_target:hfe_blight = {
				is_ai = yes
			}
		}
		event_target:hfe_blight = {
			set_player = event_target:hfe_blight_remnants
			hidden_effect = {
				# remove ai cheat
				remove_modifier = hfe_space_boom
				country_event = {
					id = hfe.5081
				}
			}
		}
	}
	option = {
		name = hfe.5080.1
		trigger = {
			is_machine_empire = no
		}
	}
	option = {
		name = hfe.5080.2
		trigger = {
			has_valid_civic = civic_machine_servitor
		}
	}
	# TODO option to insta annex for assimilator its 2 assimilators after all
	option = {
		name = hfe.5080.3
		trigger = {
			has_valid_civic = civic_machine_assimilator
		}
	}
	option = {
		name = hfe.5080.4
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
	option = {
		name = hfe.5080.5
		trigger = {
			is_machine_empire = yes
			nor = {
				has_valid_civic = civic_machine_servitor
				has_valid_civic = civic_machine_assimilator
				has_valid_civic = civic_machine_terminator
			}
		}
	}
	after = {
		hidden_effect = {
			event_target:hfe_blight_remnants = {
				country_event = {
					id = hfe.5082
				}
			}
		}
	}
}

# event for blight
country_event = {
	id = hfe.5081
	title = hfe.5081.name
	desc = hfe.5081.desc
	picture = GFX_evt_hfe_robot_city
	show_sound = event_screams
	location = root
	is_triggered_only = yes
	trigger = {
		is_ai = no
	}
	option = {
		name = hfe.5081.0
	}
}

# event for remnants
country_event = {
	id = hfe.5082
	title = hfe.5082.name
	desc = {
		trigger = {
			# normal
			success_text = {
				text = hfe.5082.desc.0
				is_machine_empire = no
			}
			# robots
			success_text = {
				text = hfe.5082.desc.1
				has_valid_civic = civic_machine_servitor
			}
			success_text = {
				text = hfe.5082.desc.2
				has_valid_civic = civic_machine_assimilator
			}
			success_text = {
				text = hfe.5082.desc.3
				has_valid_civic = civic_machine_terminator
			}
			success_text = {
				text = hfe.5082.desc.4
				is_machine_empire = yes
				nor = {
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_terminator
				}
			}
		}
	}
	picture = GFX_evt_organic_oppression
	show_sound = event_red_alert
	location = root
	is_triggered_only = yes
	trigger = {
		is_ai = no
	}
	option = {
		name = hfe.5082.0
	}
	option = {
		name = hfe.5082.1
		exclusive_trigger = {
			has_valid_civic = civic_machine_servitor
		}
	}
	option = {
		name = hfe.5082.2
		exclusive_trigger = {
			has_valid_civic = civic_machine_assimilator
		}
	}
	option = {
		name = hfe.5082.3
		exclusive_trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
	option = {
		name = hfe.5082.4
		exclusive_trigger = {
			is_machine_empire = yes
			nor = {
				has_valid_civic = civic_machine_servitor
				has_valid_civic = civic_machine_assimilator
				has_valid_civic = civic_machine_terminator
			}
		}
	}
}

# country_event = {
# 	id = hfe.5083
# 	title = hfe_5083_jimmy_the_ender
# 	desc = hfe_5083_jimmy_the_ender_desc
# 	picture = GFX_evt_civil_action
# 	show_sound = event_celebration
# 	is_triggered_only = yes
# 	option = {
# 		name = hfe_5083_jimmy_the_ender_option_a
# 		hidden_effect = {
# 			kill_leader = {
# 				ruler = yes
# 			}
# 		}
# 		create_leader = {
# 			class = random_ruler
# 			name = "[prev.GetSpeciesNameCompliment] the Ender"
# 			gender = male
# 			skill = 10
# 			event_leader = yes
# 			species = event_target:hfe_blight_remnants
# 			set_age = 21
# 			immortal = yes
# 			traits = {
# 				trait = leader_trait_cyborg				# He survives the Blight
# 				trait = leader_trait_maimed
# 				trait = hfe_leader_trait_nightmare
# 				trait = trait_ruler_champion_of_the_people
# 				trait = hfe_leader_trait_army_lover
# 			}
# 			effect = {
# 				set_leader_flag = hfe_tsp_jimmy_the_ender
# 				save_global_event_target_as = jimmy_the_ender
# 			}
# 		}
# 		assign_leader = last_created_leader
# 	}
# }
# instant assimilation event planet on_planet_transfer
planet_event = {
	id = hfe.5084
	hide_window = yes
	is_triggered_only = yes
	show_sound = event_screams
	trigger = {
		exists = owner
		owner = {
			has_valid_civic = civic_machine_assimilator
			has_origin = hfe_origin_blight
		}
	}
	immediate = {
		every_owned_pop = {
			pop_event = {
				id = hfe.5085
			}
		}
	}
}

# instant assimilation event pop
# folowwing action.64
pop_event = {
	id = hfe.5085
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = {
			has_valid_civic = civic_machine_assimilator
			has_origin = hfe_origin_blight
		}
		hfe_trigger_is_robot = no
		not = {
			has_trait = trait_cybernetic
		}
	}
	immediate = {
		modify_species = {
			add_trait = trait_cybernetic
			add_trait = trait_hive_mind
			add_traits_at_start_of_list = yes
			remove_trait = trait_self_modified
			remove_trait = trait_latent_psionic
			remove_trait = trait_psionic
		}
		remove_modifier = pop_recently_conquered
		# TODO better integration with vanilla scripted effects
		# from apply_post_assimilation_effects
		root.owner = {
			generate_cyborg_treats = yes
		}
	}
}

# count targets event chain
country_event = {
	id = hfe.5086
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = civic_machine_assimilator
		has_origin = hfe_origin_blight
	}
	immediate = {
		# need to set event chain in coutry event to show variables
		if = {
			limit = {
				not = {
					has_event_chain = hfe_chain_blight_targets
				}
			}
			begin_event_chain = {
				event_chain = hfe_chain_blight_targets
			}
		}
		set_variable = {
			which = hfe_chain_blight_targets_0
			value = 0
		}
		set_variable = {
			which = hfe_chain_blight_targets_1
			value = 0
		}
		set_variable = {
			which = hfe_chain_blight_targets_2
			value = 0
		}
		set_variable = {
			which = hfe_chain_blight_targets_3
			value = 0
		}
		every_relation = {
			limit = {
				num_pops > 0
			}
			root = {
				change_variable = {
					which = hfe_chain_blight_targets_3
					value = 1
				}
			}
			if = {
				limit = {
					relative_power = {
						who = from
						category = fleet
						value > equivalent
					}
				}
				root = {
					change_variable = {
						which = hfe_chain_blight_targets_0
						value = 1
					}
				}
			}
			else_if = {
				limit = {
					relative_power = {
						who = from
						category = fleet
						value = equivalent
					}
				}
				root = {
					change_variable = {
						which = hfe_chain_blight_targets_1
						value = 1
					}
				}
			}
			else_if = {
				limit = {
					relative_power = {
						who = from
						category = fleet
						value < equivalent
					}
				}
				root = {
					change_variable = {
						which = hfe_chain_blight_targets_2
						value = 1
					}
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = hfe_chain_blight_targets_0
					value = 0
				}
			}
			set_variable = {
				which = hfe_chain_blight_targets_0
				value = -1
			}
		}
		if = {
			limit = {
				check_variable = {
					which = hfe_chain_blight_targets_1
					value = 0
				}
			}
			set_variable = {
				which = hfe_chain_blight_targets_1
				value = -1
			}
		}
		if = {
			limit = {
				check_variable = {
					which = hfe_chain_blight_targets_2
					value = 0
				}
			}
			set_variable = {
				which = hfe_chain_blight_targets_2
				value = -1
			}
		}
		if = {
			limit = {
				check_variable = {
					which = hfe_chain_blight_targets_3
					value = 0
				}
			}
			set_variable = {
				which = hfe_chain_blight_targets_3
				value = -1
			}
			# blight end
			country_event = {
				id = hfe.5087
			}
		}
	}
}

# event for blight then no other empires for assimilation 5087
country_event = {
	id = hfe.5087
	title = hfe.5087.name
	desc = hfe.5087.desc
	picture = GFX_evt_hfe_robot_city
	show_sound = event_structural_collapse
	is_triggered_only = yes
	option = {
		name = hfe.5087.0
		custom_tooltip = hfe.5087.0.tooltip
		hidden_effect = {
			country_event = {
				id = hfe.5088
			}
		}
	}
}

# main effect 5088
country_event = {
	id = hfe.5088
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_variable = {
			which = hfe_blight_counter_0
			value = 1
		}
		set_variable = {
			which = hfe_blight_counter_1
			value = 1
		}
		set_variable = {
			which = hfe_blight_counter_2
			value = 1
		}
		set_variable = {
			which = hfe_blight_counter_3
			value = 1
		}
		capital_scope = {
			save_event_target_as = hfe_capital_scope
			set_timed_planet_flag = {
				flag = hfe_blight_destroy_colony_exception
				days = 10
			}
		}
		every_owned_megastructure = {
			random = {
				chance = 80
				hfe_effect_ruin_megastructure = yes
			}
		}
		# kill pop
		every_owned_pop = {
			random_list = {
				1 = {
					modifier = {
						factor = 2
						or = {
							has_trait = trait_cybernetic
							hfe_trigger_is_robot_or_hive = yes
						}
					}
					kill_pop = yes
				}
				1 = {
					modifier = {
						factor = 0
						not = {
							has_trait = trait_cybernetic
						}
					}
					modify_species = {
						remove_trait = trait_cybernetic
					}
				}
				1 = {
				}
			}
		}
		# kill colony
		every_owned_planet = {
			if = {
				limit = {
					is_planet_class = pc_hive
				}
				every_owned_pop = {
					limit = {
						hfe_trigger_is_robot = no
					}
					modify_species = {
						remove_trait = trait_cybernetic
						add_trait = trait_hive_mind
					}
				}
			}
			random_list = {
				# kill colony
				2 = {
					modifier = {
						factor = 10
						num_pops < 20
					}
					modifier = {
						factor = 0
						has_planet_flag = hfe_blight_destroy_colony_exception
					}
					destroy_colony = yes
				}
				# make primitive
				1 = {
					modifier = {
						factor = 0
						is_planet_class = pc_habitat
					}
					modifier = {
						factor = 0
						has_planet_flag = hfe_blight_destroy_colony_exception
					}
					hfe_effect_primitive_make_planet_primitive = yes
				}
				# kill habitat
				3 = {
					modifier = {
						factor = 0
						not = {
							is_planet_class = pc_habitat
						}
					}
					modifier = {
						factor = 0
						has_planet_flag = hfe_blight_destroy_colony_exception
					}
					remove_planet = yes
				}
				# TODO kill ringworld
				# 1 = {
				# 	modifier = {
				# 		factor = 0
				# 		nor = {
				# 			is_planet_class = pc_ringworld_habitable
				# 			is_planet_class = pc_ringworld_tech
				# 			is_planet_class = pc_ringworld_seam
				# 		}
				# 	}
				# 	modifier = {
				# 		factor = 0
				# 		has_planet_flag = hfe_blight_destroy_colony_exception
				# 	}
				# 	if = {
				# 		limit = {
				# 			is_planet_class = pc_ringworld_habitable
				# 		}
				# 		change_pc = pc_ringworld_habitable_damaged
				# 	}
				# 	else_if = {
				# 		limit = {
				# 			is_planet_class = pc_ringworld_tech
				# 		}
				# 		change_pc = pc_ringworld_tech_damaged
				# 	}
				# 	else_if = {
				# 		limit = {
				# 			is_planet_class = pc_ringworld_seam
				# 		}
				# 		change_pc = pc_ringworld_seam_damaged
				# 	}
				# }
				7 = {
				}
			}
		}
		# make countries
		every_system_within_border = {
			limit = {
				any_system_planet = {
					is_owned_by = root
				}
			}
			if = {
				limit = {
					any_system_planet = {
						is_owned_by = root
						not = {
							is_planet_class = pc_habitat
						}
					}
				}
				random_system_planet = {
					limit = {
						is_owned_by = root
					}
					weights = {
						base = 1
						mult = trigger:num_pops
					}
					random_owned_pop = {
						limit = {
							is_sapient = yes
						}
						weights = {
							base = 1
							modifier = {
								factor = 10
								hfe_trigger_is_robot_or_hive = no
							}
							modifier = {
								factor = 1000
								hfe_trigger_is_robot = yes
								planet = {
									is_planet_class = pc_machine
								}
							}
						}
						species = {
							save_event_target_as = hfe_new_country_species
						}
					}
				}
				create_country = {
					type = default
					species = event_target:hfe_new_country_species
					ignore_initial_colony_error = yes
					effect = {
						add_modifier = {
							modifier = hfe_reunification_age
							years = 50
						}
						if = {
							limit = {
								has_civic = civic_machine_servitor
							}
							set_name = {
								key = "Blight Diplomatic Protocol [root.hfe_blight_counter_0]"
								variable_string = "[root.hfe_blight_counter_0]"
							}
							root = {
								change_variable = {
									which = hfe_blight_counter_0
									value = 1
								}
							}
							change_country_flag = {
								icon = {
									category = hfe_emblem
									file = hfe_emblem_blight.dds
								}
								background = {
									category = backgrounds
									file = v.dds
								}
								colors = {
									"pink"
									"light_blue"
									"blue"
									"beige"
								}
							}
						}
						else_if = {
							limit = {
								has_civic = civic_machine_assimilator
							}
							set_name = {
								key = "Blight Economic Protocol [root.hfe_blight_counter_1]"
								variable_string = "[root.hfe_blight_counter_1]"
							}
							root = {
								change_variable = {
									which = hfe_blight_counter_1
									value = 1
								}
							}
							change_country_flag = {
								icon = {
									category = hfe_emblem
									file = hfe_emblem_blight.dds
								}
								background = {
									category = backgrounds
									file = horizontal_stripe.dds
								}
								colors = {
									"dark_green"
									"black"
									"null"
									"null"
								}
							}
						}
						else_if = {
							limit = {
								has_civic = civic_machine_terminator
							}
							set_name = {
								key = "Blight Defense Protocol [root.hfe_blight_counter_2]"
								variable_string = "[root.hfe_blight_counter_2]"
							}
							root = {
								change_variable = {
									which = hfe_blight_counter_2
									value = 1
								}
							}
							change_country_flag = {
								icon = {
									category = hfe_emblem
									file = hfe_emblem_blight.dds
								}
								background = {
									category = backgrounds
									file = pattern_01.dds
								}
								colors = {
									"red"
									"black"
									"black"
									"black"
								}
							}
						}
						else_if = {
							limit = {
								is_hive_empire = yes
							}
							set_name = {
								key = "Blighted Abomination [root.hfe_blight_counter_3]"
								variable_string = "[root.hfe_blight_counter_3]"
							}
							root = {
								change_variable = {
									which = hfe_blight_counter_3
									value = 1
								}
							}
							change_country_flag = {
								icon = {
									category = hfe_emblem
									file = hfe_emblem_blight.dds
								}
								background = {
									category = backgrounds
									file = horizontal_stripe.dds
								}
								colors = {
									"dark_purple"
									"light_green"
									"black"
									"black"
								}
							}
						}
						prev = {
							if = {
								limit = {
									or = {
										has_megastructure = gateway_final
										has_megastructure = gateway_restored
									}
								}
								prev = {
									# give_technology = {
									# 	tech = tech_gateway_activation
									# }
									set_country_flag = encountered_first_gateway
								}
							}
							every_system_planet = {
								if = {
									limit = {
										is_owned_by = root
									}
									set_owner = prevprev
								}
								else_if = {
									limit = {
										exists = owner
										owner = {
											is_country_type = primitive
										}
									}
									owner = {
										establish_communications = prevprevprev
									}
								}
							}
							starbase = {
								set_owner = prevprev
								if = {
									limit = {
										count_starbase_modules = {
											type = shipyard
											count < 1
										}
									}
									set_starbase_module = {
										slot = 1
										module = shipyard
									}
								}
							}
						}
						if = {
							limit = {
								any_owned_planet = {
									is_planet = event_target:hfe_capital_scope
								}
							}
							set_name = "Prime Cluster Successors"
							change_dominant_species = {
								species = root.species
								change_all = yes
							}
							if = {
								limit = {
									hfe_trigger_is_robot = yes
									exists = ruler
								}
								ruler = {
									set_name = "AIM 3029bac System Image"
								}
							}
							set_player = root
						}
						else = {
							set_name = random
						}
						# place some origins
						# only necrophage really important, doorstep unlocks chain to open gates, rest all for fun and immersion
						if = {
							limit = {
								has_trait = trait_necrophage
							}
							set_origin = origin_necrophage
						}
						else_if = {
							limit = {
								prev = {
									or = {
										has_megastructure = gateway_final
										has_megastructure = gateway_restored
										has_megastructure = gateway_ruined
									}
								}
							}
							prev = {
								random_system_megastructure = {
									limit = {
										or = {
											is_megastructure_type = gateway_final
											is_megastructure_type = gateway_restored
											is_megastructure_type = gateway_ruined
										}
									}
									set_megastructure_flag = doorstep_gateway@prev
									save_event_target_as = doorstep_gateway
								}
							}
							set_origin = origin_galactic_doorstep
							country_event = {
								id = origin.1000
								days = 300
								random = 30
							}
						}
						else_if = {
							limit = {
								host_has_dlc = "Utopia"
								is_materialist = yes
								any_owned_species = {
									hfe_trigger_is_robot = yes
								}
							}
							set_origin = origin_mechanists
						}
						else_if = {
							limit = {
								host_has_dlc = "Utopia"
								is_gestalt = no
								not = {
									has_trait = trait_syncretic_proles
								}
								any_owned_species = {
									has_trait = trait_syncretic_proles
								}
							}
							set_origin = origin_syncretic_evolution
						}
						else_if = {
							limit = {
								host_has_dlc = "Apocalypse"
								ideal_planet_class = pc_gaia
							}
							set_origin = origin_life_seeded
						}
						else_if = {
							limit = {
								host_has_dlc = "Apocalypse"
								has_trait = trait_survivor
							}
							set_origin = origin_post_apocalyptic
						}
						else_if = {
							limit = {
								OR = {
									has_ancrel = yes
									host_has_dlc = Federations
								}
								any_owned_planet = {
									is_planet_class = pc_relic
								}
							}
							set_origin = origin_remnants
						}
						else_if = {
							limit = {
								host_has_dlc = Federations
								any_owned_planet = {
									is_planet_class = pc_ringworld_habitable
								}
							}
							set_origin = origin_shattered_ring
						}
						else_if = {
							limit = {
								is_machine_empire = yes
								any_owned_planet = {
									is_planet_class = pc_machine
								}
							}
							set_origin = origin_machine
						}
					}
				}
			}
			else = {
				every_system_planet = {
					limit = {
						is_owned_by = root
					}
					destroy_colony = yes
				}
			}
		}
		# TODO galactic community
		remove_global_flag = galactic_community_founded
		remove_global_flag = galcom_founding_begun
		remove_global_flag = galactic_council_formed
	}
}

# blight assimilate fleet 5089
# on_space_battle_won
# This = owner of fleet 1 (winner)
# From = owner of fleet 2 (loser)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
country_event = {
	id = hfe.5089
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = civic_machine_assimilator
		has_origin = hfe_origin_blight
		exists = from
		from = {
			or = {
				is_country_type = default
				hfe_trigger_is_fallen = yes
			}
		}
		exists = fromfromfrom
		fromfromfrom = {
			is_ship_class = shipclass_military
			num_ships > 1
		}
	}
	immediate = {
		random_list = {
			1 = {
				fromfromfrom = {
					set_owner = root
					if = {
						limit = {
							exists = leader
						}
						leader = {
							# TODO test set owner on fleet should cover it?
							# set_owner = prev.owner
							add_trait_no_notify = leader_trait_cyborg
						}
					}
				}
				create_message = {
					type = hfe_message_type_blight_assimilation
					localization = hfe_message_type_blight_assimilation_desc
					days = 30
					target = fromfrom
					variable = {
						type = name
						localization = hfe_fleet
						scope = fromfromfrom
					}
				}
				from = {
					create_message = {
						type = hfe_message_type_blight_assimilation
						localization = hfe_message_type_blight_assimilation_from_us_desc
						days = 30
						# TODO should it be from?
						target = fromfrom
						variable = {
							type = name
							localization = hfe_fleet
							scope = fromfromfrom
						}
					}
				}
			}
			2 = {
			}
		}
	}
}

# future advisor anomaly 5090-5100
# event after anomaly
ship_event = {
	id = hfe.5090
	title = hfe.5090.name
	desc = {
		trigger = {
			hidden:owner = {
				text = hfe.5090.desc.0
				success_text = {
					text = hfe.5090.desc.1.0
					or = {
						is_homicidal = no
						and = {
							exists = event_target:hfe_future_country
							is_same_species = event_target:hfe_future_country
						}
					}
				}
				fail_text = {
					text = hfe.5090.desc.1.1
					or = {
						is_homicidal = no
						and = {
							exists = event_target:hfe_future_country
							is_same_species = event_target:hfe_future_country
						}
					}
				}
			}
		}
	}
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		exists = from
		exists = owner
	}
	immediate = {
		from = {
			hfe_effect_remove_signal_object_from_this = yes
		}
	}
	option = {
		name = hfe_next
		exclusive_trigger = {
			owner = {
				or = {
					is_homicidal = no
					and = {
						exists = event_target:hfe_future_species
						is_same_species = event_target:hfe_future_species
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				create_saved_leader = {
					key = hfe_5090_leader
					class = commander
					species = event_target:hfe_future_species
					gender = female
					skill = 2
					traits = {
						trait = leader_trait_trickster
						trait = hfe_leader_trait_future_train
					}
					effect = {
						save_event_target_as = hfe_5090_leader
					}
				}
				set_country_flag = hfe.5091.step0
				country_event = {
					id = hfe.5091
				}
			}
		}
	}
	option = {
		name = hfe.5080.1
		owner = {
			hfe_effect_give_random_tech = yes
		}
	}
}

country_event = {
	id = hfe.5091
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = hfe.5091.desc.0
				has_country_flag = hfe.5091.step0
			}
			success_text = {
				text = hfe.5091.desc.0.0
				has_valid_civic = civic_machine_servitor
				has_country_flag = hfe.5091.step0
			}
			success_text = {
				text = hfe.5091.desc.0.1
				has_valid_civic = civic_machine_assimilator
				has_country_flag = hfe.5091.step0
			}
			success_text = {
				text = hfe.5091.desc.1
				has_country_flag = hfe.5091.step1
			}
			success_text = {
				text = hfe.5091.desc.1.0
				has_valid_civic = civic_machine_servitor
				has_country_flag = hfe.5091.step1
			}
			success_text = {
				text = hfe.5091.desc.1.1
				has_valid_civic = civic_machine_assimilator
				has_country_flag = hfe.5091.step1
			}
			success_text = {
				text = hfe.5091.desc.2
				has_country_flag = hfe.5091.step2
			}
			success_text = {
				text = hfe.5091.desc.2.0
				has_valid_civic = civic_machine_servitor
				has_country_flag = hfe.5091.step2
			}
			success_text = {
				text = hfe.5091.desc.2.1
				has_valid_civic = civic_machine_assimilator
				has_country_flag = hfe.5091.step2
			}
			success_text = {
				text = hfe.5091.desc.3
				has_country_flag = hfe.5091.step3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:hfe_5090_leader
		room = ship_room
	}
	immediate = {
		if = {
			limit = {
				has_country_flag = hfe.5091.step0
			}
			play_sound = event_alien_signal
		}
	}
	option = {
		name = hfe.5091.0
		trigger = {
			has_country_flag = hfe.5091.step0
		}
		custom_tooltip = hfe.5091.0.tooltip
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.1
		trigger = {
			has_country_flag = hfe.5091.step1
		}
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.2
		trigger = {
			has_country_flag = hfe.5091.step2
		}
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.3.0
		exclusive_trigger = {
			has_country_flag = hfe.5091.step3
			exists = federation
			federation = {
				has_federation_flag = hfe_future_federation
			}
		}
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.3.1
		exclusive_trigger = {
			has_country_flag = hfe.5091.step3
			has_valid_civic = civic_machine_servitor
		}
		hfe_effect_advisor_future_on = yes
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.3.2
		exclusive_trigger = {
			has_country_flag = hfe.5091.step3
			has_valid_civic = civic_machine_assimilator
		}
		hfe_effect_advisor_future_on = yes
		activate_saved_leader = {
			add_to_owned = yes
			key = hfe_5090_leader
		}
		hidden_effect = {
			event_target:hfe_5090_leader = {
				add_trait_no_notify = leader_trait_cyborg
			}
		}
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.3.3
		trigger = {
			has_country_flag = hfe.5091.step3
		}
		hfe_effect_advisor_future_on = yes
		default_hide_option = yes
	}
	option = {
		name = hfe.5091.3.4
		trigger = {
			has_country_flag = hfe.5091.step3
		}
		activate_saved_leader = {
			add_to_owned = yes
			key = hfe_5090_leader
		}
	}
	after = {
		hfe_effect_event_5091_next = yes
	}
}

# other dialogs 5100 - 5200
# buy robots 5100
country_event = {
	id = hfe.5100
	title = TRANSMISSION
	desc = {
		trigger = {
			fail_text = {
				text = hfe.5100.desc.0
				has_country_flag = hfe.5100.step1
			}
			success_text = {
				text = hfe.5100.desc.1
				has_country_flag = hfe.5100.step1
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:hfe_future_country
		room = hfe_future_room
	}
	trigger = {
		any_owned_species = {
			has_trait = trait_mechanical
		}
		exists = event_target:hfe_future_country
	}
	immediate = {
		if = {
			limit = {
				not = {
					has_country_flag = hfe_future_try_take_robot
				}
			}
			play_sound = event_alien_signal
			set_country_flag = hfe_future_try_take_robot
		}
	}
	option = {
		name = hfe.5100.0
		trigger = {
			not = {
				has_policy_flag = ai_full_rights
			}
		}
		add_modifier = {
			modifier = hfe_army_trained_by_future
		}
		hidden_effect = {
			set_global_flag = hfe_future_take_robot
			random_owned_pop = {
				limit = {
					has_trait = trait_mechanical
				}
				save_event_target_as = hfe_settle_pop_target
			}
			event_target:hfe_future_country = {
				hfe_effect_settle_pop = yes
			}
		}
		custom_tooltip = hfe.5100.yes.tooltip
	}
	option = {
		name = hfe.5100.1
		trigger = {
			or = {
				is_xenophobe = yes
				is_authoritarian = yes
			}
			has_policy_flag = ai_full_rights
		}
		add_modifier = {
			modifier = hfe_army_trained_by_future
		}
		hidden_effect = {
			set_global_flag = hfe_future_take_robot
			random_owned_pop = {
				limit = {
					has_trait = trait_mechanical
				}
				save_event_target_as = hfe_settle_pop_target
			}
			event_target:hfe_future_country = {
				hfe_effect_settle_pop = yes
			}
		}
		custom_tooltip = hfe.5100.yes.tooltip
	}
	option = {
		name = hfe.5100.2
		trigger = {
			is_xenophobe = no
			is_authoritarian = no
			has_policy_flag = ai_full_rights
		}
		response_text = hfe.5100.no.response
	}
	option = {
		name = hfe.5100.3
		response_text = hfe.5100.no.response
	}
	option = {
		name = hfe.5100.4
		trigger = {
			not = {
				has_country_flag = hfe.5100.step1
			}
		}
		hidden_effect = {
			set_country_flag = hfe.5100.step1
			country_event = {
				id = hfe.5100
			}
		}
	}
	option = {
		name = hfe.5100.5
		trigger = {
			has_country_flag = hfe.5100.step1
		}
		response_text = hfe.5100.5.response
		is_dialog_only = yes
	}
}
