#
namespace = human_fallen_empires_pirate

# spawn pirate birth of piracy
country_event = {
	id = human_fallen_empires_pirate.1
	title = pirate.1.name
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_0
		}
		picture = GFX_evt_human_fallen_empires_pirate
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_1
		}
		picture = GFX_evt_pirate_armada
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_2
		}
		picture = GFX_evt_smugglers_in_bar
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_3
		}
		picture = GFX_evt_unknown_ships
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_4
		}
		picture = GFX_evt_machine_space_battle
	}
	show_sound = event_space_battle
	location = event_target:pirate_system

	desc = {
		# Spiritual
		text = pirate.1.desc_01
		trigger = {
			has_spiritualist_government = yes
		}
	}

	desc = {
		# Militarist
		text = pirate.1.desc_02
		trigger = {
			has_militarist_government = yes
		}
	}

	desc = {
		# Materialist
		text = pirate.1.desc_03
		trigger = {
			has_materialist_government = yes
		}
	}

	desc = {
		# Pacifist
		text = pirate.1.desc_04
		trigger = {
			has_pacifist_government = yes
		}
	}

	desc = {
		# Generic Autocracy
		text = pirate.1.desc_05
		trigger = {
			OR = {
				has_government = gov_despotic_empire
				has_government = gov_feudal_empire
				has_government = gov_constitutional_dictatorship
				has_government = gov_enlightened_monarchy
				has_government = gov_elective_monarchy
			}
		}
	}

	desc = {
		# Generic Oligarchy
		text = pirate.1.desc_06
		trigger = {
			OR = {
				has_government = gov_megacorporation
				has_government = gov_plutocratic_oligarchy
			}
		}
	}

	desc = {
		# Generic Democracy
		text = pirate.1.desc_07
		trigger = {
			has_government = gov_representative_democracy
		}
	}

	trigger = {
		not = {
			has_country_flag = human_fallen_empires_birth_of_piracy
		}
	}

	is_triggered_only = yes

	immediate = {
		human_fallen_empires_effect_random_roll_flags_5_country = yes
		save_event_target_as = human_fallen_empires_pirate_target
		human_fallen_empires_effect_pirate_init = yes
	}

	option = {
		name = pirate.2.a
		exclusive_trigger = {
			has_spiritualist_government = yes
		}
	}
	option = {
		name = pirate.2.b
		exclusive_trigger = {
			has_militarist_government = yes
		}
	}
	option = {
		name = pirate.2.c
		exclusive_trigger = {
			has_materialist_government = yes
		}
	}
	option = {
		name = pirate.2.d
		exclusive_trigger = {
			has_pacifist_government = yes
		}
	}
	option = {
		name = pirate.2.e
		exclusive_trigger = {
			OR = {
				has_government = gov_despotic_empire
				has_government = gov_feudal_empire
				has_government = gov_constitutional_dictatorship
				has_government = gov_enlightened_monarchy
				has_government = gov_elective_monarchy
			}
		}
	}
	option = {
		name = pirate.2.f
		exclusive_trigger = {
			OR = {
				has_government = gov_megacorporation
				has_government = gov_plutocratic_oligarchy
			}
		}
	}
	option = {
		name = pirate.2.g
		exclusive_trigger = {
			has_government = gov_representative_democracy
		}
	}
	option = {
		name = INTERESTING
	}
}

# pirate life simulation
country_event = {
	id = human_fallen_empires_pirate.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = human_fallen_empires_pirate
	}

	immediate = {
		# build new bases
		country_event = {
			id = human_fallen_empires_pirate.3
		}
		# send fleet logic for unstuck fleets
		every_owned_fleet = {
			limit = {
				num_ships > 4
			}
			fleet_event = {
				id = human_fallen_empires_pirate.50
			}
		}
		# try to hunt weaker near pirate
		random_relation = {
			limit = {
				is_country_type = human_fallen_empires_pirate
				relative_power = {
					who = root
					category = fleet
					value < equivalent
				}
				or = {
					is_neighbor_of = root
					any_system_within_border = {
						distance_to_empire = {
							who = root
							distance <= 20
						}
					}
				}
				not = {
					has_opinion_modifier = {
						who = root
						modifier = human_fallen_empires_opinion_pirate_prior_target
					}
				}
			}
			add_opinion_modifier = {
				who = root
				modifier = human_fallen_empires_opinion_pirate_prior_target
			}
			log = "pirate try to hunt pirate hunter: [prev.GetName] target: [this.GetName]"
		}
		country_event = {
			id = human_fallen_empires_pirate.10
			days = 1
			random = 360
		}
		country_event = {
			id = human_fallen_empires_pirate.11
			days = 1
			random = 360
		}
	}
}

# pirate build base
country_event = {
	id = human_fallen_empires_pirate.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		energy >= @human_fallen_empires_pirate_base_cost
	}

	immediate = {
		save_event_target_as = human_fallen_empires_pirate_clan
		capital_scope = {
			closest_system = {
				max_steps = 20
				limit = {
					human_fallen_empires_pirate_valid_base_system = yes
				}
				human_fallen_empires_effect_pirate_init_base = yes
				root = {
					add_energy = @human_fallen_empires_pirate_base_cost_minus
				}
			}
		}
	}
}

# pirate fleet logic set by ship build on action
ship_event = {
	id = human_fallen_empires_pirate.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_military
	}

	immediate = {
		fleet = {
			fleet_event = {
				id = human_fallen_empires_pirate.50
			}
		}
	}
}

# spawn pirate again
country_event = {
	id = human_fallen_empires_pirate.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = human_fallen_empires_birth_of_piracy
		count_country = {
			count < 31
			limit = {
				is_country_type = human_fallen_empires_pirate
			}
		}
	}

	immediate = {
		save_event_target_as = human_fallen_empires_pirate_target
		human_fallen_empires_effect_pirate_init = yes
	}
}

# inform event
country_event = {
	id = human_fallen_empires_pirate.7
	title = pirate.50.name
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_0
		}
		picture = GFX_evt_human_fallen_empires_pirate
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_1
		}
		picture = GFX_evt_pirate_armada
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_2
		}
		picture = GFX_evt_smugglers_in_bar
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_3
		}
		picture = GFX_evt_unknown_ships
	}
	picture = {
		trigger = {
			has_country_flag = human_fallen_empires_random_4
		}
		picture = GFX_evt_machine_space_battle
	}
	desc = pirate.50.a.desc
	desc = pirate.50.b.desc
	desc = pirate.50.c.desc
	show_sound = event_ship_bridge
	location = event_target:human_fallen_empires_pirate_clan
	is_triggered_only = yes

	immediate = {
		human_fallen_empires_effect_random_roll_flags_5_country = yes
	}

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_pirate.7_block
		}
	}

	option = {
		name = pirate.50.a
	}

	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_pirate.7_block
		}
	}
}

# pirate diplo simulation
# sell slaves
country_event = {
	id = human_fallen_empires_pirate.10
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		num_pops > 0
		any_owned_planet = {
			free_pop_tiles < 3
		}
	}

	immediate = {
		random_country = {
			limit = {
				not = {
					is_hostile = root
					has_country_flag = human_fallen_empires_pirate_offer_deal@root
				}
				energy >= 500
				minerals >= 500
				is_country_type = default
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			save_event_target_as = human_fallen_empires_pirate_diplo_target
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_pirate_diplo_target
				}
			}
			random_country = {
				limit = {
					not = {
						has_country_flag = human_fallen_empires_pirate_offer_deal@root
					}
					energy >= 500
					minerals >= 500
					is_country_type = default
					any_owned_planet = {
						free_pop_tiles > 0
					}
				}
				save_event_target_as = human_fallen_empires_pirate_diplo_target
			}
		}
		if = {
			limit = {
				exists = event_target:human_fallen_empires_pirate_diplo_target
			}
			event_target:human_fallen_empires_pirate_diplo_target = {
				root = {
					save_event_target_as = human_fallen_empires_pirate_country
					human_fallen_empires_effect_save_slave_target = yes
				}
				set_country_flag = human_fallen_empires_pirate.101.deal_offer
				set_country_flag = human_fallen_empires_pirate.101.slave_menu
				log = "try to sell slaves to [this.GetName]"
				set_timed_country_flag = {
					flag = human_fallen_empires_pirate_offer_deal@root
					days = 1825
				}
				country_event = {
					id = human_fallen_empires_pirate.101
				}
			}
		}
	}
}

# sell energy
country_event = {
	id = human_fallen_empires_pirate.11
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		energy >= 1000
	}

	immediate = {
		random_country = {
			limit = {
				nor = {
					is_hostile = root
					has_country_flag = human_fallen_empires_pirate_offer_deal@root
				}
				minerals >= 1000
				energy < 10000
				is_country_type = default
			}
			root = {
				save_event_target_as = human_fallen_empires_pirate_country
			}
			set_country_flag = human_fallen_empires_pirate.101.deal_offer
			set_country_flag = human_fallen_empires_pirate.101.traid_menu
			log = "try to sell energy to [this.GetName]"
			set_timed_country_flag = {
				flag = human_fallen_empires_pirate_offer_deal@root
				days = 1825
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
}

# functional stuff 50 - 100
# pirate fleet logic
fleet_event = {
	id = human_fallen_empires_pirate.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
			is_ai = yes
		}
		is_ship_class = shipclass_military
		fleet_power > 500
		num_ships > 4
		has_hp_percentage > 0.99
		is_fleet_idle = yes
		any_system = {
			human_fallen_empires_pirate_valid_target_system = yes
			any_planet = {
				human_fallen_empires_pirate_valid_target_planet = yes
			}
		}
	}

	immediate = {
		#log = "pirate fleet logic"
		clear_fleet_actions = this
		queue_actions = {
			repeat = {
				# try found prior target
				find_closest_system = {
					trigger = {
						id = human_fallen_empires_pirate.50.trigger.0.0
						any_country = {
							has_opinion_modifier = {
								who = root.owner
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
						human_fallen_empires_pirate_valid_target_system = yes
						human_fallen_empires_pirate_valid_target_system_prior = yes
						any_planet = {
							human_fallen_empires_pirate_valid_target_planet = yes
						}
					}
					found_system = {
						effect = {
							id = human_fallen_empires_pirate.50.effect.0.0
							root = {
								if = {
									limit = {
										or = {
											num_ships < 5
											has_hp_percentage < 0.9
										}
									}
									clear_fleet_actions = this
								}
							}
						}
						move_to = this
					}
					failed = {
						# then try found other target
						find_closest_system = {
							trigger = {
								id = human_fallen_empires_pirate.50.trigger.0.1
								human_fallen_empires_pirate_valid_target_system = yes
								any_planet = {
									human_fallen_empires_pirate_valid_target_planet = yes
								}
							}
							found_system = {
								effect = {
									id = human_fallen_empires_pirate.50.effect.0.1
									root = {
										if = {
											limit = {
												or = {
													num_ships < 5
													has_hp_percentage < 0.9
												}
											}
											clear_fleet_actions = this
											#log = "pirate fleet stop operation due low hp"
										}
									}
								}
								move_to = this
							}
							# then wait
							failed = {
								wait = 200
								effect = {
									id = human_fallen_empires_pirate.50.effect.0.3
									root = {
										clear_fleet_actions = this
										fleet_event = {
											id = human_fallen_empires_pirate.50
										}
										log = "pirate fleet stop operation due no targets"
									}
								}
							}
						}
					}
				}
				repeat = {
					max_iterations = 5
					find_closest_planet = {
						trigger = {
							id = human_fallen_empires_pirate.50.trigger.1.0
							root = {
								has_hp_percentage > 0.9
							}
							not = { exists = owner }
							human_fallen_empires_pirate_valid_target_planet = yes
						}
						found_planet = {
							orbit_planet = this
						}
					}
				}
				find_closest_planet = {
					trigger = {
						id = human_fallen_empires_pirate.50.trigger.1.1
						root = {
							has_hp_percentage > 0.9
						}
						exists = owner
						human_fallen_empires_pirate_valid_target_planet = yes
					}
					found_planet = {
						orbit_planet = this
						wait = 180
					}
				}
				effect = {
					id = human_fallen_empires_pirate.50.effect.2.0
					root = {
						order_forced_return = yes
					}
				}
				wait = {
					duration = 200
					random = 150
				}
				effect = {
					id = human_fallen_empires_pirate.50.effect.2.1
					root = {
						fleet_event = {
							id = human_fallen_empires_pirate.50
						}
					}
				}
			}
		}
	}
}

# clean fleet actions after emercy ftl
fleet_event = {
	id = human_fallen_empires_pirate.51
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		exists = solar_system
	}

	immediate = {
		solar_system = {
			set_timed_star_flag = {
				flag = human_fallen_empires_pirate_block
				days = 180
			}
		}
		#log = "pirate fleet emercy ftl at [solar_system.GetName]"
		clear_fleet_actions = this
	}
}

# pirate gain resources after kill station
country_event = {
	id = human_fallen_empires_pirate.52
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = human_fallen_empires_pirate
		exists = fromfromfrom
		fromfromfrom = {
			or = {
				is_ship_size = research_station
				is_ship_size = mining_station
				is_ship_size = observation_station
				#is_ship_class = shipclass_starbase
			}
		}
	}

	immediate = {
		#log = "pirate kill station"
		set_timed_country_flag = {
			flag = human_fallen_empires_pirate_attack@from
			days = 365
		}
		from = {
			change_variable = {
				which = human_fallen_empires_pirate_attack_count
				value = 1
			}
			human_fallen_empires_effect_pirate_attack_count_check = yes
			if = {
				limit = {
					has_event_chain = human_fallen_empires_chain_pirate_count
				}
				add_event_chain_counter = {
					event_chain = human_fallen_empires_chain_pirate_count
					counter = human_fallen_empires_chain_pirate_count_lost_station
					amount = 1
				}
			}
		}
		human_fallen_empires_effect_pirate_resource_reward = yes
	}
}

# pirate bombard colony by on_planet_zero_health
# Planet has reached 0 health from orbital bombardment
# This = Planet
# From = Bombarder
planet_event = {
	id = human_fallen_empires_pirate.53
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		num_pops > 0
		exists = owner
		exists = from
		has_orbital_bombardment_stance = human_fallen_empires_stance_pirate_raid
	}

	immediate = {
		# log = "pirate bombarding on [Root.GetStarName]"
		if = {
			limit = {
				from = {
					is_country_type = human_fallen_empires_pirate
				}
			}
			owner = {
				set_timed_country_flag = {
					flag = human_fallen_empires_pirate_attacked
					days = 365
				}
			}
			human_fallen_empires_effect_pirate_ravage_planet = yes
		}
		else = {
			random_list = {
				8 = {
				}
				2 = {
					human_fallen_empires_effect_pirate_ravage_planet = yes
				}
			}
		}
	}
}

# clear action on command for ai on_ship_ordered
ship_event = {
	id = human_fallen_empires_pirate.54
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		always = no
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_military
		# fleet = {
		# 	not = {
		# 		has_fleet_flag = human_fallen_empires_clear_action_on_order
		# 	}
		# }
	}

	immediate = {
		log = "clear ship order by ai command owner [Owner.GetName] location [This.GetStarName]"
		fleet = {
			#set_timed_fleet_flag = { flag = human_fallen_empires_clear_action_on_order days = 365 }
			clear_fleet_actions = this
		}
	}
}

# add pirate trait to admiral 55 on_leader_spawned
country_event = {
	id = human_fallen_empires_pirate.55
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = human_fallen_empires_pirate
		exists = from
		from = {
			leader_class = admiral
		}
	}

	immediate = {
		from = {
			add_trait = human_fallen_empires_admiral_trait_pirate
		}
	}
}

# This = Ship
# From = Disabler Ship
# take starbases of pirate on_ship_disabled
ship_event = {
	id = human_fallen_empires_pirate.56
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = this
		exists = from.owner
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_starbase
		exists = solar_system
	}

	immediate = {
		#log = "get pirate starbase on [root.solar_system.GetName]"
		# flee fleets
		owner = {
			if = {
				limit = {
					num_starbases = 1
				}
				human_fallen_empires_effect_pirate_flee_fleets = yes
			}
		}
		if = {
			limit = {
				from.owner = {
					num_owned_planets > 0
				}
				solar_system = {
					any_neighbor_system = {
						 ignore_hyperlanes = no
						 owner = {
							 is_country = from.owner
						 }
					}

				}
			}
			solar_system = {
				every_system_planet = {
					limit = {
						is_owned_by = root.owner
					}
					if = {
						limit = {
							or = {
								from.owner = {
									is_country_type = human_fallen_empires_pirate
								}
								and = {
									num_pops > 0
									not = {
										is_planet_class = human_fallen_empires_pc_pirate_base
									}
								}

							}
						}
						set_owner = from.owner
					}
					else_if = {
						limit = {
							is_planet_class = human_fallen_empires_pc_pirate_base
						}
						root.owner = {
							set_timed_country_flag = {
								flag = human_fallen_empires_refuge_country_prior@from.owner
								days = 10
							}
						}
						every_owned_pop = {
							human_fallen_empires_effect_refuge_or_die = yes
						}
						human_fallen_empires_effect_convert_to_asteroid = yes
						from = {
							save_event_target_as = pirate_slayers
							owner = {
								random_list = {
									80 = {
										country_event = {
											id = pirate.25
										}
									}
									20 = {
										modifier = {
											factor = 0
											not = {
												has_event_chain = l_cluster_chain
											}
										}
										country_event = {
											id = pirate.26
										}
									}
								}
							}
						}
					}
				}
			}
			from.owner = {
				if = {
					limit = {
						has_event_chain = human_fallen_empires_chain_pirate_count
					}
					add_event_chain_counter = {
						event_chain = human_fallen_empires_chain_pirate_count
						counter = human_fallen_empires_chain_pirate_count_outpost_balance
						amount = 1
					}
				}
			}
			fleet = {
				set_owner = from.owner
			}
			# убрать пиратские здания со старбазы
		}
		else = {
			# протестить потом
			solar_system = {
				every_system_planet = {
					limit = {
						is_owned_by = root.owner
						not = {
							is_planet_class = human_fallen_empires_pc_pirate_base
						}
						num_pops > 0
					}
					random_owned_pop = {
						create_country = {
							type = default
							species = this.species
							effect = {
								human_fallen_empires_effect_gov_fix = yes
							}
						}
					}
					set_owner = last_created_country
				}
			}
			destroy_fleet = fleet
		}
	}
}

# fix pirate planet class ownerless on_planet_ownerless on_planet_transfer
planet_event = {
	id = human_fallen_empires_pirate.57
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_planet_class = human_fallen_empires_pc_pirate_base
	}

	immediate = {
		human_fallen_empires_effect_convert_to_asteroid = yes
	}
}

# send default or pirate country fleets before get destroyed on_country_destroyed
# looks like not worked
country_event = {
	id = human_fallen_empires_pirate.58
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		# or = {
			# is_country_type = human_fallen_empires_pirate
		 	# is_country_type = default
		# }
		any_country = {
			is_country_type = human_fallen_empires_pirate
			not = {
				is_country = root
			}
		}
	}

	immediate = {
		human_fallen_empires_effect_pirate_flee_fleets = yes
	}
}

# pirate gain resources after disabling starbase on_ship_disabled
# This = Ship
# From = Disabler Ship
ship_event = {
	id = human_fallen_empires_pirate.59
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = this
		exists = owner
		exists = from.owner
		exists = fleet
		exists = solar_system
		from.owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_starbase
	}

	immediate = {
		from.owner = {
			set_timed_country_flag = {
				flag = human_fallen_empires_pirate_attack@root.owner
				days = 365
			}
		}
		from.owner = {
			human_fallen_empires_effect_pirate_resource_reward = yes
		}
		fleet = {
			change_variable = {
				which = human_fallen_empires_pirate_outpost_attack_count
				value = 1
			}
			owner = {
				change_variable = {
					which = human_fallen_empires_pirate_attack_count
					value = 1
				}
				human_fallen_empires_effect_pirate_attack_count_check = yes
			}
			if = {
				limit = {
					or = {
						check_variable = {
							which = human_fallen_empires_pirate_outpost_attack_count
							value > 8
						}
						and = {
							is_difficulty > 0
							check_variable = {
								which = human_fallen_empires_pirate_outpost_attack_count
								value > 7
							}
						}
						and = {
							is_difficulty > 1
							check_variable = {
								which = human_fallen_empires_pirate_outpost_attack_count
								value > 6
							}
						}
						and = {
							is_difficulty > 2
							check_variable = {
								which = human_fallen_empires_pirate_outpost_attack_count
								value > 5
							}
						}
						and = {
							is_difficulty > 3
							check_variable = {
								which = human_fallen_empires_pirate_outpost_attack_count
								value > 4
							}
						}
						and = {
							is_difficulty > 4
							check_variable = {
								which = human_fallen_empires_pirate_outpost_attack_count
								value > 3
							}
						}
					}
				}
				set_variable = {
					which = human_fallen_empires_pirate_outpost_attack_count
					value = 0
				}
				log = "pirate get starbase from [owner.GetName] at [solar_system.GetName]"
				owner = {
					change_variable = {
						which = human_fallen_empires_pirate_attack_count
						value = 2
					}
					human_fallen_empires_effect_pirate_attack_count_check = yes
					if = {
						limit = {
							has_event_chain = human_fallen_empires_chain_pirate_count
						}
						add_event_chain_counter = {
							event_chain = human_fallen_empires_chain_pirate_count
							counter = human_fallen_empires_chain_pirate_count_outpost_balance
							amount = -1
						}
					}
				}
				solar_system = {
					every_system_planet = {
						limit = {
							is_owned_by = prevprev.owner
						}
						log = "pirate get planet from [owner.GetName]"
						set_owner = from.owner
					}
				}
				set_owner = from.owner
			}
		}
	}
}

# This = owner of ship 1 (combatant)
# From = owner of ship 2 (destroyed)
# FromFrom = ship 1
# FromFromFrom = ship 2
# for human_fallen_empires_chain_pirate_count counters on_ship_destroyed_perp
country_event = {
	id = human_fallen_empires_pirate.60
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from
		exists = fromfromfrom
		fromfromfrom = {
			is_ship_class = shipclass_military
		}
		or = {
			is_country_type = human_fallen_empires_pirate
			from = {
				is_country_type = human_fallen_empires_pirate
			}
		}
		or = {
			has_event_chain = human_fallen_empires_chain_pirate_count
			from = {
				has_event_chain = human_fallen_empires_chain_pirate_count
			}
		}
	}

	immediate = {
		if = {
			limit = {
				is_country_type = human_fallen_empires_pirate
			}
			from = {
				add_event_chain_counter = {
					event_chain = human_fallen_empires_chain_pirate_count
					counter = human_fallen_empires_chain_pirate_count_lost_ship
					amount = 1
				}
			}
		}
		else = {
			add_event_chain_counter = {
				event_chain = human_fallen_empires_chain_pirate_count
				counter = human_fallen_empires_chain_pirate_count_killed_ship
				amount = 1
			}
		}
	}
}

# This = owner of fleet 1
# From = owner of fleet 2
# FromFrom = fleet 1
# FromFromFrom = fleet 2
# fix pirate non hostile then attacked by player on_entering_battle
country_event = {
	id = human_fallen_empires_pirate.61
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from
		not = {
			is_hostile = from
		}
	}

	immediate = {
		log = "set pirate hostile"
		set_faction_hostility = {
			target = from
			set_hostile = yes
		}
	}
}

# pirate diplomacy 100-150
# start event diplomacy
country_event = {
	id = human_fallen_empires_pirate.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from
		from = {
			is_country_type = human_fallen_empires_pirate
		}
		not = {
			has_country_flag = human_fallen_empires_pirate.101_block
		}
		or = {
			is_homicidal = no
			is_same_species = from
		}
	}

	immediate = {
		from = {
			save_event_target_as = human_fallen_empires_pirate_country
		}
		country_event = {
			id = human_fallen_empires_pirate.101
		}
		set_country_flag = human_fallen_empires_pirate.101_block
	}
}

# pirate diplomacy main menu
country_event = {
	id = human_fallen_empires_pirate.101
	title = human_fallen_empires_nothing
	#message_desc = human_fallen_empires_pirate.101.desc.0 # не пашет
	desc = {
		trigger = {
			# start
			success_text = {
				text = human_fallen_empires_pirate.101.desc.0
				human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
			}
			# raid
			success_text = {
				text = human_fallen_empires_pirate.101.raid_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.raid_menu
				human_fallen_empires_trigger_exists_any_event_target = yes
			}
			success_text = {
				text = human_fallen_empires_pirate.101.raid_menu.desc.1
				has_country_flag = human_fallen_empires_pirate.101.raid_menu
				human_fallen_empires_trigger_exists_any_event_target = no
			}
			# trade
			success_text = {
				text = human_fallen_empires_pirate.101.traid_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.traid_menu
				not = {
					has_country_flag = human_fallen_empires_pirate.101.deal_offer
				}
			}
			# if pirates contacted with country
			success_text = {
				text = human_fallen_empires_pirate.101.traid_menu.desc.1
				has_country_flag = human_fallen_empires_pirate.101.traid_menu
				has_country_flag = human_fallen_empires_pirate.101.deal_offer
			}
			# slave
			success_text = {
				text = human_fallen_empires_pirate.101.slave_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.slave_menu
				human_fallen_empires_trigger_exists_any_slave_target = no
			}
			# if pirates contacted with country
			success_text = {
				text = human_fallen_empires_pirate.101.slave_menu.desc.1.0
				has_country_flag = human_fallen_empires_pirate.101.deal_offer
				has_country_flag = human_fallen_empires_pirate.101.slave_menu
				human_fallen_empires_trigger_exists_any_slave_target = yes
			}
			success_text = {
				text = human_fallen_empires_pirate.101.slave_menu.desc.1.1
				has_country_flag = human_fallen_empires_pirate.101.slave_menu
				human_fallen_empires_trigger_exists_any_slave_target = yes
			}
			# psi test start
			success_text = {
				text = human_fallen_empires_pirate.101.psi_test_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
				check_variable = {
					which = take_place_1
					value = 0
				}
			}
			# success_text = {
			# 	text = human_fallen_empires_pirate.101.psi_test_menu.desc.1
			# 	has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			# 	check_variable = {
			# 		which = take_place_1
			# 		value = 1
			# 	}
			# }
			# psi test end
			success_text = {
				text = human_fallen_empires_pirate.101.psi_test_menu.desc.2
				has_country_flag = human_fallen_empires_pirate.101.psi_test_end_lose
			}
			# success_text = {
			# 	text = human_fallen_empires_pirate.101.psi_test_menu.desc.3
			# 	has_country_flag = human_fallen_empires_pirate.101.psi_test_end_win
			# }
			# casino
			success_text = {
				text = human_fallen_empires_pirate.101.casino_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.casino_menu
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:human_fallen_empires_pirate_country
		room = event_target:human_fallen_empires_pirate_country
	}

	# pay for protect
	option = {
		name = human_fallen_empires_pirate.101.0
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		allow = {
			custom_tooltip = {
				text = human_fallen_empires_pirate.101.0.tooltip_fail
				is_hostile = event_target:human_fallen_empires_pirate_country
			}
			energy >= @human_fallen_empires_pirate_protect_cost
			minerals >= @human_fallen_empires_pirate_protect_cost
		}
		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.0.response
		add_energy = @human_fallen_empires_pirate_protect_cost_minus
		add_minerals = @human_fallen_empires_pirate_protect_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_protect_cost
			add_minerals = @human_fallen_empires_pirate_protect_cost
		}
		hidden_effect = {
			# event to return hostile
			country_event = {
				id = human_fallen_empires_pirate.200
				days = @human_fallen_empires_pirate_protect_days
			}
			event_target:human_fallen_empires_pirate_country = {
				set_faction_hostility = {
					target = root
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
				add_opinion_modifier = {
					who = root
					modifier = human_fallen_empires_opinion_pirate_pay_for_protect
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	# raid menu
	option = {
		name = human_fallen_empires_pirate.101.raid_menu
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			# human_fallen_empires_effect_clear_event_target = yes
			every_relation = {
				limit = {
					is_country_type = default
					or = {
						is_at_war_with = root
						is_hostile = root
					}
					is_hostile = event_target:human_fallen_empires_pirate_country
					not = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
				human_fallen_empires_effect_save_event_target = yes
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_rival = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_domineering_to = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_hostile_to = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_dismissive_to = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_unfriendly_to = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_threatened_to = root
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_relation = {
					limit = {
						is_country_type = default
						is_hostile = event_target:human_fallen_empires_pirate_country
						not = {
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.raid_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# select target menu
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_0
		}
		allow = {
			energy >= 500
				   minerals >= 500
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_0 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.0.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_0 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_0
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_1
		}
		allow = {
			energy >= 500
				   minerals >= 500
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_1 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.1.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_1 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_1
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_2
		}
		allow = {
			energy >= 500
			minerals >= 500
			custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_2 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.2.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_2 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_2
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_3
		}
		allow = {
			energy >= 500
				   minerals >= 500
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_3 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.3.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_3 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_3
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_4
		}
		allow = {
			energy >= 500
				   minerals >= 500
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_4 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.4.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_4 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_4
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_5
		}
		allow = {
			energy >= 500
				   minerals >= 500
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_5 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.5.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_5 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_5
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = {
						id = human_fallen_empires_pirate.50
					}
				}
			}
		}
	}
	# trade menu
	option = {
		name = human_fallen_empires_pirate.101.traid_menu
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.traid_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# sell minerals
	option = {
		name = human_fallen_empires_pirate.101.traid_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.traid_menu
		}
		allow = {
			minerals >= 150
			custom_tooltip = {
				text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy >= 100
				}
			}
		}
		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.traid_menu.0.response
		add_energy = 100
		add_minerals = -150
		event_target:human_fallen_empires_pirate_country = {
			add_energy = -100
			add_minerals = 150
		}
		hidden_effect = {
			log = "sell minerals to pirate"
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy >= 10000
				}
			}
		}
	}
	# hire pirate admiral
	option = {
		name = human_fallen_empires_pirate.101.traid_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.traid_menu
		}
		allow = {
			energy >= 1000
			custom_tooltip = {
				text = human_fallen_empires_pirate.101.traid_menu.2.fail
				or = {
					and = {
						human_fallen_empires_trigger_leaders_recrutment_enabled = no
						free_leader_slots > 0
					}
					check_variable = {
						which = human_fallen_empires_leaders_admiral_capacity
						value > 0
					}
				}
				event_target:human_fallen_empires_pirate_country = {
					any_pool_leader = {
						leader_class = admiral
						not = {
							has_leader_flag = human_fallen_empires_pirate_admiral_to_kill
						}
					}
				}
			}
		}
		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.traid_menu.2.response
		add_energy = -1000
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 1000
			custom_tooltip = human_fallen_empires_pirate.101.traid_menu.2.effect
			hidden_effect = {
				random_pool_leader = {
					limit = {
						leader_class = admiral
						not = {
							has_leader_flag = human_fallen_empires_pirate_admiral_to_kill
						}
					}
					root = {
						clone_leader = {
							target = prev
							effect = {
								save_event_target_as = human_fallen_empires_pirate_admiral_hired
							}
						}
						if = {
							limit = {
								human_fallen_empires_trigger_leaders_recrutment_enabled = yes
							}
							change_variable = {
								which = human_fallen_empires_leaders_admiral_capacity
								value = -1
							}
						}
					}
					set_leader_flag = human_fallen_empires_pirate_admiral_to_kill
					kill_leader = {
						show_notification = no
					}
				}
				log = "pirate admiral hired"
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				energy < 1000
			}
			# ethics
			modifier = {
				factor = 2
				is_militarist = yes
			}
		}
	}
	# buy slave
	option = {
		name = human_fallen_empires_pirate.101.traid_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.traid_menu
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.slave_menu
			event_target:human_fallen_empires_pirate_country = {
				human_fallen_empires_effect_save_slave_target = yes
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			modifier = {
				factor = 0
				not = {
					any_owned_planet = {
						free_pop_tiles > 0
					}
				}
			}
			modifier = {
				factor = 0
				event_target:human_fallen_empires_pirate_country = {
					num_pops = 0
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			event_target:human_fallen_empires_pirate_country = {
				is_egalitarian = yes
			}
		}
		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.0.response
		ai_chance = {
			factor = 0
		}
	}
	# select slave menu
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_0
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_0
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.1.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_0
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
			log = "[this.GetName] buy slaves 0"
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_0 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_0 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_0 = {
					num_trait_points > 4
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_1
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_1
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.2.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_1
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
			log = "[this.GetName] buy slaves 1"
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_1 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_1 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_1 = {
					num_trait_points > 4
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_2
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_2
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.3.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_2
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_2 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_2 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_2 = {
					num_trait_points > 4
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_3
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_3
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.4.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_3
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_3 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_3 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_3 = {
					num_trait_points > 4
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_4
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_4
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.5.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_4
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_4 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_4 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_4 = {
					num_trait_points > 4
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.6
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_5
		}
		allow = {
			energy >= @human_fallen_empires_pirate_slave_cost
				   minerals >= @human_fallen_empires_pirate_slave_cost
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					human_fallen_empires_trigger_planet_valid_for_settle = yes
				}
			}
				   custom_tooltip = {
				text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_5
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.6.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_5
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				or = {
					minerals < 1000
					energy < 1000
				}
			}
			# ethics
			modifier = {
				factor = 2
				is_authoritarian = yes
			}
			modifier = {
				factor = 2
				allows_slavery = yes
			}
			# pop
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_5 = {
					num_trait_points > 2
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_5 = {
					num_trait_points > 3
				}
			}
			modifier = {
				factor = 2
				event_target:human_fallen_empires_slave_target_5 = {
					num_trait_points > 4
				}
			}
		}
	}
	# service menu
	option = {
		name = human_fallen_empires_pirate.101.service_menu
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.service_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
		ai_chance = {
			factor = 0
		}
	}
	# psi test menu
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu
		trigger = {
			always = no
			has_country_flag = human_fallen_empires_pirate.101.service_menu
			exists = ruler
			event_target:human_fallen_empires_pirate_country = {
				is_spiritualist = no
			}
		}
		add_energy = -50
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 50
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			save_event_target_as = human_fallen_empires_blackjack_target_0
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# clubs
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			not = {
				has_country_flag = human_fallen_empires_pirate.101.psi_test_end
			}
		}
		set_country_flag = human_fallen_empires_pirate.101.psi_test_menu.0
		hidden_effect = {
			human_fallen_empires_effect_pirate_psi_test_turn = yes
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# diamonds
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			not = {
				has_country_flag = human_fallen_empires_pirate.101.psi_test_end
			}
		}
		set_country_flag = human_fallen_empires_pirate.101.psi_test_menu.1
		hidden_effect = {
			human_fallen_empires_effect_pirate_psi_test_turn = yes
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# hearts
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			not = {
				has_country_flag = human_fallen_empires_pirate.101.psi_test_end
			}
		}
		set_country_flag = human_fallen_empires_pirate.101.psi_test_menu.2
		hidden_effect = {
			human_fallen_empires_effect_pirate_psi_test_turn = yes
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# spades
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			not = {
				has_country_flag = human_fallen_empires_pirate.101.psi_test_end
			}
		}
		set_country_flag = human_fallen_empires_pirate.101.psi_test_menu.3
		hidden_effect = {
			human_fallen_empires_effect_pirate_psi_test_turn = yes
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# end lose
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_end_lose
		}
		hidden_effect = {
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_end
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_end_lose
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			human_fallen_empires_effect_cards_clean_all = yes
			set_variable = {
				which = human_fallen_empires_pirate_psi_test_score
				value = 0
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# end win
	option = {
		name = human_fallen_empires_pirate.101.psi_test_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.psi_test_end_win
		}
		add_energy = 10000
		event_target:human_fallen_empires_pirate_country = {
			add_energy = -10000
		}
		hidden_effect = {
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_end
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_end_win
			remove_country_flag = human_fallen_empires_pirate.101.psi_test_menu
			human_fallen_empires_effect_cards_clean_all = yes
			set_variable = {
				which = human_fallen_empires_pirate_psi_test_score
				value = 0
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# casino menu
	option = {
		name = human_fallen_empires_pirate.101.casino_menu
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.service_menu
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			save_event_target_as = human_fallen_empires_blackjack_target_0
			save_event_target_as = human_fallen_empires_blackjack_target_enemy
			event_target:human_fallen_empires_pirate_country = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# select bet
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy >= @human_fallen_empires_blackjack_bet_0
			custom_tooltip = {
				text = human_fallen_empires_not_enough_energy
				event_target:human_fallen_empires_blackjack_target_1 = {
					energy >= @human_fallen_empires_blackjack_bet_0
				}
			}
		}
		tooltip = {
			add_energy = @human_fallen_empires_blackjack_bet_0_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_0
			event_target:human_fallen_empires_blackjack_target_1 = {
				set_country_flag = human_fallen_empires_blackjack_bet_0
				country_event = {
					id = human_fallen_empires_pirate.151
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy >= @human_fallen_empires_blackjack_bet_1
			custom_tooltip = {
				text = human_fallen_empires_not_enough_energy
				event_target:human_fallen_empires_blackjack_target_1 = {
					energy >= @human_fallen_empires_blackjack_bet_1
				}
			}
		}
		tooltip = {
			add_energy = @human_fallen_empires_blackjack_bet_1_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_1
			event_target:human_fallen_empires_blackjack_target_1 = {
				set_country_flag = human_fallen_empires_blackjack_bet_1
				country_event = {
					id = human_fallen_empires_pirate.151
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy >= @human_fallen_empires_blackjack_bet_2
			custom_tooltip = {
				text = human_fallen_empires_not_enough_energy
				event_target:human_fallen_empires_blackjack_target_1 = {
					energy >= @human_fallen_empires_blackjack_bet_2
				}
			}
		}
		tooltip = {
			add_energy = @human_fallen_empires_blackjack_bet_2_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_2
			event_target:human_fallen_empires_blackjack_target_1 = {
				set_country_flag = human_fallen_empires_blackjack_bet_2
				country_event = {
					id = human_fallen_empires_pirate.151
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy >= @human_fallen_empires_blackjack_bet_3
			custom_tooltip = {
				text = human_fallen_empires_not_enough_energy
				event_target:human_fallen_empires_blackjack_target_1 = {
					energy >= @human_fallen_empires_blackjack_bet_3
				}
			}
		}
		tooltip = {
			add_energy = @human_fallen_empires_blackjack_bet_3_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_3
			event_target:human_fallen_empires_blackjack_target_1 = {
				set_country_flag = human_fallen_empires_blackjack_bet_3
				country_event = {
					id = human_fallen_empires_pirate.151
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy >= @human_fallen_empires_blackjack_bet_4
			custom_tooltip = {
				text = human_fallen_empires_not_enough_energy
				event_target:human_fallen_empires_blackjack_target_1 = {
					energy >= @human_fallen_empires_blackjack_bet_4
				}
			}
		}
		tooltip = {
			add_energy = @human_fallen_empires_blackjack_bet_4_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_4
			event_target:human_fallen_empires_blackjack_target_1 = {
				set_country_flag = human_fallen_empires_blackjack_bet_4
				country_event = {
					id = human_fallen_empires_pirate.151
				}
			}
		}
	}
	# for mp menu
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.challenge
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
			any_relation = {
				is_ai = no
				energy >= @human_fallen_empires_blackjack_bet_0
			}
		}
		hidden_effect = {
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu
			set_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			every_relation = {
				limit = {
					is_ai = no
					energy >= @human_fallen_empires_blackjack_bet_0
					human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
				}
				human_fallen_empires_effect_save_event_target = yes
			}
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# select target menu
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_0
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_0 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_1
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_1 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_2
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_2 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_3
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_3 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_4
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_4 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			exists = event_target:human_fallen_empires_event_target_5
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_5 = {
				save_event_target_as = human_fallen_empires_blackjack_target_1
			}
			remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# return
	option = {
		name = modmenu_return
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = yes
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			country_event = {
				id = human_fallen_empires_pirate.101
			}
		}
	}
	# exit
	option = {
		name = human_fallen_empires_end_transmission
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = human_fallen_empires_pirate.101_block
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
		}
		ai_chance = {
			factor = 100
		}
	}
}

# blackjack event 150 - 200
# main blackjack event
country_event = {
	id = human_fallen_empires_pirate.150
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = human_fallen_empires_blackjack_win.defined_text
				has_country_flag = human_fallen_empires_blackjack_end_win
			}
			success_text = {
				text = human_fallen_empires_blackjack_stay.defined_text
				has_country_flag = human_fallen_empires_blackjack_end_stay
			}
			success_text = {
				text = human_fallen_empires_blackjack_lose.defined_text
				has_country_flag = human_fallen_empires_blackjack_end
				nor = {
					has_country_flag = human_fallen_empires_blackjack_end_win
					has_country_flag = human_fallen_empires_blackjack_end_stay
				}
			}
			text = human_fallen_empires_blackjack_show_my_stats
			text = human_fallen_empires_blackjack_show_my_stats_cards
			text = human_fallen_empires_newline_3
			fail_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats_hide
				has_country_flag = human_fallen_empires_blackjack_end
			}
			fail_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats_hide_cards
				has_country_flag = human_fallen_empires_blackjack_end
			}
			success_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats
				has_country_flag = human_fallen_empires_blackjack_end
			}
			success_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats_cards
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:human_fallen_empires_blackjack_target_enemy
		planet_background = event_target:human_fallen_empires_blackjack_target_enemy
		graphical_culture = event_target:human_fallen_empires_blackjack_target_enemy
		city_level = event_target:human_fallen_empires_blackjack_target_enemy
		room = event_target:human_fallen_empires_blackjack_target_enemy.ruler
	}

	immediate = {
		if = {
			limit = {
				event_target:human_fallen_empires_blackjack_target_0 = {
					has_country_flag = human_fallen_empires_blackjack_stand
				}
				event_target:human_fallen_empires_blackjack_target_1 = {
					has_country_flag = human_fallen_empires_blackjack_stand
				}
			}
			human_fallen_empires_effect_blackjack_calc_winner = yes
		}
	}

	option = {
		name = human_fallen_empires_blackjack_hit.defined_text
		trigger = {
			not = {
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
		allow = {
			custom_tooltip = {
				text = human_fallen_empires_blackjack_have_21
				check_variable = {
					which = blackjack_calc
					value < 21
				}
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				check_variable = {
					which = blackjack_calc
					value > 16
				}
			}
		}
		hidden_effect = {
			human_fallen_empires_effect_cards_get_card = yes
			human_fallen_empires_effect_blackjack_calc_cards = yes
			human_fallen_empires_effect_cards_take_cards_in_place = yes
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
	option = {
		name = human_fallen_empires_blackjack_stand.defined_text
		trigger = {
			not = {
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				check_variable = {
					which = blackjack_calc
					value < 17
				}
			}
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_stand
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
	option = {
		name = human_fallen_empires_blackjack_end_game
		trigger = {
			has_country_flag = human_fallen_empires_blackjack_end
		}
		ai_chance = {
			factor = 100
		}
		human_fallen_empires_effect_blackjack_calc_bet = yes
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_end_shown
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
}

# blackjack challenge
country_event = {
	id = human_fallen_empires_pirate.151
	title = TRANSMISSION
	desc = human_fallen_empires_pirate.151.desc
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:human_fallen_empires_blackjack_target_0
		planet_background = event_target:human_fallen_empires_blackjack_target_0
		graphical_culture = event_target:human_fallen_empires_blackjack_target_0
		city_level = event_target:human_fallen_empires_blackjack_target_0
		room = event_target:human_fallen_empires_blackjack_target_0.ruler
	}

	option = {
		name = human_fallen_empires_blackjack_challenge_yes.defined_text
		human_fallen_empires_effect_blackjack_remove_bet = yes
		hidden_effect = {
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = human_fallen_empires_blackjack_challenge_no.defined_text
		default_hide_option = yes
		hidden_effect = {
			event_target:human_fallen_empires_blackjack_target_0 = {
				human_fallen_empires_effect_blackjack_clean_all = yes
			}
			event_target:human_fallen_empires_blackjack_target_1 = {
				human_fallen_empires_effect_blackjack_clean_all = yes
			}
		}
		ai_chance = {
			factor = 0
		}
	}
}

# other pirate related diplo events 200 - 250
# offer protection and extend protection later
country_event = {
	id = human_fallen_empires_pirate.200
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = human_fallen_empires_pirate.200.desc.0
				is_hostile = event_target:human_fallen_empires_pirate_country
			}
			fail_text = {
				text = human_fallen_empires_pirate.200.desc.1
				is_hostile = event_target:human_fallen_empires_pirate_country
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes
 	location = event_target:human_fallen_empires_pirate_country.capital_scope

	picture_event_data = {
		portrait = event_target:human_fallen_empires_pirate_country
		room = event_target:human_fallen_empires_pirate_country.ruler
	}

	trigger = {
		exists = event_target:human_fallen_empires_pirate_country
	}

	immediate = {
		log = "pirates offer protection for [root.GetName]"
	}

	option = {
		name = human_fallen_empires_pirate.200.0
		allow = {
			energy >= @human_fallen_empires_pirate_protect_cost
			minerals >= @human_fallen_empires_pirate_protect_cost
		}
		add_minerals = @human_fallen_empires_pirate_protect_cost_minus
		add_energy = @human_fallen_empires_pirate_protect_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_minerals = @human_fallen_empires_pirate_protect_cost
			add_energy = @human_fallen_empires_pirate_protect_cost
		}
		hidden_effect = {
			log = "agree for protection pay"
			if = {
				limit = {
					is_hostile = event_target:human_fallen_empires_pirate_country
				}
				set_faction_hostility = {
					target = event_target:human_fallen_empires_pirate_country
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
			}
			country_event = {
				id = human_fallen_empires_pirate.200
				days = @human_fallen_empires_pirate_protect_days
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = root
					modifier = human_fallen_empires_opinion_pirate_pay_for_protect
				}
			}
		}
		ai_chance = {
			factor = 100
			# ethics
			modifier = {
				factor = 0.5
				or = {
					is_militarist = yes
					is_xenophobe = yes
				}
			}
			modifier = {
				factor = 2
				is_pacifist = yes
			}
			# fleet power
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:human_fallen_empires_pirate_country
					category = fleet
					value >= overwhelming
				}
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:human_fallen_empires_pirate_country
					category = fleet
					value >= superior
				}
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:human_fallen_empires_pirate_country
					category = fleet
					value <= equivalent
				}
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:human_fallen_empires_pirate_country
					category = fleet
					value <= inferior
				}
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:human_fallen_empires_pirate_country
					category = fleet
					value <= pathetic
				}
			}
			# money
			modifier = {
				factor = 0.5
				energy < 5000
				minerals < 5000
			}
			modifier = {
				factor = 0.5
				energy < 2500
				minerals < 2500
			}
			modifier = {
				factor = 0.5
				energy < 1000
				minerals < 1000
			}
			modifier = {
				factor = 0
				energy < 500
				minerals < 500
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.200.1
		default_hide_option = yes
		log = "not agree for protection pay"
		if = {
			limit = {
				not = {
					is_hostile = event_target:human_fallen_empires_pirate_country
				}
			}
			set_faction_hostility = {
				target = event_target:human_fallen_empires_pirate_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
}
